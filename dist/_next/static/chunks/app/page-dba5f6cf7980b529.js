(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{20067:function(){},72061:function(){},68914:function(e,a,s){Promise.resolve().then(s.bind(s,51263))},51263:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return aQ}});var t=s(57437),l=s(2265),r=s(25466),i=s(95805),n=s(6818),c=s(88226),d=s(26937),o=s(73247),m=s(48736),u=s(7586),h=s(29525),x=s(51884),p=s(14938),j=s(40875),v=s(76865),f=s(53121),N=s(98728),y=s(62869);function g(e){let{setCurrentPage:a,userRole:s}=e,[g,b]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1),[D,S]=(0,l.useState)(!1),[I,A]=(0,l.useState)(!1),[P,M]=(0,l.useState)(!0),k="Admin"===s,O=[{name:"Dashboard",icon:r.Z,page:"dashboard"},{name:"Customers",icon:i.Z,page:"customers"},{name:"Reports",icon:n.Z,page:"reports"},{name:"Payment",icon:c.Z,page:"payment"}],Z=[{name:"New Claim",icon:d.Z,page:"claims"},{name:"Search Claims",icon:o.Z,page:"claimsProcessing"}],E=[{name:"Policies",icon:m.Z,page:"policies"},{name:"Catering Maintenance",icon:m.Z,page:"cateringMaintenance"}],F=[{name:"Add Contract",icon:d.Z,page:"addContract"},{name:"Search Contract",icon:o.Z,page:"searchContract"}],T=[{name:"Category Maintenance",icon:u.Z,page:"categoryMaintenance"},{name:"Feature Maintenance",icon:h.Z,page:"featureMaintenance"},{name:"User Management",icon:x.Z,page:"userManagement"}];return(0,t.jsxs)("div",{className:"bg-gray-800 text-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-center",children:"Insurance System"}),(0,t.jsxs)("nav",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(y.z,{variant:"ghost",id:"General",className:"w-full justify-between py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white",onClick:()=>M(!P),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(p.Z,{className:"inline-block mr-2 h-5 w-5"}),"General"]}),(0,t.jsx)(j.Z,{className:"h-4 w-4 transition-transform duration-200 ".concat(P?"rotate-180":"")})]}),(0,t.jsx)("div",{className:"pl-4 space-y-1 overflow-hidden transition-all duration-200 ".concat(P?"max-h-40 opacity-100":"max-h-0 opacity-0"),children:O.map(e=>(0,t.jsxs)("a",{href:"#",id:e.name,className:"block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white text-sm",onClick:()=>a(e.page),children:[(0,t.jsx)(e.icon,{className:"inline-block mr-2 h-4 w-4"}),e.name]},e.name))})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(y.z,{variant:"ghost",id:"Claims",className:"w-full justify-between py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white",onClick:()=>A(!I),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(v.Z,{className:"inline-block mr-2 h-5 w-5"}),"Claims"]}),(0,t.jsx)(j.Z,{className:"h-4 w-4 transition-transform duration-200 ".concat(I?"rotate-180":"")})]}),(0,t.jsx)("div",{className:"pl-4 space-y-1 overflow-hidden transition-all duration-200 ".concat(I?"max-h-40 opacity-100":"max-h-0 opacity-0"),children:Z.map(e=>(0,t.jsxs)("a",{href:"#",id:e.name,className:"block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white text-sm",onClick:()=>a(e.page),children:[(0,t.jsx)(e.icon,{className:"inline-block mr-2 h-4 w-4"}),e.name]},e.name))})]}),k&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(y.z,{variant:"ghost",id:"Maintenance",className:"w-full justify-between py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white",onClick:()=>S(!D),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(h.Z,{className:"inline-block mr-2 h-5 w-5"}),"Maintenance"]}),(0,t.jsx)(j.Z,{className:"h-4 w-4 transition-transform duration-200 ".concat(D?"rotate-180":"")})]}),(0,t.jsx)("div",{className:"pl-4 space-y-1 overflow-hidden transition-all duration-200 ".concat(D?"max-h-40 opacity-100":"max-h-0 opacity-0"),children:E.map(e=>(0,t.jsxs)("a",{href:"#",id:e.name,className:"block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white text-sm",onClick:()=>a(e.page),children:[(0,t.jsx)(e.icon,{className:"inline-block mr-2 h-4 w-4"}),e.name]},e.name))})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(y.z,{variant:"ghost",id:"Contract",className:"w-full justify-between py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white",onClick:()=>C(!w),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(f.Z,{className:"inline-block mr-2 h-5 w-5"}),"Contract"]}),(0,t.jsx)(j.Z,{className:"h-4 w-4 transition-transform duration-200 ".concat(w?"rotate-180":"")})]}),(0,t.jsx)("div",{className:"pl-4 space-y-1 overflow-hidden transition-all duration-200 ".concat(w?"max-h-40 opacity-100":"max-h-0 opacity-0"),children:F.map(e=>(0,t.jsxs)("a",{href:"#",id:e.name,className:"block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white text-sm",onClick:()=>a(e.page),children:[(0,t.jsx)(e.icon,{className:"inline-block mr-2 h-4 w-4"}),e.name]},e.name))})]}),k&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(y.z,{variant:"ghost",id:"Utility",className:"w-full justify-between py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white",onClick:()=>b(!g),children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(N.Z,{className:"inline-block mr-2 h-5 w-5"}),"Utility"]}),(0,t.jsx)(j.Z,{className:"h-4 w-4 transition-transform duration-200 ".concat(g?"rotate-180":"")})]}),(0,t.jsx)("div",{className:"pl-4 space-y-1 overflow-hidden transition-all duration-200 ".concat(g?"max-h-40 opacity-100":"max-h-0 opacity-0"),children:T.map(e=>(0,t.jsxs)("a",{href:"#",id:e.name,className:"block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white text-sm",onClick:()=>a(e.page),children:[(0,t.jsx)(e.icon,{className:"inline-block mr-2 h-4 w-4"}),e.name]},e.name))})]})]})]})}var b=s(94766),w=s(47692),C=s(28119),D=s(10407),S=s(30401),I=s(40519),A=s(94508);let P=C.fC,M=C.xz;C.ZA,C.Uv,C.Tr,C.Ee,l.forwardRef((e,a)=>{let{className:s,inset:l,children:r,...i}=e;return(0,t.jsxs)(C.fF,{ref:a,className:(0,A.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",l&&"pl-8",s),...i,children:[r,(0,t.jsx)(D.Z,{className:"ml-auto"})]})}).displayName=C.fF.displayName,l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(C.tu,{ref:a,className:(0,A.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})}).displayName=C.tu.displayName;let k=l.forwardRef((e,a)=>{let{className:s,sideOffset:l=4,...r}=e;return(0,t.jsx)(C.Uv,{children:(0,t.jsx)(C.VY,{ref:a,sideOffset:l,className:(0,A.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})})});k.displayName=C.VY.displayName;let O=l.forwardRef((e,a)=>{let{className:s,inset:l,...r}=e;return(0,t.jsx)(C.ck,{ref:a,className:(0,A.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",l&&"pl-8",s),...r})});O.displayName=C.ck.displayName,l.forwardRef((e,a)=>{let{className:s,children:l,checked:r,...i}=e;return(0,t.jsxs)(C.oC,{ref:a,className:(0,A.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:r,...i,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(C.wU,{children:(0,t.jsx)(S.Z,{className:"h-4 w-4"})})}),l]})}).displayName=C.oC.displayName,l.forwardRef((e,a)=>{let{className:s,children:l,...r}=e;return(0,t.jsxs)(C.Rk,{ref:a,className:(0,A.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(C.wU,{children:(0,t.jsx)(I.Z,{className:"h-2 w-2 fill-current"})})}),l]})}).displayName=C.Rk.displayName,l.forwardRef((e,a)=>{let{className:s,inset:l,...r}=e;return(0,t.jsx)(C.__,{ref:a,className:(0,A.cn)("px-2 py-1.5 text-sm font-semibold",l&&"pl-8",s),...r})}).displayName=C.__.displayName,l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(C.Z0,{ref:a,className:(0,A.cn)("-mx-1 my-1 h-px bg-muted",s),...l})}).displayName=C.Z0.displayName;var Z=s(81103);function E(e){let{onLogout:a}=e;return(0,t.jsx)("div",{className:"border-b",children:(0,t.jsxs)("div",{className:"flex h-16 items-center px-4 justify-end gap-4",children:[(0,t.jsx)(y.z,{variant:"ghost",size:"icon",children:(0,t.jsx)(b.Z,{className:"h-5 w-5"})}),(0,t.jsx)(y.z,{variant:"ghost",size:"icon",children:(0,t.jsx)(N.Z,{className:"h-5 w-5"})}),(0,t.jsxs)(P,{children:[(0,t.jsx)(M,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",className:"h-8 w-8 rounded-full",children:(0,t.jsx)("img",{className:"h-8 w-8 rounded-full",src:"https://github.com/shadcn.png",alt:"Avatar"})})}),(0,t.jsx)(k,{align:"end",children:(0,t.jsxs)(O,{className:"text-red-600 cursor-pointer",onClick:a,children:[(0,t.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Logout"]})})]}),(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",size:"icon",onClick:a,className:"text-red-600 hover:text-red-700 hover:bg-red-100",children:(0,t.jsx)(w.Z,{className:"h-5 w-5"})})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"Logout"})})]})})]})})}function F(e){let{children:a,setCurrentPage:s,onLogout:l,userRole:r}=e;return(0,t.jsxs)("div",{className:"min-h-screen flex",children:[(0,t.jsx)(g,{setCurrentPage:s,userRole:r}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(E,{onLogout:l}),(0,t.jsx)("main",{className:"p-8",children:a})]})]})}var T=s(66070),L=s(47625),U=s(48508),z=s(56940),R=s(97059),B=s(62994),J=s(8147),V=s(22190),_=s(69349);let q=[{name:"Life",policies:4e3,claims:2400},{name:"Health",policies:3e3,claims:1398},{name:"Auto",policies:2e3,claims:9800},{name:"Home",policies:2780,claims:3908},{name:"Travel",policies:1890,claims:4800}];function X(){return(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,t.jsx)(T.ll,{className:"text-sm font-medium",children:"Total Policies"})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:"13,670"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"+2.5% from last month"})]})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,t.jsx)(T.ll,{className:"text-sm font-medium",children:"Active Claims"})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:"2,345"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"+180 since last week"})]})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,t.jsx)(T.ll,{className:"text-sm font-medium",children:"Premium Revenue"})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:"$5.2M"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"+8% from last quarter"})]})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,t.jsx)(T.ll,{className:"text-sm font-medium",children:"Customer Satisfaction"})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:"92%"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"+2% from last year"})]})]}),(0,t.jsxs)(T.Zb,{className:"col-span-4",children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Policies and Claims Overview"})}),(0,t.jsx)(T.aY,{className:"w-full h-[300px]",children:(0,t.jsx)(L.h,{width:"100%",height:"100%",children:(0,t.jsxs)(U.v,{data:q,children:[(0,t.jsx)(z.q,{strokeDasharray:"3 3"}),(0,t.jsx)(R.K,{dataKey:"name"}),(0,t.jsx)(B.B,{}),(0,t.jsx)(J.u,{}),(0,t.jsx)(V.D,{}),(0,t.jsx)(_.$,{dataKey:"policies",fill:"#8884d8"}),(0,t.jsx)(_.$,{dataKey:"claims",fill:"#82ca9d"})]})})})]})]})}let Y=l.forwardRef((e,a)=>{let{className:s,type:l,...r}=e;return(0,t.jsx)("input",{type:l,className:(0,A.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...r})});Y.displayName="Input";var W=s(370);let $=(0,s(90535).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),H=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(W.f,{ref:a,className:(0,A.cn)($(),s),...l})});H.displayName=W.f.displayName;var K=s(73578),Q=s(51817),G=s(99397),ee=s(28842),ea=s(45675),es=s(18930),et=s(6366),el=s(22135);let er=et.fC;et.ZA;let ei=et.B4,en=l.forwardRef((e,a)=>{let{className:s,children:l,...r}=e;return(0,t.jsxs)(et.xz,{ref:a,className:(0,A.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[l,(0,t.jsx)(et.JO,{asChild:!0,children:(0,t.jsx)(j.Z,{className:"h-4 w-4 opacity-50"})})]})});en.displayName=et.xz.displayName;let ec=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(et.u_,{ref:a,className:(0,A.cn)("flex cursor-default items-center justify-center py-1",s),...l,children:(0,t.jsx)(el.Z,{className:"h-4 w-4"})})});ec.displayName=et.u_.displayName;let ed=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(et.$G,{ref:a,className:(0,A.cn)("flex cursor-default items-center justify-center py-1",s),...l,children:(0,t.jsx)(j.Z,{className:"h-4 w-4"})})});ed.displayName=et.$G.displayName;let eo=l.forwardRef((e,a)=>{let{className:s,children:l,position:r="popper",...i}=e;return(0,t.jsx)(et.h_,{children:(0,t.jsxs)(et.VY,{ref:a,className:(0,A.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...i,children:[(0,t.jsx)(ec,{}),(0,t.jsx)(et.l_,{className:(0,A.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,t.jsx)(ed,{})]})})});eo.displayName=et.VY.displayName,l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(et.__,{ref:a,className:(0,A.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...l})}).displayName=et.__.displayName;let em=l.forwardRef((e,a)=>{let{className:s,children:l,...r}=e;return(0,t.jsxs)(et.ck,{ref:a,className:(0,A.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(et.wU,{children:(0,t.jsx)(S.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(et.eT,{children:l})]})});em.displayName=et.ck.displayName,l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(et.Z0,{ref:a,className:(0,A.cn)("-mx-1 my-1 h-px bg-muted",s),...l})}).displayName=et.Z0.displayName;var eu=s(35974),eh=s(26110),ex=s(65613);let ep=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)("textarea",{className:(0,A.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...l})});ep.displayName="Textarea";var ej=s(5978),ev=s(20407),ef=s(77992);let eN=[{id:"POL001",name:"Basic Funeral Cover",description:"Essential funeral coverage for individuals and families",premium:150,coverAmount:25e3,status:"active",maxDependents:4,features:["FEX001","FEX002","FEX003","FEX004"]}];function ey(e){let{userRole:a}=e,s=a&&!["View Only","New Claim"].includes(a),[r,i]=(0,l.useState)([]),[n,c]=(0,l.useState)([]),[d,m]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[x,p]=(0,l.useState)({name:"",status:"all",category:"all",priceRange:"",coverAmountMin:"",coverAmountMax:"",dependentsMin:"",dependentsMax:"",sortBy:"name",sortOrder:"asc"}),[j,v]=(0,l.useState)(!1),[f,N]=(0,l.useState)(!1),[g,b]=(0,l.useState)(null),[w,C]=(0,l.useState)(null),[D,S]=(0,l.useState)({id:"",name:"",description:"",premium:0,coverAmount:0,status:"active",maxDependents:0,features:[],categoryId:"",category:""}),[I,A]=(0,l.useState)(""),[P,M]=(0,l.useState)(!1),[k,O]=(0,l.useState)([]),[E,F]=(0,l.useState)({}),[L,U]=(0,l.useState)(!1),[z,R]=(0,l.useState)(!1),[B,J]=(0,l.useState)(null),[V,_]=(0,l.useState)(new Set),[q,X]=(0,l.useState)([]),[W,$]=(0,l.useState)(!0),[et,el]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{try{m(!0),h(null);let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Policies"),(0,ej.Xo)("name","asc")),a=(await (0,ej.PL)(e)).docs.map(e=>{let a=e.data();return{id:e.id,name:a.name||"",description:a.description||"",premium:a.premium||0,coverAmount:a.coverAmount||0,status:a.status||"inactive",maxDependents:a.maxDependents||0,features:a.features||[],categoryId:a.categoryId||""}});i(a),c(a)}catch(e){console.error("Error fetching policies:",e),h("Failed to load policies. Please try again.")}finally{m(!1)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"features"),(0,ej.Xo)("id","asc")),a=(await (0,ej.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));O(a);let s=a.reduce((e,a)=>({...e,[a.id]:a.name}),{});F(s)}catch(e){console.error("Error fetching features:",e)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(0,ej.hJ)(ev.db,"Contracts"),a=await (0,ej.PL)(e),s=new Set;a.forEach(e=>{let a=e.data();a.policiesId&&s.add(a.policiesId)}),_(s)}catch(e){console.error("Error checking linked policies:",e)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{$(!0);let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Category"),(0,ej.Xo)("id","asc")),a=(await (0,ej.PL)(e)).docs.map(e=>({id:e.data().id,name:e.data().name}));X(a)}catch(e){console.error("Error fetching categories:",e)}finally{$(!1)}})()},[]);let ec=e=>{let{name:a,value:s}=e.target;p(e=>({...e,[a]:s}))},ed=(e,a)=>{p(s=>({...s,[a]:e}))},ey=e=>{p(a=>({...a,sortBy:e,sortOrder:a.sortBy===e&&"asc"===a.sortOrder?"desc":"asc"})),c([...n].sort((a,s)=>{let t=a[e],l=s[e],r="asc"===x.sortOrder?1:-1;return"string"==typeof t?t.localeCompare(String(l))*r:(t-l)*r}))},eg=async e=>{e.preventDefault(),v(!0);try{let e=[...r.filter(e=>{let a=e.name.toLowerCase().includes(x.name.toLowerCase()),s="all"===x.status||e.status===x.status,t="all"===x.category||e.categoryId===x.category,l=parseFloat(x.priceRange),r=!x.priceRange||isNaN(l)||e.premium<=l,i=parseFloat(x.coverAmountMin),n=parseFloat(x.coverAmountMax),c=(!x.coverAmountMin||isNaN(i)||e.coverAmount>=i)&&(!x.coverAmountMax||isNaN(n)||e.coverAmount<=n),d=parseFloat(x.dependentsMin),o=parseFloat(x.dependentsMax),m=(!x.dependentsMin||isNaN(d)||e.maxDependents>=d)&&(!x.dependentsMax||isNaN(o)||e.maxDependents<=o);return a&&s&&t&&r&&c&&m})].sort((e,a)=>{let s=e[x.sortBy],t=a[x.sortBy],l="asc"===x.sortOrder?1:-1;return"string"==typeof s?s.localeCompare(String(t))*l:(s-t)*l});c(e)}catch(e){console.error("Error searching policies:",e),h("Failed to search policies. Please try again.")}finally{v(!1)}},eb=async e=>{try{var a;m(!0);let s=e.features.map(async e=>{let a=(0,ej.JU)(ev.db,"features",e),s=await (0,ej.QT)(a);return{id:s.id,...s.data()}}),t=(await Promise.all(s)).reduce((e,a)=>({...e,[a.id]:a.name}),{});q.forEach(e=>{alert(e.name)});let l=(null===(a=q.find(a=>a.id===e.categoryId))||void 0===a?void 0:a.name)||"";alert(l),F(e=>({...e,...t})),b({...e,category:l}),S({...e,category:l}),N(!0)}catch(e){console.error("Error fetching policy details:",e),h("Failed to load policy details. Please try again.")}finally{m(!1)}},ew=e=>{let{name:a,value:s}=e.target;S(e=>({...e,[a]:"name"===a||"description"===a?s:Number(s)}))},eC=async()=>{if(I.trim())try{M(!0);let e=k.find(e=>e.name===I);if(!e){C("Please select a valid feature from the list");return}if(D.features.includes(e.id)){C("This feature is already added to the policy");return}S(a=>({...a,features:[...a.features,e.id]})),A(""),C(null)}catch(e){C("Failed to add feature. Please try again.")}finally{M(!1)}},eD=e=>{S(a=>({...a,features:a.features.filter((a,s)=>s!==e)}))},eS=async()=>{try{let e=(0,ej.hJ)(ev.db,"Policies"),a=(await (0,ej.PL)(e)).docs.map(e=>e.data().id||"").filter(e=>e.startsWith("POL")).map(e=>parseInt(e.substring(3))).filter(e=>!isNaN(e)),s=a.length>0?Math.max(...a):0;return"POL".concat(String(s+1).padStart(3,"0"))}catch(e){throw console.error("Error generating ID:",e),Error("Failed to generate policy ID")}},eI=async e=>{if(e.preventDefault(),C(null),!D.name||D.premium<=0||D.coverAmount<=0||D.maxDependents<=0||!D.category){C("Please fill in all required fields with valid values");return}try{el(!0);let e=q.find(e=>e.name===D.category);if(!e){C("Selected category not found");return}let a=(0,ej.hJ)(ev.db,"Policies"),s={...D,categoryId:e.id};if(g){let e=(0,ej.JU)(ev.db,"Policies",g.id);await (0,ej.pl)(e,{...s,updatedAt:(0,ej.Bt)()},{merge:!0}),(0,ef.Am)({title:"Success",description:"Policy updated successfully"})}else{let e=await eS();await (0,ej.pl)((0,ej.JU)(a,e),{...s,id:e,createdAt:(0,ej.Bt)(),updatedAt:(0,ej.Bt)()}),(0,ef.Am)({title:"Success",description:"Policy created successfully"})}N(!1),S({id:"",name:"",description:"",premium:0,coverAmount:0,status:"active",maxDependents:0,features:[],categoryId:"",category:""}),b(null);let t=(0,ej.IO)((0,ej.hJ)(ev.db,"Policies"),(0,ej.Xo)("name","asc")),l=(await (0,ej.PL)(t)).docs.map(e=>({id:e.id,...e.data()}));i(l),c(l)}catch(e){console.error("Error saving policy:",e),C("Failed to save policy. Please try again.")}finally{el(!1)}},eA=e=>{J(e),R(!0)},eP=async()=>{if(B)try{U(!0);let e=(0,ej.hJ)(ev.db,"Contracts"),a=(0,ej.IO)(e,(0,ej.ar)("policiesId","==",B.id));if(!(await (0,ej.PL)(a)).empty){(0,ef.Am)({title:"Cannot Delete Policy",description:"This policy is linked to existing contracts and cannot be deleted.",variant:"destructive"});return}await (0,ej.oe)((0,ej.JU)(ev.db,"Policies",B.id));let s=r.filter(e=>e.id!==B.id);i(s),c(s),(0,ef.Am)({title:"Policy Deleted",description:"The policy has been successfully deleted."}),R(!1),J(null)}catch(e){console.error("Error deleting policy:",e),(0,ef.Am)({title:"Error",description:"Failed to delete policy. Please try again.",variant:"destructive"})}finally{U(!1)}};return d?(0,t.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)(Q.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading policies..."})]})}):u?(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"m-4",children:[(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsxs)(ex.X,{children:[u,(0,t.jsx)(y.z,{variant:"link",className:"pl-2 underline",onClick:()=>window.location.reload(),children:"Try again"})]})]}):(0,t.jsx)(Z.pn,{children:(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsxs)(T.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(T.ll,{children:"Search Policies"}),s&&(0,t.jsxs)(y.z,{onClick:()=>{b(null),S({id:"POL".concat(String(eN.length+1).padStart(3,"0")),name:"",description:"",premium:0,coverAmount:0,status:"active",maxDependents:0,features:[],categoryId:"",category:""}),N(!0)},children:[(0,t.jsx)(G.Z,{className:"mr-2 h-4 w-4"}),"Add New Policy"]})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("form",{onSubmit:eg,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"name",children:"Policy Name"}),(0,t.jsx)(Y,{id:"name",name:"name",value:x.name,onChange:ec,placeholder:"Search by policy name",className:"h-11"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"status",children:"Status"}),(0,t.jsxs)(er,{value:x.status,onValueChange:e=>ed(e,"status"),children:[(0,t.jsx)(en,{className:"h-11",children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Statuses"}),(0,t.jsx)(em,{value:"active",children:"Active"}),(0,t.jsx)(em,{value:"inactive",children:"Inactive"}),(0,t.jsx)(em,{value:"expired",children:"Expired"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"category",children:"Category"}),(0,t.jsxs)(er,{value:x.category,onValueChange:e=>ed(e,"category"),children:[(0,t.jsx)(en,{className:"h-11",children:(0,t.jsx)(ei,{placeholder:"Select category"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Categories"}),q.map(e=>(0,t.jsx)(em,{value:e.name,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Monthly Premium Range (R)"}),(0,t.jsx)("div",{className:"flex gap-2 items-center",children:(0,t.jsx)(Y,{id:"priceRange",name:"priceRange",type:"number",value:x.priceRange,onChange:ec,placeholder:"Maximum",className:"h-11",min:"0",step:"50"})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Cover Amount Range (R)"}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)(Y,{name:"coverAmountMin",type:"number",value:x.coverAmountMin,onChange:ec,placeholder:"Minimum",className:"h-11",min:"0",step:"1000"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"to"}),(0,t.jsx)(Y,{name:"coverAmountMax",type:"number",value:x.coverAmountMax,onChange:ec,placeholder:"Maximum",className:"h-11",min:"0",step:"1000"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Dependents Range"}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)(Y,{name:"dependentsMin",type:"number",value:x.dependentsMin,onChange:ec,placeholder:"Min",className:"h-11",min:"0",max:"10"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"to"}),(0,t.jsx)(Y,{name:"dependentsMax",type:"number",value:x.dependentsMax,onChange:ec,placeholder:"Max",className:"h-11",min:"0",max:"10"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Sort By"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(er,{value:x.sortBy,onValueChange:e=>ed(e,"sortBy"),children:[(0,t.jsx)(en,{className:"h-11",children:(0,t.jsx)(ei,{placeholder:"Sort by"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"name",children:"Name"}),(0,t.jsx)(em,{value:"premium",children:"Premium"}),(0,t.jsx)(em,{value:"coverAmount",children:"Cover Amount"}),(0,t.jsx)(em,{value:"maxDependents",children:"Max Dependents"}),(0,t.jsx)(em,{value:"status",children:"Status"}),(0,t.jsx)(em,{value:"category",children:"Category"})]})]}),(0,t.jsxs)(er,{value:x.sortOrder,onValueChange:e=>ed(e,"sortOrder"),children:[(0,t.jsx)(en,{className:"h-11 w-[100px]",children:(0,t.jsx)(ei,{placeholder:"Order"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"asc",children:"Asc"}),(0,t.jsx)(em,{value:"desc",children:"Desc"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(y.z,{type:"submit",disabled:j,className:"min-w-[120px]",children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Search"]})}),(0,t.jsx)(y.z,{type:"button",variant:"outline",onClick:()=>{p({name:"",status:"all",category:"all",priceRange:"",coverAmountMin:"",coverAmountMax:"",dependentsMin:"",dependentsMax:"",sortBy:"name",sortOrder:"asc"}),eg({preventDefault:()=>{}})},children:"Reset Filters"})]})]})})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)(T.ll,{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Search Results"}),(0,t.jsxs)(eu.C,{variant:"secondary",children:[n.length," ",1===n.length?"item":"items"]})]})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"Policy ID"}),(0,t.jsxs)(K.ss,{className:"cursor-pointer hover:bg-accent",onClick:()=>ey("name"),children:["Name ","name"===x.sortBy&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsxs)(K.ss,{className:"cursor-pointer hover:bg-accent",onClick:()=>ey("premium"),children:["Premium ","premium"===x.sortBy&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsxs)(K.ss,{className:"cursor-pointer hover:bg-accent",onClick:()=>ey("coverAmount"),children:["Cover Amount ","coverAmount"===x.sortBy&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsxs)(K.ss,{className:"cursor-pointer hover:bg-accent",onClick:()=>ey("maxDependents"),children:["Max Dependents ","maxDependents"===x.sortBy&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsxs)(K.ss,{className:"cursor-pointer hover:bg-accent",onClick:()=>ey("status"),children:["Status ","status"===x.sortBy&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsxs)(K.ss,{className:"cursor-pointer hover:bg-accent",onClick:()=>ey("category"),children:["Category ","category"===x.sortBy&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsx)(K.ss,{children:"Actions"})]})}),(0,t.jsx)(K.RM,{children:0===n.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No policies found matching your search criteria"})}):n.map(e=>{var a;return(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:e.id}),(0,t.jsx)(K.pj,{children:e.name}),(0,t.jsxs)(K.pj,{children:["R",e.premium.toLocaleString()]}),(0,t.jsxs)(K.pj,{children:["R",e.coverAmount.toLocaleString()]}),(0,t.jsx)(K.pj,{children:e.maxDependents}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(eu.C,{variant:"active"===e.status?"default":"secondary",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(eu.C,{variant:"outline",children:(null===(a=q.find(a=>a.id===e.categoryId))||void 0===a?void 0:a.name)||"Uncategorized"})}),(0,t.jsx)(K.pj,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>eb(e),children:(0,t.jsx)(ea.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(Z._v,{children:"Edit policy"})]}),!V.has(e.id)&&(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>eA(e),children:(0,t.jsx)(es.Z,{className:"h-4 w-4 text-red-500"})})}),(0,t.jsx)(Z._v,{children:"Delete policy"})]})]})})]},e.id)})})]})})]}),(0,t.jsx)(eh.Vq,{open:f,onOpenChange:N,children:(0,t.jsxs)(eh.cZ,{className:"max-w-5xl max-h-[95vh] overflow-y-auto p-8",children:[(0,t.jsx)(eh.fK,{className:"mb-6",children:(0,t.jsxs)(eh.$N,{className:"text-2xl",children:[g?"Edit Policy":"Add New Policy",d&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 inline animate-spin"})]})}),(0,t.jsxs)("form",{onSubmit:eI,className:"space-y-8",children:[w&&(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-6",children:[(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:w})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-x-8 gap-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"id",className:"text-base",children:"Policy ID"}),(0,t.jsx)(Y,{id:"id",name:"id",value:D.id,disabled:!0,className:"h-11"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"name",className:"text-base",children:"Policy Name *"}),(0,t.jsx)(Y,{id:"name",name:"name",value:D.name,onChange:ew,placeholder:"Enter policy name",className:"h-11"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"premium",className:"text-base",children:"Monthly Premium (R) *"}),(0,t.jsx)(Y,{id:"premium",name:"premium",type:"number",value:D.premium,onChange:ew,min:"0",step:"50",className:"h-11"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"coverAmount",className:"text-base",children:"Cover Amount (R) *"}),(0,t.jsx)(Y,{id:"coverAmount",name:"coverAmount",type:"number",value:D.coverAmount,onChange:ew,min:"0",step:"5000",className:"h-11"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"maxDependents",className:"text-base",children:"Maximum Dependents *"}),(0,t.jsx)(Y,{id:"maxDependents",name:"maxDependents",type:"number",value:D.maxDependents,onChange:ew,min:"0",max:"10",className:"h-11"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"status",className:"text-base",children:"Status"}),(0,t.jsxs)(er,{value:D.status,onValueChange:e=>{S(a=>({...a,status:e}))},children:[(0,t.jsx)(en,{className:"h-11",children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"active",children:"Active"}),(0,t.jsx)(em,{value:"inactive",children:"Inactive"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"category",className:"text-base",children:"Category *"}),(0,t.jsxs)(er,{value:D.category,onValueChange:e=>S(a=>({...a,category:e})),children:[(0,t.jsx)(en,{className:"h-11",children:(0,t.jsx)(ei,{placeholder:"Select category"})}),(0,t.jsx)(eo,{children:q.map(e=>(0,t.jsx)(em,{value:e.name,children:e.name},e.id))})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(H,{htmlFor:"description",className:"text-base",children:"Description"}),(0,t.jsx)(ep,{id:"description",name:"description",value:D.description,onChange:ew,placeholder:"Enter policy description",className:"min-h-[120px] resize-none p-4"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(H,{className:"text-base",children:"Features"}),D.features.length>0&&(0,t.jsxs)(eu.C,{variant:"secondary",className:"h-6",children:[D.features.length," ",1===D.features.length?"feature":"features"]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(er,{value:I,onValueChange:A,children:[(0,t.jsx)(en,{className:"h-11 flex-1",children:(0,t.jsx)(ei,{placeholder:"Select a feature to add"})}),(0,t.jsx)(eo,{children:k.filter(e=>!D.features.includes(e.id)).map(e=>(0,t.jsx)(em,{value:e.name,children:e.name},e.id))})]}),(0,t.jsx)(y.z,{type:"button",onClick:eC,variant:"secondary",className:"h-11 px-6 min-w-[120px]",disabled:!I||P,children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(G.Z,{className:"h-4 w-4 mr-2"}),"Add Feature"]})})]}),D.features.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3 mt-3 max-h-[200px] overflow-y-auto p-2",children:D.features.map((e,a)=>{let s=k.find(a=>a.id===e);return(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-secondary/20 p-3 rounded-md hover:bg-secondary/30 transition-colors group",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:(null==s?void 0:s.name)||"Loading..."}),(null==s?void 0:s.description)&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:s.description})]}),(0,t.jsx)(y.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>eD(a),className:"opacity-0 group-hover:opacity-100 transition-opacity hover:bg-destructive/10",children:(0,t.jsx)(es.Z,{className:"h-4 w-4 text-red-500"})})]},e)})})]}),(0,t.jsxs)(eh.cN,{className:"flex justify-end gap-3 pt-6 border-t",children:[(0,t.jsx)(y.z,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:et,className:"h-11 px-6",children:"Cancel"}),(0,t.jsx)(y.z,{type:"submit",className:"h-11 px-8 min-w-[120px]",disabled:et,children:et?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),g?"Updating...":"Creating..."]}):g?"Update Policy":"Create Policy"})]})]})]})}),(0,t.jsx)(eh.Vq,{open:z,onOpenChange:R,children:(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:"Delete Policy"})}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)("p",{children:"Are you sure you want to delete this policy?"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:["Policy Name: ",null==B?void 0:B.name]}),(0,t.jsxs)(ex.bZ,{className:"mt-4",variant:"destructive",children:[(0,t.jsx)(ex.Cd,{children:"Warning"}),(0,t.jsx)(ex.X,{children:"This action cannot be undone. The policy will be permanently deleted."})]})]}),(0,t.jsxs)(eh.cN,{children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>R(!1),disabled:L,children:"Cancel"}),(0,t.jsx)(y.z,{variant:"destructive",onClick:eP,disabled:L,children:L?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Policy"})]})]})})]})})}var eg=s(12339),eb=s(92934),ew=s(49322),eC=s(17689),eD=s(42208),eS=s(92735),eI=s(60062),eA=s(27107),eP=s(53775);async function eM(e){let{claimNumber:a,contractNumber:s,policyDetails:t,deceasedInfo:l,bankDetails:r,documents:i,claimDetails:n}=e;try{let e=(0,ej.qs)(ev.db),c=(0,ej.JU)(ev.db,"ClaimPolicies",a);e.set(c,{...t,contractNumber:s,claimNumber:a,createdAt:(0,ej.Bt)()});let d=(0,ej.JU)(ev.db,"ClaimDeceased",a);e.set(d,{...l,contractNumber:s,claimNumber:a,createdAt:(0,ej.Bt)()});let o=(0,ej.JU)(ev.db,"ClaimBankDetails",a);e.set(o,{...r,contractNumber:s,claimNumber:a,createdAt:(0,ej.Bt)()});let m=(0,ej.JU)(ev.db,"ClaimDocuments",a);e.set(m,{documents:i,contractNumber:s,claimNumber:a,createdAt:(0,ej.Bt)()});let u=(0,ej.JU)(ev.db,"Claims",a);return e.set(u,{...n,contractNumber:s,claimNumber:a,status:"FNOL",createdAt:(0,ej.Bt)(),updatedAt:(0,ej.Bt)()}),await e.commit(),{success:!0,claimNumber:a}}catch(e){throw console.error("Error saving claim data:",e),e}}async function ek(){let e=Date.now(),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return"CLM".concat(e).concat(a)}async function eO(e){try{var a,s;let t=(0,ej.JU)(ev.db,"Claims",e),l=await (0,ej.QT)(t);if(!l.exists())return null;let r=l.data(),i=(0,ej.JU)(ev.db,"ClaimPolicies",e),n=(await (0,ej.QT)(i)).data(),c=(0,ej.JU)(ev.db,"ClaimDeceased",e),d=await (0,ej.QT)(c),o=d.exists()?d.data():void 0,m=(0,ej.JU)(ev.db,"ClaimBankDetails",e),u=(await (0,ej.QT)(m)).data(),h=(0,ej.JU)(ev.db,"ClaimDocuments",e),x=(await (0,ej.QT)(h)).data();return{claim:{claimNumber:e,contractNumber:r.contractNumber,claimantName:r.claimantName,relationship:r.relationship,serviceDate:r.serviceDate,serviceProvider:r.serviceProvider,location:r.location,status:r.status,createdAt:null===(a=r.createdAt)||void 0===a?void 0:a.toDate(),updatedAt:null===(s=r.updatedAt)||void 0===s?void 0:s.toDate()},policy:{policyNumber:null==n?void 0:n.policyNumber,holderName:null==n?void 0:n.holderName,coverageAmount:null==n?void 0:n.coverageAmount},deceased:o?{firstName:o.firstName,lastName:o.lastName,idNumber:o.idNumber,dateOfDeath:o.dateOfDeath,causeOfDeath:o.causeOfDeath,placeOfDeath:o.placeOfDeath,relationship:o.relationship}:void 0,bankDetails:{accountHolder:null==u?void 0:u.accountHolder,bankName:null==u?void 0:u.bankName,accountType:null==u?void 0:u.accountType,accountNumber:null==u?void 0:u.accountNumber,branchCode:null==u?void 0:u.branchCode},documents:(null==x?void 0:x.documents)||[]}}catch(e){throw console.error("Error fetching claim details:",e),e}}async function eZ(e,a,s,t){try{let a=(0,ej.hJ)(ev.db,"Claims"),l=[];e.contractNumber&&l.push((0,ej.ar)("contractNumber","==",e.contractNumber)),e.claimId&&l.push((0,ej.ar)("claimNumber","==",e.claimId)),"all"!==e.status&&l.push((0,ej.ar)("status","==",e.status)),e.dateFrom&&l.push((0,ej.ar)("createdAt",">=",new Date(e.dateFrom))),e.dateTo&&l.push((0,ej.ar)("createdAt","<=",new Date(e.dateTo))),l.push((0,ej.b9)(t)),s&&l.push((0,ej.TQ)(s));let r=(0,ej.IO)(a,...l),i=await (0,ej.PL)(r);return{claims:(await Promise.all(i.docs.map(async a=>{var s,t,l,r;let i=a.data(),n=a.id,[c,d,o,m]=await Promise.all([(0,ej.QT)((0,ej.JU)(ev.db,"ClaimPolicies",n)),(0,ej.QT)((0,ej.JU)(ev.db,"ClaimDeceased",n)),(0,ej.QT)((0,ej.JU)(ev.db,"ClaimBankDetails",n)),(0,ej.QT)((0,ej.JU)(ev.db,"ClaimDocuments",n))]),u=c.data(),h=d.exists()?d.data():null,x=o.data(),p=m.data();return(!e.claimantName||(null===(s=i.claimantName)||void 0===s?void 0:s.toLowerCase().includes(e.claimantName.toLowerCase())))&&("all"===e.claimType||i.serviceProvider===e.claimType)?{id:n,contractNumber:i.contractNumber,claimantName:i.claimantName,claimType:i.serviceProvider,status:i.status,amount:(null==u?void 0:u.coverageAmount)||0,description:i.location,dateSubmitted:null===(t=i.createdAt)||void 0===t?void 0:t.toDate(),lastUpdated:null===(l=i.updatedAt)||void 0===l?void 0:l.toDate(),documents:(null==p?void 0:null===(r=p.documents)||void 0===r?void 0:r.map(e=>e.url))||[],relationship:i.relationship,serviceDate:i.serviceDate,serviceProvider:i.serviceProvider,location:i.location,policy:u?{policyNumber:u.policyNumber,holderName:u.holderName,coverageAmount:u.coverageAmount}:null,deceased:h?{firstName:h.firstName,lastName:h.lastName,idNumber:h.idNumber,dateOfDeath:h.dateOfDeath,causeOfDeath:h.causeOfDeath,placeOfDeath:h.placeOfDeath,relationship:h.relationship}:null,bankDetails:x?{accountHolder:x.accountHolder,bankName:x.bankName,accountType:x.accountType,accountNumber:x.accountNumber,branchCode:x.branchCode}:null}:null}))).filter(e=>null!==e),lastVisible:i.docs[i.docs.length-1],hasMore:i.docs.length===t}}catch(e){throw console.error("Error fetching claims:",e),e}}function eE(e){var a,s,r,i,n;let{userRole:c}=e,[d,u]=(0,l.useState)("policy-lookup"),[h,x]=(0,l.useState)(!1),[p,j]=(0,l.useState)(""),[v,f]=(0,l.useState)(null),[N,g]=(0,l.useState)([]),[b,w]=(0,l.useState)({policyNumber:"",claimantName:"",claimantContact:"",relationship:"",serviceDate:"",serviceProvider:"",location:"",documents:[],accountHolder:"",bankName:"",accountType:"",accountNumber:"",branchCode:""}),[C,D]=(0,l.useState)(""),[S,I]=(0,l.useState)([]),[A,P]=(0,l.useState)(!1),[M,k]=(0,l.useState)(null),[O,E]=(0,l.useState)(!1),[F,L]=(0,l.useState)(null),[U,z]=(0,l.useState)(null),[R,B]=(0,l.useState)(!1),[J,V]=(0,l.useState)({firstName:"",lastName:"",idNumber:"",dateOfDeath:"",causeOfDeath:"",placeOfDeath:"",relationship:""}),[_,q]=(0,l.useState)(""),[X,W]=(0,l.useState)(null),[$,G]=(0,l.useState)(!1),[ee,ea]=(0,l.useState)("FNOL"),[es,et]=(0,l.useState)(null),el=async()=>{if(!p.trim()){(0,ef.Am)({variant:"destructive",title:"Error",description:"Please enter a policy number"});return}try{var e,a,s,t,l,r,i,n,c;x(!0);let d=(0,ej.hJ)(ev.db,"Contracts"),o=(0,ej.IO)(d,(0,ej.ar)("contractNumber","==",p)),m=await (0,ej.PL)(o);if(m.empty){(0,ef.Am)({variant:"destructive",title:"Not Found",description:"No contract found with the provided number"}),f(null),k(null);return}let u=m.docs[0],h=u.data(),j=(0,ej.IO)((0,ej.hJ)(ev.db,"Members"),(0,ej.ar)("idNumber","==",h.memberIdNumber)),v=await (0,ej.PL)(j),N=null===(e=v.docs[0])||void 0===e?void 0:e.data(),y=(0,ej.JU)(ev.db,"Policies",h.policiesId),g=(await (0,ej.QT)(y)).data(),b=(0,ej.IO)((0,ej.hJ)(ev.db,"Beneficiaries"),(0,ej.ar)("contractNumber","==",h.contractNumber)),C=(await (0,ej.PL)(b)).docs.map(e=>e.data()),D=(0,ej.IO)((0,ej.hJ)(ev.db,"Dependents"),(0,ej.ar)("contractNumber","==",h.contractNumber)),S=(await (0,ej.PL)(D)).docs.map(e=>e.data()),I=await Promise.all((h.cateringOptionIds||[]).map(async e=>{let a=(0,ej.JU)(ev.db,"catering",e),s=await (0,ej.QT)(a);return{id:e,...s.data()}})),A={mainMember:{personalInfo:{title:(null==N?void 0:N.title)||"",firstName:(null==N?void 0:N.firstName)||"",lastName:(null==N?void 0:N.lastName)||"",initials:(null==N?void 0:N.initials)||"",dateOfBirth:(null==N?void 0:null===(a=N.dateOfBirth)||void 0===a?void 0:a.toDate())||null,gender:(null==N?void 0:N.gender)||"",language:(null==N?void 0:N.language)||"",maritalStatus:(null==N?void 0:N.maritalStatus)||"",nationality:(null==N?void 0:N.nationality)||"",idType:(null==N?void 0:N.idType)||"South African ID",idNumber:(null==N?void 0:N.idNumber)||"",idDocumentUrl:(null==N?void 0:N.idDocumentUrl)||null},contactDetails:(null==N?void 0:N.contactDetails)||[],addressDetails:{streetAddress:(null==N?void 0:null===(s=N.addressDetails)||void 0===s?void 0:s.streetAddress)||"",city:(null==N?void 0:null===(t=N.addressDetails)||void 0===t?void 0:t.city)||"",stateProvince:(null==N?void 0:null===(l=N.addressDetails)||void 0===l?void 0:l.stateProvince)||"",postalCode:(null==N?void 0:null===(r=N.addressDetails)||void 0===r?void 0:r.postalCode)||"",country:(null==N?void 0:null===(i=N.addressDetails)||void 0===i?void 0:i.country)||""},contractNumber:h.contractNumber,contractId:u.id},beneficiaries:C.map(e=>{var a,s,t,l,r,i;return{personalInfo:{title:e.title||"",firstName:e.firstName||"",lastName:e.lastName||"",initials:e.initials||"",dateOfBirth:(null===(a=e.dateOfBirth)||void 0===a?void 0:a.toDate())||null,gender:e.gender||"",relationshipToMainMember:e.relationshipToMainMember||"",nationality:e.nationality||"",idType:e.idType||"South African ID",idNumber:e.idNumber||"",beneficiaryPercentage:e.beneficiaryPercentage||0,idDocumentUrl:e.idDocumentUrl||null},contactDetails:e.contactDetails||[],addressDetails:{streetAddress:(null===(s=e.addressDetails)||void 0===s?void 0:s.streetAddress)||"",city:(null===(t=e.addressDetails)||void 0===t?void 0:t.city)||"",stateProvince:(null===(l=e.addressDetails)||void 0===l?void 0:l.stateProvince)||"",postalCode:(null===(r=e.addressDetails)||void 0===r?void 0:r.postalCode)||"",country:(null===(i=e.addressDetails)||void 0===i?void 0:i.country)||""}}}),dependents:S.map(e=>{var a,s,t,l,r,i;return{personalInfo:{firstName:e.firstName||"",lastName:e.lastName||"",initials:e.initials||"",dateOfBirth:(null===(a=e.dateOfBirth)||void 0===a?void 0:a.toDate())||null,gender:e.gender||"",relationshipToMainMember:e.relationshipToMainMember||"",nationality:e.nationality||"",idType:e.idType||"South African ID",idNumber:e.idNumber||"",dependentStatus:e.dependentStatus||"Active",medicalAidNumber:e.medicalAidNumber,employer:e.employer,school:e.school,idDocumentUrl:e.idDocumentUrl||null},contactDetails:e.contactDetails||[],addressDetails:{streetAddress:(null===(s=e.addressDetails)||void 0===s?void 0:s.streetAddress)||"",city:(null===(t=e.addressDetails)||void 0===t?void 0:t.city)||"",stateProvince:(null===(l=e.addressDetails)||void 0===l?void 0:l.stateProvince)||"",postalCode:(null===(r=e.addressDetails)||void 0===r?void 0:r.postalCode)||"",country:(null===(i=e.addressDetails)||void 0===i?void 0:i.country)||""}}}),policiesDetails:{policiesId:h.policiesId,name:(null==g?void 0:g.name)||"Unknown Plan",coverAmount:(null==g?void 0:null===(n=g.coverAmount)||void 0===n?void 0:n.toString())||"0",premium:(null==g?void 0:g.premium)||null},cateringOptions:I,status:h.status};k(A),f({policyNumber:h.contractNumber,holderName:"".concat(null==N?void 0:N.firstName," ").concat(null==N?void 0:N.lastName),status:h.status,coverageAmount:(null==g?void 0:g.coverAmount)||0,startDate:(null===(c=h.startDate)||void 0===c?void 0:c.toDate())||new Date,type:(null==g?void 0:g.name)||"Unknown"}),w(e=>({...e,policyNumber:p}))}catch(e){console.error("Error looking up policy:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to lookup policy. Please try again."})}finally{x(!1)}},ec=async(e,a)=>{try{let s={type:a,file:e,status:"uploading"};g(e=>[...e,s]);let t=Date.now(),l="claims/".concat(p,"/").concat(a,"_").concat(t,"_").concat(e.name.replace(/[^a-zA-Z0-9.]/g,"_")),r=(0,eI.iH)(ev.t,l);await (0,eI.KV)(r,e);let i=await (0,eI.Jt)(r);g(a=>a.map(a=>a.file===e?{...a,status:"completed",url:i}:a)),(0,ef.Am)({title:"Success",description:"Document uploaded successfully"})}catch(a){console.error("Error uploading document:",a),g(a=>a.map(a=>a.file===e?{...a,status:"error"}:a)),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to upload document. Please try again."})}},ed=async()=>{try{if(B(!0),z(null),!p||!b.serviceDate||!b.serviceProvider||!b.location){z("Please fill in all required fields");return}if(!["Death Certificate","ID Document"].every(e=>N.some(a=>a.type===e&&"completed"===a.status))){z("Please upload all required documents");return}let e=await ek();if((await eM({claimNumber:e,contractNumber:(null==M?void 0:M.mainMember.contractNumber)||"",policyDetails:{policyNumber:p,holderName:(null==M?void 0:M.mainMember.personalInfo.firstName)+" "+(null==M?void 0:M.mainMember.personalInfo.lastName),coverageAmount:parseFloat((null==M?void 0:M.policiesDetails.coverAmount)||"0")},deceasedInfo:J,bankDetails:{accountHolder:b.accountHolder||"",bankName:b.bankName||"",accountType:b.accountType||"",accountNumber:b.accountNumber||"",branchCode:b.branchCode||""},documents:N.filter(e=>"completed"===e.status&&e.url).map(e=>({type:e.type,url:e.url||""})),claimDetails:{claimantName:b.claimantName,relationship:b.relationship,serviceDate:b.serviceDate,serviceProvider:b.serviceProvider,location:b.location,status:"FNOL"}})).success)L({claimNumber:e,status:"FNOL",claimantName:b.claimantName,serviceDate:b.serviceDate,serviceProvider:b.serviceProvider}),E(!0),w({policyNumber:"",claimantName:"",claimantContact:"",relationship:"",serviceDate:"",serviceProvider:"",location:"",documents:[],accountHolder:"",bankName:"",accountType:"",accountNumber:"",branchCode:""}),g([]),V({firstName:"",lastName:"",idNumber:"",dateOfDeath:"",causeOfDeath:"",placeOfDeath:"",relationship:""}),u("tracking");else throw Error("Failed to save claim data")}catch(e){console.error("Error submitting claim:",e),z("Failed to submit claim. Please try again.")}finally{B(!1)}},ep=async()=>{if(!C.trim()){(0,ef.Am)({variant:"destructive",title:"Error",description:"Please enter a claim number"});return}try{P(!0);let e=(0,ej.hJ)(ev.db,"Claims"),a=(0,ej.IO)(e,(0,ej.ar)("claimNumber","==",C)),s=await (0,ej.PL)(a);if(s.empty){(0,ef.Am)({variant:"destructive",title:"Not Found",description:"No claim found with the provided number"});return}let t=s.docs.map(e=>{var a;let s=e.data();return{claimNumber:s.claimNumber,submissionDate:(null===(a=s.submissionDate)||void 0===a?void 0:a.toDate())||new Date,status:s.status,policyNumber:s.policyNumber,claimantName:s.claimantName,documents:s.documents||[]}});I(t)}catch(e){console.error("Error tracking claim:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to track claim. Please try again."})}finally{P(!1)}},eN=e=>{switch(e.toLowerCase()){case"pending":default:return"secondary";case"approved":return"default";case"rejected":return"destructive"}},ey=async e=>{try{if(!_)return;let a=(0,ej.hJ)(ev.db,"Claims"),s=(0,ej.IO)(a,(0,ej.ar)("claimNumber","==",_)),t=await (0,ej.PL)(s);if(!t.empty){let a=t.docs[0].ref;await (0,ej.r7)(a,{status:e}),ea(e),(0,ef.Am)({title:"Success",description:"Claim status updated successfully"})}}catch(e){console.error("Error updating claim status:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to update claim status"})}};return(0,t.jsxs)("div",{className:"container mx-auto py-6 space-y-8",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Funeral Claims Processing"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Submit and track funeral benefit claims"})]}),(0,t.jsxs)(eg.mQ,{value:d,onValueChange:e=>{if(("documents"===e||"claim-form"===e||"bank-details"===e||"claim-summary"===e)&&!v){(0,ef.Am)({variant:"destructive",title:"Error",description:"Please complete policy lookup first"});return}if(("documents"===e||"bank-details"===e||"claim-summary"===e)&&!J.firstName){(0,ef.Am)({variant:"destructive",title:"Error",description:"Please complete deceased information first"});return}if(("documents"===e||"claim-summary"===e)&&(!b.bankName||!b.accountNumber||!b.branchCode||!N.some(e=>"Bank Statement"===e.type&&"completed"===e.status))){(0,ef.Am)({variant:"destructive",title:"Error",description:"Please complete bank details and upload bank statement first"});return}if("claim-summary"===e&&(!b.serviceDate||!b.serviceProvider||!b.location)){(0,ef.Am)({variant:"destructive",title:"Error",description:"Please complete all claim form details before viewing summary"});return}u(e)},children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-7",children:[(0,t.jsx)(eg.SP,{value:"policy-lookup",children:"Policy Lookup"}),(0,t.jsx)(eg.SP,{value:"deceased",children:"Deceased"}),(0,t.jsx)(eg.SP,{value:"bank-details",children:"Bank Details"}),(0,t.jsx)(eg.SP,{value:"documents",children:"Documents"}),(0,t.jsx)(eg.SP,{value:"claim-form",children:"Claim Form"}),(0,t.jsx)(eg.SP,{value:"claim-summary",children:"Summary"}),(0,t.jsx)(eg.SP,{value:"tracking",children:"Tracking"})]}),(0,t.jsx)(eg.nU,{value:"policy-lookup",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Policy Information"})}),(0,t.jsxs)(T.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(H,{htmlFor:"policyNumber",children:"Contract Number"}),(0,t.jsx)(Y,{id:"policyNumber",placeholder:"Enter contract number",value:p,onChange:e=>j(e.target.value)})]}),(0,t.jsx)(y.z,{className:"mt-8",onClick:el,disabled:h,children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Lookup Contract"]})})]}),M&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(ex.bZ,{children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Contract Found"}),(0,t.jsx)(ex.X,{children:"Contract details have been retrieved successfully."})]}),(0,t.jsx)(T.Zb,{className:"mt-6",children:(0,t.jsx)(T.aY,{className:"pt-6",children:(0,t.jsx)(eP.s,{data:M,onEdit:()=>{}})})})]})]})]})}),(0,t.jsx)(eg.nU,{value:"deceased",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{className:"pb-4",children:(0,t.jsx)(T.ll,{children:"Deceased Information"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"memberSelect",children:"Select Deceased Person"}),(0,t.jsxs)(er,{onValueChange:e=>{if(M){if("main"===e){let e=M.mainMember.personalInfo;V({firstName:e.firstName,lastName:e.lastName,idNumber:e.idNumber,dateOfDeath:"",causeOfDeath:"",placeOfDeath:"",relationship:"Main Policy Holder"}),w(e=>{var a,s,t;return{...e,claimantName:(null===(a=M.beneficiaries[0])||void 0===a?void 0:a.personalInfo.firstName)+" "+(null===(s=M.beneficiaries[0])||void 0===s?void 0:s.personalInfo.lastName),relationship:(null===(t=M.beneficiaries[0])||void 0===t?void 0:t.personalInfo.relationshipToMainMember)||"Beneficiary"}})}else{let a=M.dependents.find(a=>a.personalInfo.idNumber===e);if(a){let e=a.personalInfo;V({firstName:e.firstName,lastName:e.lastName,idNumber:e.idNumber,dateOfDeath:"",causeOfDeath:"",placeOfDeath:"",relationship:e.relationshipToMainMember}),w(e=>({...e,claimantName:M.mainMember.personalInfo.firstName+" "+M.mainMember.personalInfo.lastName,relationship:"Main Policy Holder"}))}}}},children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select person"})}),(0,t.jsxs)(eo,{children:[(0,t.jsxs)(em,{value:"main",children:[null==M?void 0:M.mainMember.personalInfo.firstName," ",null==M?void 0:M.mainMember.personalInfo.lastName," (Main Member)"]}),null==M?void 0:M.dependents.map(e=>(0,t.jsxs)(em,{value:e.personalInfo.idNumber,children:[e.personalInfo.firstName," ",e.personalInfo.lastName," (",e.personalInfo.relationshipToMainMember,")"]},e.personalInfo.idNumber))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"relationship",children:"Relationship to Policy Holder"}),(0,t.jsx)(Y,{id:"relationship",value:J.relationship,disabled:!0})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"firstName",children:"First Name"}),(0,t.jsx)(Y,{id:"firstName",value:J.firstName,onChange:e=>V(a=>({...a,firstName:e.target.value})),placeholder:"Enter first name",disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"lastName",children:"Last Name"}),(0,t.jsx)(Y,{id:"lastName",value:J.lastName,onChange:e=>V(a=>({...a,lastName:e.target.value})),placeholder:"Enter last name",disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"idNumber",children:"ID Number"}),(0,t.jsx)(Y,{id:"idNumber",value:J.idNumber,onChange:e=>V(a=>({...a,idNumber:e.target.value})),placeholder:"Enter ID number",disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"dateOfDeath",children:"Date of Death"}),(0,t.jsx)(Y,{id:"dateOfDeath",type:"date",value:J.dateOfDeath,onChange:e=>V(a=>({...a,dateOfDeath:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"causeOfDeath",children:"Cause of Death"}),(0,t.jsxs)(er,{value:J.causeOfDeath,onValueChange:e=>V(a=>({...a,causeOfDeath:e})),children:[(0,t.jsx)(en,{id:"causeOfDeath",children:(0,t.jsx)(ei,{placeholder:"Select cause"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Natural Causes",children:"Natural Causes"}),(0,t.jsx)(em,{value:"Heart Disease",children:"Heart Disease"}),(0,t.jsx)(em,{value:"Cancer",children:"Cancer"}),(0,t.jsx)(em,{value:"Respiratory Disease",children:"Respiratory Disease"}),(0,t.jsx)(em,{value:"Stroke",children:"Stroke"}),(0,t.jsx)(em,{value:"Accident",children:"Accident"}),(0,t.jsx)(em,{value:"COVID-19",children:"COVID-19"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"placeOfDeath",children:"Place of Death"}),(0,t.jsx)(Y,{id:"placeOfDeath",value:J.placeOfDeath,onChange:e=>V(a=>({...a,placeOfDeath:e.target.value})),placeholder:"Enter place"})]})]}),(0,t.jsxs)(ex.bZ,{className:"mt-2",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Important"}),(0,t.jsx)(ex.X,{children:"Please ensure all information provided is accurate and matches the death certificate."})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>u("policy-lookup"),children:"Back"}),(0,t.jsx)(y.z,{onClick:()=>u("bank-details"),children:"Next"})]})]})})]})}),(0,t.jsx)(eg.nU,{value:"bank-details",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{className:"pb-4",children:(0,t.jsx)(T.ll,{children:"Bank Details"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Account Holder Name"}),(0,t.jsx)(Y,{value:b.accountHolder||("Main Policy Holder"===J.relationship?(null==M?void 0:null===(a=M.beneficiaries[0])||void 0===a?void 0:a.personalInfo.firstName)+" "+(null==M?void 0:null===(s=M.beneficiaries[0])||void 0===s?void 0:s.personalInfo.lastName):(null==M?void 0:M.mainMember.personalInfo.firstName)+" "+(null==M?void 0:M.mainMember.personalInfo.lastName)),disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Bank Name"}),(0,t.jsxs)(er,{onValueChange:e=>w(a=>({...a,bankName:e})),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select bank"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"ABSA",children:"ABSA"}),(0,t.jsx)(em,{value:"Capitec",children:"Capitec"}),(0,t.jsx)(em,{value:"FNB",children:"FNB"}),(0,t.jsx)(em,{value:"Nedbank",children:"Nedbank"}),(0,t.jsx)(em,{value:"Standard Bank",children:"Standard Bank"})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Account Type"}),(0,t.jsxs)(er,{onValueChange:e=>w(a=>({...a,accountType:e})),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Savings",children:"Savings"}),(0,t.jsx)(em,{value:"Cheque",children:"Cheque"}),(0,t.jsx)(em,{value:"Current",children:"Current"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Account Number"}),(0,t.jsx)(Y,{value:b.accountNumber,onChange:e=>w(a=>({...a,accountNumber:e.target.value})),placeholder:"Enter account number"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Branch Code"}),(0,t.jsx)(Y,{value:b.branchCode,onChange:e=>w(a=>({...a,branchCode:e.target.value})),placeholder:"Enter branch code"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Bank Statement"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(Y,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{var a;let s=null===(a=e.target.files)||void 0===a?void 0:a[0];s&&ec(s,"Bank Statement")},disabled:N.some(e=>"Bank Statement"===e.type&&"completed"===e.status)})}),N.some(e=>"Bank Statement"===e.type&&"completed"===e.status)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Bank Statement uploaded"})]}),N.some(e=>"Bank Statement"===e.type&&"uploading"===e.status)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})]}),(0,t.jsxs)(ex.bZ,{children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Important"}),(0,t.jsx)(ex.X,{children:"Please ensure all banking details are accurate. Incorrect details may delay claim payment."})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>u("deceased"),children:"Back"}),(0,t.jsx)(y.z,{onClick:()=>u("documents"),children:"Next"})]})]})]})})]})}),(0,t.jsx)(eg.nU,{value:"documents",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Required Documents"})}),(0,t.jsxs)(T.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Mandatory Documents"}),(0,t.jsx)("div",{className:"space-y-4",children:["Death Certificate","ID Document"].map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(H,{className:"flex items-center gap-2",children:[e,(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"(Required)"})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"This document is required for claim processing"})})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(Y,{type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",id:"".concat(e,"-upload"),onChange:a=>{var s;let t=null===(s=a.target.files)||void 0===s?void 0:s[0];t&&ec(t,e)}}),(0,t.jsxs)(y.z,{type:"button",variant:N.some(a=>a.type===e)?"outline":"secondary",onClick:()=>{var a;return null===(a=document.getElementById("".concat(e,"-upload")))||void 0===a?void 0:a.click()},className:"flex items-center gap-2",children:[(0,t.jsx)(eC.Z,{className:"h-4 w-4"}),N.some(a=>a.type===e)?"Change ".concat(e):"Upload ".concat(e," *")]}),N.some(a=>a.type===e&&"completed"===a.status)&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4 text-green-500"}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e," uploaded"]})]}),N.some(a=>a.type===e&&"uploading"===a.status)&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})]})]},e))})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Additional Documents"}),(0,t.jsx)("div",{className:"space-y-4",children:["Funeral Invoice","Medical Certificate","Other"].map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(H,{className:"flex items-center gap-2",children:[e,(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"(Optional)"})}),(0,t.jsx)(Z._v,{children:(0,t.jsxs)("p",{children:["Upload ",e," if available"]})})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(Y,{type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",id:"".concat(e,"-upload"),onChange:a=>{var s;let t=null===(s=a.target.files)||void 0===s?void 0:s[0];t&&ec(t,e)}}),(0,t.jsxs)(y.z,{type:"button",variant:N.some(a=>a.type===e)?"outline":"secondary",onClick:()=>{var a;return null===(a=document.getElementById("".concat(e,"-upload")))||void 0===a?void 0:a.click()},className:"flex items-center gap-2",children:[(0,t.jsx)(eC.Z,{className:"h-4 w-4"}),N.some(a=>a.type===e)?"Change ".concat(e):"Upload ".concat(e)]}),N.some(a=>a.type===e&&"completed"===a.status)&&(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-500",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Uploaded"})]}),(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>{let a=N.find(a=>a.type===e);(null==a?void 0:a.url)&&W({url:a.url,type:e})},children:(0,t.jsx)(eD.Z,{className:"h-4 w-4"})})]}),N.some(a=>a.type===e&&"uploading"===a.status)&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})]})]},e))})]})]}),(0,t.jsxs)(ex.bZ,{children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Document Requirements"}),(0,t.jsx)(ex.X,{children:(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[(0,t.jsx)("li",{children:"Accepted formats: PDF, JPG, PNG"}),(0,t.jsx)("li",{children:"Maximum file size: 10MB per document"}),(0,t.jsx)("li",{children:"Documents must be clear and legible"}),(0,t.jsx)("li",{children:"Mandatory Documents: Death Certificate and ID Document must be uploaded"}),(0,t.jsx)("li",{children:"Optional Documents: Funeral Invoice, Medical Certificate and Other supporting documents"})]})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>u("bank-details"),children:"Back"}),(0,t.jsx)(y.z,{onClick:()=>u("claim-form"),disabled:!N.some(e=>"completed"===e.status),children:"Continue to Claim Form"})]})]})]})}),(0,t.jsx)(eg.nU,{value:"claim-form",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Claim Details"})}),(0,t.jsxs)(T.aY,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Contract Number"}),(0,t.jsx)(Y,{value:(null==M?void 0:M.mainMember.contractNumber)||"",disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Claim Number"}),(0,t.jsx)(Y,{value:_||"Will be generated on submission",disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Claimant Name"}),(0,t.jsx)(Y,{value:b.claimantName||("Main Policy Holder"===J.relationship?(null==M?void 0:null===(r=M.beneficiaries[0])||void 0===r?void 0:r.personalInfo.firstName)+" "+(null==M?void 0:null===(i=M.beneficiaries[0])||void 0===i?void 0:i.personalInfo.lastName):(null==M?void 0:M.mainMember.personalInfo.firstName)+" "+(null==M?void 0:M.mainMember.personalInfo.lastName)),onChange:e=>w(a=>({...a,claimantName:e.target.value})),disabled:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Relationship to Deceased"}),(0,t.jsx)(Y,{value:b.relationship||("Main Policy Holder"===J.relationship?(null==M?void 0:null===(n=M.beneficiaries[0])||void 0===n?void 0:n.personalInfo.relationshipToMainMember)||"Beneficiary":"Main Policy Holder"),onChange:e=>w(a=>({...a,relationship:e.target.value})),disabled:!0})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Service Date"}),(0,t.jsx)(Y,{type:"date",value:b.serviceDate,onChange:e=>w(a=>({...a,serviceDate:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Service Provider"}),(0,t.jsx)(Y,{value:b.serviceProvider,onChange:e=>w(a=>({...a,serviceProvider:e.target.value})),placeholder:"Enter service provider name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Location"}),(0,t.jsx)(Y,{value:b.location,onChange:e=>w(a=>({...a,location:e.target.value})),placeholder:"Enter service location"})]})]})]}),(0,t.jsxs)(ex.bZ,{children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Important Notice"}),(0,t.jsx)(ex.X,{children:"Please ensure all information provided is accurate. False or misleading information may result in claim rejection."})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>u("documents"),children:"Back"}),(0,t.jsx)(y.z,{onClick:ed,disabled:R,children:R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Claim"})]})]})]})}),(0,t.jsx)(eg.nU,{value:"claim-summary",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Claim Summary"})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsxs)(eg.mQ,{defaultValue:"policy",className:"w-full",children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-5",children:[(0,t.jsx)(eg.SP,{value:"policy",children:"Policy Information"}),(0,t.jsx)(eg.SP,{value:"deceased",children:"Deceased Information"}),(0,t.jsx)(eg.SP,{value:"bank",children:"Bank Details"}),(0,t.jsx)(eg.SP,{value:"documents",children:"Documents"}),(0,t.jsx)(eg.SP,{value:"claim",children:"Claim Details"})]}),(0,t.jsx)(eg.nU,{value:"policy",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Contract Number"}),(0,t.jsx)(K.pj,{children:null==M?void 0:M.mainMember.contractNumber})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Policy Holder"}),(0,t.jsxs)(K.pj,{children:[null==M?void 0:M.mainMember.personalInfo.firstName," ",null==M?void 0:M.mainMember.personalInfo.lastName]})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Cover Amount"}),(0,t.jsxs)(K.pj,{children:["R ",null==M?void 0:M.policiesDetails.coverAmount]})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Policy Status"}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(eu.C,{variant:"outline",children:(null==M?void 0:M.status)||"Active"})})]})]})})}),(0,t.jsx)(eg.nU,{value:"deceased",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Full Name"}),(0,t.jsxs)(K.pj,{children:[J.firstName," ",J.lastName]})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"ID Number"}),(0,t.jsx)(K.pj,{children:J.idNumber})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Date of Death"}),(0,t.jsx)(K.pj,{children:J.dateOfDeath})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Cause of Death"}),(0,t.jsx)(K.pj,{children:J.causeOfDeath})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Place of Death"}),(0,t.jsx)(K.pj,{children:J.placeOfDeath})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Relationship to Policy Holder"}),(0,t.jsx)(K.pj,{children:J.relationship})]})]})})}),(0,t.jsx)(eg.nU,{value:"bank",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Account Holder"}),(0,t.jsx)(K.pj,{children:b.accountHolder})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Bank Name"}),(0,t.jsx)(K.pj,{children:b.bankName})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Account Type"}),(0,t.jsx)(K.pj,{children:b.accountType})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Account Number"}),(0,t.jsx)(K.pj,{children:b.accountNumber})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Branch Code"}),(0,t.jsx)(K.pj,{children:b.branchCode})]})]})})}),(0,t.jsx)(eg.nU,{value:"documents",children:(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Mandatory Documents"}),(0,t.jsx)(K.iA,{children:(0,t.jsx)(K.RM,{children:["Death Certificate","ID Document","Bank Statement"].map(e=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:e}),(0,t.jsx)(K.pj,{children:N.some(a=>a.type===e&&"completed"===a.status)?(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-500",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Uploaded"})]}),(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>{let a=N.find(a=>a.type===e);(null==a?void 0:a.url)&&W({url:a.url,type:e})},children:(0,t.jsx)(eD.Z,{className:"h-4 w-4"})})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-yellow-500",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Pending"})]})})]},e))})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Optional Documents"}),(0,t.jsx)(K.iA,{children:(0,t.jsx)(K.RM,{children:["Funeral Invoice","Medical Certificate","Other"].map(e=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:e}),(0,t.jsx)(K.pj,{children:N.some(a=>a.type===e&&"completed"===a.status)?(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-500",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Uploaded"})]}),(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>{let a=N.find(a=>a.type===e);(null==a?void 0:a.url)&&W({url:a.url,type:e})},children:(0,t.jsx)(eD.Z,{className:"h-4 w-4"})})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Not uploaded"})]})})]},e))})})]})]})}),(0,t.jsx)(eg.nU,{value:"claim",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Claim Number"}),(0,t.jsx)(K.pj,{children:_||"Will be generated on submission"})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Claimant Name"}),(0,t.jsx)(K.pj,{children:b.claimantName})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Relationship to Deceased"}),(0,t.jsx)(K.pj,{children:b.relationship})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Service Date"}),(0,t.jsx)(K.pj,{children:b.serviceDate})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Service Provider"}),(0,t.jsx)(K.pj,{children:b.serviceProvider})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Location"}),(0,t.jsx)(K.pj,{children:b.location})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Status"}),(0,t.jsx)(K.pj,{children:(0,t.jsxs)(er,{value:ee,onValueChange:ey,children:[(0,t.jsx)(en,{className:"w-[200px]",children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"FNOL",children:"FNOL"}),(0,t.jsx)(em,{value:"under investigation",children:"Under Investigation"}),(0,t.jsx)(em,{value:"approved",children:"Approved"}),(0,t.jsx)(em,{value:"paid",children:"Paid"}),(0,t.jsx)(em,{value:"rejected",children:"Rejected"})]})]})})]})]})})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 mt-6",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>u("documents"),children:"Back to Documents"}),(0,t.jsx)(y.z,{onClick:ed,disabled:R,children:R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Claim"})]})]})]})}),(0,t.jsx)(eg.nU,{value:"tracking",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Track Claims"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(H,{htmlFor:"trackingNumber",children:"Claim Number"}),(0,t.jsx)(Y,{id:"trackingNumber",placeholder:"Enter claim number",value:C,onChange:e=>D(e.target.value)})]}),(0,t.jsx)(y.z,{className:"mt-8",onClick:ep,disabled:A,children:A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Track Claim"]})})]}),S.length>0?(0,t.jsx)("div",{className:"space-y-6",children:S.map(e=>(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold",children:["Claim #",e.claimNumber]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Submitted on ",(0,eA.WU)(e.submissionDate,"PPP")]})]}),(0,t.jsx)(eu.C,{variant:eN(e.status),children:e.status})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Claim Information"}),(0,t.jsxs)("dl",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Policy Number:"}),(0,t.jsx)("dd",{className:"font-medium",children:e.policyNumber})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Claimant:"}),(0,t.jsx)("dd",{className:"font-medium",children:e.claimantName})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Documents"}),(0,t.jsx)("ul",{className:"space-y-2 text-sm",children:e.documents.map((e,a)=>(0,t.jsxs)("li",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:e.type}),(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>window.open(e.url,"_blank"),children:(0,t.jsx)(m.Z,{className:"h-4 w-4"})})]},a))})]})]}),"Pending"===e.status&&(0,t.jsxs)(ex.bZ,{children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Claim Under Review"}),(0,t.jsx)(ex.X,{children:"Your claim is currently being processed. You will be notified of any updates."})]})]})},e.claimNumber))}):(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(o.Z,{className:"h-8 w-8"}),(0,t.jsx)("p",{children:"Enter a claim number to track its status"})]})})]})})]})})]}),(0,t.jsx)(eh.Vq,{open:null!==X,onOpenChange:e=>!e&&W(null),children:(0,t.jsxs)(eh.cZ,{className:"max-w-4xl",children:[(0,t.jsx)(eh.fK,{className:"border-b pb-4",children:(0,t.jsxs)(eh.$N,{className:"text-xl font-semibold flex items-center gap-2",children:[(0,t.jsx)(m.Z,{className:"h-5 w-5"}),null==X?void 0:X.type]})}),(0,t.jsxs)("div",{className:"flex flex-col min-h-[60vh]",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-[1fr,300px] gap-6 pt-2 flex-1",children:[(0,t.jsxs)("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden border shadow-inner",children:[(0,t.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center",children:[$&&(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-100/90 backdrop-blur-sm z-10 gap-3",children:[(0,t.jsx)(Q.Z,{className:"h-10 w-10 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground animate-pulse",children:"Loading document..."})]}),(null==X?void 0:X.url)&&(0,t.jsx)("iframe",{src:X.url,className:"w-full h-full",title:X.type})]}),(0,t.jsx)("div",{className:"aspect-[3/4] md:aspect-auto md:h-[60vh]"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm",children:[(0,t.jsxs)("h3",{className:"font-semibold mb-4 flex items-center gap-2 text-primary",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),"Document Information"]}),(0,t.jsxs)("dl",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[100px,1fr] items-center py-1 border-b",children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Type:"}),(0,t.jsx)("dd",{className:"font-medium",children:null==X?void 0:X.type})]}),(0,t.jsxs)("div",{className:"grid grid-cols-[100px,1fr] items-center py-1",children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Status:"}),(0,t.jsx)("dd",{children:(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Uploaded"})})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm",children:[(0,t.jsxs)("h3",{className:"font-semibold mb-4 flex items-center gap-2 text-primary",children:[(0,t.jsx)(eS.Z,{className:"h-4 w-4"}),"Actions"]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(y.z,{className:"w-full justify-start",variant:"outline",onClick:()=>window.open(null==X?void 0:X.url,"_blank"),children:[(0,t.jsx)(eD.Z,{className:"mr-2 h-4 w-4"}),"Open in New Tab"]}),(0,t.jsxs)(y.z,{className:"w-full justify-start",variant:"outline",onClick:()=>{let e=document.createElement("a");e.href=(null==X?void 0:X.url)||"",e.download="document-".concat(null==X?void 0:X.type),e.click()},children:[(0,t.jsx)(eS.Z,{className:"mr-2 h-4 w-4"}),"Download Document"]})]})]})]})]}),(0,t.jsx)("div",{className:"flex justify-end border-t mt-6 pt-4",children:(0,t.jsx)(y.z,{variant:"outline",onClick:()=>W(null),className:"px-8",children:"Close"})})]})]})}),(0,t.jsx)(eh.Vq,{open:O,onOpenChange:E,children:(0,t.jsxs)(eh.cZ,{className:"sm:max-w-md",children:[(0,t.jsx)(eh.fK,{children:(0,t.jsxs)(eh.$N,{className:"flex items-center gap-2 text-green-600",children:[(0,t.jsx)(eb.Z,{className:"h-5 w-5"}),"Claim Submitted Successfully"]})}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)("div",{className:"rounded-full bg-green-50 p-3",children:(0,t.jsx)(eb.Z,{className:"h-8 w-8 text-green-600"})}),(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsxs)("p",{className:"text-lg font-semibold",children:["Claim #",null==F?void 0:F.claimNumber]}),(0,t.jsx)(eu.C,{variant:"outline",className:"font-medium",children:null==F?void 0:F.status}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Please save this claim number for future reference"})]}),(0,t.jsxs)("div",{className:"w-full space-y-3 border rounded-lg p-4 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Claimant Name:"}),(0,t.jsx)("span",{className:"font-medium",children:null==F?void 0:F.claimantName})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Service Date:"}),(0,t.jsx)("span",{className:"font-medium",children:null==F?void 0:F.serviceDate})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Service Provider:"}),(0,t.jsx)("span",{className:"font-medium",children:null==F?void 0:F.serviceProvider})]})]})]})}),(0,t.jsx)(eh.cN,{children:(0,t.jsx)(y.z,{variant:"outline",onClick:()=>E(!1),children:"Close"})})]})})]})}function eF(){let[e,a]=(0,l.useState)(!1);return(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Customer Management"}),(0,t.jsx)("p",{children:"Manage customer information, interactions, and support requests here."}),(0,t.jsxs)(y.z,{id:"Add Customer",onClick:()=>a(!0),children:[(0,t.jsx)(G.Z,{className:"h-4 w-4 mr-2"}),"Add Customer"]})]})}var eT=s(31047),eL=s(92451),eU=s(17811);function ez(e){let{className:a,classNames:s,showOutsideDays:l=!0,...r}=e;return(0,t.jsx)(eU._W,{showOutsideDays:l,className:(0,A.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,A.cn)((0,y.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,A.cn)((0,y.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{...a}=e;return(0,t.jsx)(eL.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...a}=e;return(0,t.jsx)(D.Z,{className:"h-4 w-4"})}},...r})}ez.displayName="Calendar";var eR=s(51777);let eB=eR.fC,eJ=eR.xz,eV=l.forwardRef((e,a)=>{let{className:s,align:l="center",sideOffset:r=4,...i}=e;return(0,t.jsx)(eR.h_,{children:(0,t.jsx)(eR.VY,{ref:a,align:l,sideOffset:r,className:(0,A.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});function e_(e){let{date:a,onDateChange:s}=e;return(0,t.jsxs)(eB,{children:[(0,t.jsx)(eJ,{asChild:!0,children:(0,t.jsxs)(y.z,{variant:"outline",className:(0,A.cn)("w-full justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[(0,t.jsx)(eT.Z,{className:"mr-2 h-4 w-4"}),(null==a?void 0:a.from)?a.to?(0,t.jsxs)(t.Fragment,{children:[(0,eA.WU)(a.from,"LLL dd, y")," - ",(0,eA.WU)(a.to,"LLL dd, y")]}):(0,eA.WU)(a.from,"LLL dd, y"):(0,t.jsx)("span",{children:"Pick a date range"})]})}),(0,t.jsx)(eV,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(ez,{initialFocus:!0,mode:"range",defaultMonth:null==a?void 0:a.from,selected:a,onSelect:s,numberOfMonths:2})})]})}eV.displayName=eR.VY.displayName;var eq=s(61649),eX=s(2521),eY=s(2093),eW=s(53375);s(2578);var e$=s(16463),eH=s(738);let eK=(0,eH.C6)().length?(0,eH.C6)()[0]:(0,eH.ZF)({apiKey:"AIzaSyDCXIw7LJkOXlF3a4MTZA3kA3Q46gARpWU",authDomain:"data-b93ed.firebaseapp.com",projectId:"data-b93ed",storageBucket:"data-b93ed.appspot.com",messagingSenderId:"218236841715",appId:"1:218236841715:web:f34737d3fa3bc759701186"}),eQ=(0,ej.ad)(eK);function eG(){let[e,a]=(0,l.useState)(),[s,r]=(0,l.useState)("Claims"),[i,n]=(0,l.useState)([]),[c,d]=(0,l.useState)(!1),[o,u]=(0,l.useState)(0),[h,x]=(0,l.useState)([]),p=[{claimNumber:"CLM001",contractNumber:"CNT001",status:"approved",type:"death",date:new Date("2024-01-15"),amount:15e3},{claimNumber:"CLM002",contractNumber:"CNT002",status:"pending",type:"funeral",date:new Date("2024-02-20"),amount:25e3}],j=[{contractNumber:"CNT001",status:"active",policyType:"silver",cateringType:"option1",startDate:new Date("2023-12-01"),memberName:"John Doe"},{contractNumber:"CNT002",status:"active",policyType:"gold",cateringType:"option2",startDate:new Date("2024-01-10"),memberName:"Jane Smith"}],v=[{contractNumber:"CNT001",paymentMethod:"cash",status:"completed",amount:1200,date:new Date("2024-02-01"),reference:"PAY001"},{contractNumber:"CNT002",paymentMethod:"eft",status:"completed",amount:2500,date:new Date("2024-02-15"),reference:"PAY002"}],[f,N]=(0,l.useState)({claimNumber:"",contractNumber:"",status:"",type:""}),[g,b]=(0,l.useState)({status:"",policyType:"",cateringType:""}),[w,C]=(0,l.useState)({contractNumber:"",paymentMethod:"",status:""});(0,l.useEffect)(()=>{A()},[s]);let D=()=>p.filter(a=>{let s=!f.claimNumber||a.claimNumber.toLowerCase().includes(f.claimNumber.toLowerCase()),t=!f.contractNumber||a.contractNumber.toLowerCase().includes(f.contractNumber.toLowerCase()),l=!f.status||a.status===f.status,r=!f.type||a.type===f.type,i=null==e||!e.from||null==e||!e.to||a.date>=e.from&&a.date<=e.to;return s&&t&&l&&r&&i}),S=()=>j.filter(a=>{let s=!g.status||a.status===g.status,t=!g.policyType||a.policyType===g.policyType,l=!g.cateringType||a.cateringType===g.cateringType,r=null==e||!e.from||null==e||!e.to||a.startDate>=e.from&&a.startDate<=e.to;return s&&t&&l&&r}),I=()=>v.filter(a=>{let s=!w.contractNumber||a.contractNumber.toLowerCase().includes(w.contractNumber.toLowerCase()),t=!w.paymentMethod||a.paymentMethod===w.paymentMethod,l=!w.status||a.status===w.status,r=null==e||!e.from||null==e||!e.to||a.date>=e.from&&a.date<=e.to;return s&&t&&l&&r}),A=()=>{d(!0);let e=[];switch(s){case"Claims":e=D();break;case"contracts":e=S();break;case"payments":e=I()}x(e),d(!1)},P=async()=>{if("Claims"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Claims")),s=[];if(f.claimNumber.trim()){let e=f.claimNumber.trim();s.push((0,ej.ar)("claimNumber",">=",e),(0,ej.ar)("claimNumber","<=",e+""))}f.contractNumber.trim()&&s.push((0,ej.ar)("contractNumber","==",f.contractNumber.trim())),f.status&&"all"!==f.status&&s.push((0,ej.ar)("status","==",f.status)),f.type&&"all"!==f.type&&s.push((0,ej.ar)("type","==",f.type)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Claims"),...s));let t=await (0,ej.PL)(a);if(t.empty){alert("No data found matching your criteria");return}let l=t.docs.map(e=>({id:e.id,claimNumber:e.data().claimNumber,contractNumber:e.data().contractNumber,status:e.data().status,type:e.data().type,date:e.data().createdAt,lastUpdated:e.data().lastUpdated,amount:e.data().amount}));try{(null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(l=l.filter(a=>{let s=a.date.toDate();return s>=e.from&&s<=e.to}))}catch(e){alert("Error processing dates. Please check your date range selection.");return}if(0===l.length){alert("No claims found for the selected criteria");return}let r=l.map(e=>({"Claim Number":e.claimNumber||"N/A","Contract Number":e.contractNumber||"N/A",Status:e.status||"N/A",Type:e.type||"N/A","Created Date":(0,eA.WU)(e.date.toDate(),"dd/MM/yyyy")||"N/A",lastUpdated:(0,eA.WU)(e.lastUpdated.toDate(),"dd/MM/yyyy")||"N/A"})),i=eY.P6.json_to_sheet(r),n=eY.P6.book_new();eY.P6.book_append_sheet(n,i,"Claims Report"),eY.NC(n,"Claims_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".xlsx"))}catch(e){console.error("Error fetching claims:",e),alert("An error occurred while generating the report. Please try again.")}finally{d(!1)}}if("contracts"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Contracts")),s=[];g.status&&"all"!==g.status&&s.push((0,ej.ar)("status","==",g.status)),g.policyType&&"all"!==g.policyType&&s.push((0,ej.ar)("policyType","==",g.policyType)),g.cateringType&&"all"!==g.cateringType&&s.push((0,ej.ar)("cateringType","==",g.cateringType)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Contracts"),...s));let t=await (0,ej.PL)(a);if(t.empty){alert("No data found matching your criteria");return}let l=t.docs.map(e=>({id:e.id,contractNumber:e.data().contractNumber,memberIdNumber:e.data().memberIdNumber,status:e.data().status,policyType:e.data().policyType,cateringOptionIds:e.data().cateringOptionIds,createdAt:e.data().createdAt,policiesId:e.data().policiesId}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(l=l.filter(a=>{let s=a.createdAt.toDate();return s>=e.from&&s<=e.to})),0===l.length){alert("No contracts found for the selected criteria");return}let r=l.map(e=>({"Contract Number":e.contractNumber||"N/A","Member ID Number":e.memberIdNumber||"N/A",Status:e.status||"N/A","Policy Type":e.policyType||"N/A","Catering Options":e.cateringOptionIds||"N/A","Created Date":(0,eA.WU)(e.createdAt.toDate(),"dd/MM/yyyy")||"N/A","Policies ID":e.policiesId||"N/A"})),i=eY.P6.json_to_sheet(r),n=eY.P6.book_new();eY.P6.book_append_sheet(n,i,"Contracts Report"),eY.NC(n,"Contracts_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".xlsx"))}catch(e){console.error("Error fetching contracts:",e),alert("An error occurred while generating the report. Please try again.")}finally{d(!1)}}if("payments"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Payments")),s=[];w.contractNumber.trim()&&s.push((0,ej.ar)("contractNumber","==",w.contractNumber.trim())),w.paymentMethod&&"all"!==w.paymentMethod&&s.push((0,ej.ar)("paymentMethod","==",w.paymentMethod)),w.status&&"all"!==w.status&&s.push((0,ej.ar)("status","==",w.status)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Payments"),...s));let t=await (0,ej.PL)(a);if(t.empty){alert("No data found matching your criteria");return}let l=t.docs.map(e=>({id:e.id,contractNumber:e.data().contractNumber,reference:e.data().reference,paymentMethod:e.data().paymentMethod,status:e.data().status,amount:e.data().amount,paymentDate:e.data().paymentDate,receiptUrl:e.data().receiptUrl}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(l=l.filter(a=>{let s=a.paymentDate.toDate();return s>=e.from&&s<=e.to})),0===l.length){alert("No payments found for the selected criteria");return}let r=l.map(e=>({"Contract Number":e.contractNumber||"N/A",Reference:e.reference||"N/A","Payment Method":e.paymentMethod||"N/A",Status:e.status||"N/A",Amount:e.amount?"R ".concat(e.amount.toLocaleString()):"N/A","Created Date":(0,eA.WU)(e.paymentDate.toDate(),"dd/MM/yyyy")||"N/A",receiptUrl:e.receiptUrl||"N/A"})),i=eY.P6.json_to_sheet(r),n=eY.P6.book_new();eY.P6.book_append_sheet(n,i,"Payments Report"),eY.NC(n,"Payments_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".xlsx"))}catch(e){console.error("Error fetching payments:",e),alert("An error occurred while generating the report. Please try again.")}finally{d(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(()=>(0,t.jsx)(eh.Vq,{open:c,children:(0,t.jsx)(eh.cZ,{className:"flex flex-col items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)(Q.Z,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("p",{children:"Generating report, please wait..."})]})})}),{}),(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h2",{className:"text-2xl font-semibold",children:"Reports and Analytics"})}),(0,t.jsxs)(eg.mQ,{value:s,onValueChange:r,children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-3 mb-8",children:[(0,t.jsx)(eg.SP,{value:"Claims",children:"Claims Report"}),(0,t.jsx)(eg.SP,{value:"contracts",children:"Contract Report"}),(0,t.jsx)(eg.SP,{value:"payments",children:"Payment Report"})]}),(0,t.jsx)(eg.nU,{value:"Claims",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Claims Report"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Claim Number"}),(0,t.jsx)(Y,{placeholder:"Enter claim number",className:"w-full",value:f.claimNumber,onChange:e=>N({...f,claimNumber:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Contract Number"}),(0,t.jsx)(Y,{placeholder:"Enter contract number",className:"w-full",value:f.contractNumber,onChange:e=>N({...f,contractNumber:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Status"}),(0,t.jsxs)(er,{value:f.status,onValueChange:e=>N({...f,status:e}),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Status"}),(0,t.jsx)(em,{value:"approved",children:"Approved"}),(0,t.jsx)(em,{value:"pending",children:"Pending"}),(0,t.jsx)(em,{value:"rejected",children:"Rejected"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Claim Type"}),(0,t.jsxs)(er,{value:f.type,onValueChange:e=>N({...f,type:e}),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Types"}),(0,t.jsx)(em,{value:"death",children:"Death"}),(0,t.jsx)(em,{value:"funeral",children:"Funeral"})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Date Range"}),(0,t.jsx)(e_,{date:e,onDateChange:a})]})]})})]})}),(0,t.jsx)(eg.nU,{value:"contracts",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Contract Report"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Status"}),(0,t.jsxs)(er,{children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Status"}),(0,t.jsx)(em,{value:"active",children:"Active"}),(0,t.jsx)(em,{value:"inactive",children:"Inactive"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Policy Type"}),(0,t.jsxs)(er,{children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select policy"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Policies"}),(0,t.jsx)(em,{value:"silver",children:"Silver"}),(0,t.jsx)(em,{value:"gold",children:"Gold"}),(0,t.jsx)(em,{value:"platinum",children:"Platinum"})]})]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Catering Type"}),(0,t.jsxs)(er,{children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select catering"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Types"}),(0,t.jsx)(em,{value:"option1",children:"Option 1"}),(0,t.jsx)(em,{value:"option2",children:"Option 2"}),(0,t.jsx)(em,{value:"option3",children:"Option 3"}),(0,t.jsx)(em,{value:"option4",children:"Option 4"})]})]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Date Range"}),(0,t.jsx)(e_,{date:e,onDateChange:a})]})]})})]})}),(0,t.jsx)(eg.nU,{value:"payments",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Payment Report"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"grid gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Contract Number"}),(0,t.jsx)(Y,{placeholder:"Enter contract number",className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Payment Method"}),(0,t.jsxs)(er,{children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select method"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Methods"}),(0,t.jsx)(em,{value:"cash",children:"Cash"}),(0,t.jsx)(em,{value:"card",children:"Card"}),(0,t.jsx)(em,{value:"eft",children:"EFT"})]})]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Status"}),(0,t.jsxs)(er,{children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Status"}),(0,t.jsx)(em,{value:"completed",children:"Completed"}),(0,t.jsx)(em,{value:"pending",children:"Pending"}),(0,t.jsx)(em,{value:"failed",children:"Failed"})]})]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{children:"Date Range"}),(0,t.jsx)(e_,{date:e,onDateChange:a})]})]})})]})}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 mt-6",children:[(0,t.jsxs)(y.z,{id:"Export Excel",variant:"outline",className:"flex items-center gap-2",onClick:P,children:[(0,t.jsx)(eq.Z,{className:"h-4 w-4"}),"Export Excel"]}),(0,t.jsxs)(y.z,{id:"Export CSV",variant:"outline",className:"flex items-center gap-2",onClick:()=>{if("Claims"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Claims")),s=[];if(f.claimNumber.trim()){let e=f.claimNumber.trim();s.push((0,ej.ar)("claimNumber",">=",e),(0,ej.ar)("claimNumber","<=",e+""))}f.contractNumber.trim()&&s.push((0,ej.ar)("contractNumber","==",f.contractNumber.trim())),f.status&&"all"!==f.status&&s.push((0,ej.ar)("status","==",f.status)),f.type&&"all"!==f.type&&s.push((0,ej.ar)("type","==",f.type)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Claims"),...s)),(0,ej.PL)(a).then(a=>{if(a.empty){alert("No data found matching your criteria");return}let s=a.docs.map(e=>({id:e.id,claimNumber:e.data().claimNumber,contractNumber:e.data().contractNumber,status:e.data().status,type:e.data().type,date:e.data().createdAt,lastUpdated:e.data().lastUpdated,amount:e.data().amount}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(s=s.filter(a=>{let s=a.date.toDate();return s>=e.from&&s<=e.to})),0===s.length){alert("No claims found for the selected criteria");return}let t=s.map(e=>({"Claim Number":e.claimNumber||"N/A","Contract Number":e.contractNumber||"N/A",Status:e.status||"N/A",Type:e.type||"N/A","Created Date":(0,eA.WU)(e.date.toDate(),"dd/MM/yyyy")||"N/A","Last Updated":(0,eA.WU)(e.lastUpdated.toDate(),"dd/MM/yyyy")||"N/A"})),l=new e$._b({fields:["Claim Number","Contract Number","Status","Type","Created Date","Last Updated"]}).parse(t),r=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(r),i.download="Claims_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".csv"),i.click()}).catch(e=>{console.error("Error fetching claims:",e),alert("An error occurred while generating the CSV. Please try again.")}).finally(()=>{d(!1)})}catch(e){console.error("Error:",e),alert("An error occurred. Please try again."),d(!1)}}if("contracts"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Contracts")),s=[];g.status&&"all"!==g.status&&s.push((0,ej.ar)("status","==",g.status)),g.policyType&&"all"!==g.policyType&&s.push((0,ej.ar)("policyType","==",g.policyType)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Contracts"),...s)),(0,ej.PL)(a).then(a=>{if(a.empty){alert("No data found matching your criteria");return}let s=a.docs.map(e=>({id:e.id,contractNumber:e.data().contractNumber,memberIdNumber:e.data().memberIdNumber,status:e.data().status,policyType:e.data().policyType,cateringOptionIds:e.data().cateringOptionIds,createdAt:e.data().createdAt,policiesId:e.data().policiesId}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(s=s.filter(a=>{let s=a.createdAt.toDate();return s>=e.from&&s<=e.to})),0===s.length){alert("No contracts found for the selected criteria");return}let t=s.map(e=>({"Contract Number":e.contractNumber||"N/A","Member ID Number":e.memberIdNumber||"N/A",Status:e.status||"N/A","Policy Type":e.policyType||"N/A","Catering Options":e.cateringOptionIds||"N/A","Created Date":(0,eA.WU)(e.createdAt.toDate(),"dd/MM/yyyy")||"N/A","Policies ID":e.policiesId||"N/A"})),l=new e$._b({fields:["Contract Number","Member ID Number","Status","Policy Type","Catering Options","Created Date","Policies ID"]}).parse(t),r=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(r),i.download="Contracts_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".csv"),i.click()}).catch(e=>{console.error("Error fetching contracts:",e),alert("An error occurred while generating the CSV. Please try again.")}).finally(()=>{d(!1)})}catch(e){console.error("Error:",e),alert("An error occurred. Please try again."),d(!1)}}if("payments"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Payments")),s=[];w.contractNumber.trim()&&s.push((0,ej.ar)("contractNumber","==",w.contractNumber.trim())),w.paymentMethod&&"all"!==w.paymentMethod&&s.push((0,ej.ar)("paymentMethod","==",w.paymentMethod)),w.status&&"all"!==w.status&&s.push((0,ej.ar)("status","==",w.status)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Payments"),...s)),(0,ej.PL)(a).then(a=>{if(a.empty){alert("No data found matching your criteria");return}let s=a.docs.map(e=>({id:e.id,contractNumber:e.data().contractNumber,reference:e.data().reference,paymentMethod:e.data().paymentMethod,status:e.data().status,amount:e.data().amount,paymentDate:e.data().paymentDate,receiptUrl:e.data().receiptUrl}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(s=s.filter(a=>{let s=a.paymentDate.toDate();return s>=e.from&&s<=e.to})),0===s.length){alert("No payments found for the selected criteria");return}let t=s.map(e=>({"Contract Number":e.contractNumber||"N/A",Reference:e.reference||"N/A","Payment Method":e.paymentMethod||"N/A",Status:e.status||"N/A",Amount:e.amount?"R ".concat(e.amount.toLocaleString()):"N/A","Created Date":(0,eA.WU)(e.paymentDate.toDate(),"dd/MM/yyyy")||"N/A",receiptUrl:e.receiptUrl||"N/A"})),l=new e$._b({fields:["Contract Number","Reference","Payment Method","Status","Amount","Created Date","Last Updated"]}).parse(t),r=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(r),i.download="Payments_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".csv"),i.click()}).catch(e=>{console.error("Error fetching payments:",e),alert("An error occurred while generating the CSV. Please try again.")}).finally(()=>{d(!1)})}catch(e){console.error("Error:",e),alert("An error occurred. Please try again."),d(!1)}}},children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),"Export CSV"]}),(0,t.jsxs)(y.z,{id:"Export PDF",variant:"outline",className:"flex items-center gap-2",onClick:()=>{if("Claims"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Claims")),s=[];if(f.claimNumber.trim()){let e=f.claimNumber.trim();s.push((0,ej.ar)("claimNumber",">=",e),(0,ej.ar)("claimNumber","<=",e+""))}f.contractNumber.trim()&&s.push((0,ej.ar)("contractNumber","==",f.contractNumber.trim())),f.status&&"all"!==f.status&&s.push((0,ej.ar)("status","==",f.status)),f.type&&"all"!==f.type&&s.push((0,ej.ar)("type","==",f.type)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Claims"),...s)),(0,ej.PL)(a).then(a=>{if(a.empty){alert("No data found matching your criteria");return}let s=a.docs.map(e=>({id:e.id,claimNumber:e.data().claimNumber,contractNumber:e.data().contractNumber,status:e.data().status,type:e.data().type,date:e.data().createdAt,lastUpdated:e.data().lastUpdated,amount:e.data().amount}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(s=s.filter(a=>{let s=a.date.toDate();return s>=e.from&&s<=e.to})),0===s.length){alert("No claims found for the selected criteria");return}let t=new eW.jsPDF,l=s.map(e=>[e.claimNumber||"N/A",e.contractNumber||"N/A",e.status||"N/A",e.type||"N/A",(0,eA.WU)(e.date.toDate(),"dd/MM/yyyy")||"N/A",(0,eA.WU)(e.lastUpdated.toDate(),"dd/MM/yyyy")||"N/A"]);t.autoTable({head:[["Claim Number","Contract Number","Status","Type","Created Date","Last Updated"]],body:l,startY:20,headStyles:{fillColor:[41,128,185]}}),t.save("Claims_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".pdf"))}).catch(e=>{console.error("Error fetching claims:",e),alert("An error occurred while generating the PDF. Please try again.")}).finally(()=>{d(!1)})}catch(e){console.error("Error:",e),alert("An error occurred. Please try again."),d(!1)}}if("contracts"===s){d(!0);try{let a=(0,ej.IO)((0,ej.hJ)(eQ,"Contracts")),s=[];g.status&&"all"!==g.status&&s.push((0,ej.ar)("status","==",g.status)),g.policyType&&"all"!==g.policyType&&s.push((0,ej.ar)("policyType","==",g.policyType)),s.length>0&&(a=(0,ej.IO)((0,ej.hJ)(eQ,"Contracts"),...s)),(0,ej.PL)(a).then(a=>{if(a.empty){alert("No data found matching your criteria");return}let s=a.docs.map(e=>({id:e.id,contractNumber:e.data().contractNumber,memberIdNumber:e.data().memberIdNumber,status:e.data().status,policyType:e.data().policyType,cateringOptionIds:e.data().cateringOptionIds,createdAt:e.data().createdAt,policiesId:e.data().policiesId}));if((null==e?void 0:e.from)&&(null==e?void 0:e.to)&&(s=s.filter(a=>{let s=a.createdAt.toDate();return s>=e.from&&s<=e.to})),0===s.length){alert("No contracts found for the selected criteria");return}let t=new eW.jsPDF,l=s.map(e=>[e.contractNumber||"N/A",e.memberIdNumber||"N/A",e.status||"N/A",e.policyType||"N/A",e.cateringOptionIds||"N/A",(0,eA.WU)(e.createdAt.toDate(),"dd/MM/yyyy")||"N/A",e.policiesId||"N/A"]);t.autoTable({head:[["Contract Number","Member ID Number","Status","Policy Type","Catering Options","Created Date","Policies ID"]],body:l,startY:20,headStyles:{fillColor:[41,128,185]}}),t.save("Contracts_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".pdf"))}).catch(e=>{console.error("Error fetching contracts:",e),alert("An error occurred while generating the PDF. Please try again.")}).finally(()=>{d(!1)})}catch(e){console.error("Error:",e),alert("An error occurred. Please try again."),d(!1)}}if("payments"===s){let e=new eW.jsPDF,a=i.map(e=>[e.contractNumber,e.reference,e.paymentMethod,e.status,"R ".concat(e.amount.toLocaleString()),(0,eA.WU)(e.date,"dd/MM/yyyy")]);e.autoTable({head:[["Contract Number","Reference","Payment Method","Status","Amount","Date"]],body:a,startY:20,headStyles:{fillColor:[41,128,185]}}),e.save("Payments_Report_".concat((0,eA.WU)(new Date,"dd-MM-yyyy"),".pdf"))}},children:[(0,t.jsx)(eX.Z,{className:"h-4 w-4"}),"Export PDF"]})]})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{}),(0,t.jsx)(K.RM,{})]})})]})}var e0=s(60610);let e4=l.forwardRef((e,a)=>{let{className:s,value:l,...r}=e;return(0,t.jsx)(e0.fC,{ref:a,className:(0,A.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:(0,t.jsx)(e0.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});function e1(e){let{selected:a,onSelect:s,id:r,className:i}=e,[n,c]=l.useState(!1);return(0,t.jsx)("div",{className:i,children:(0,t.jsxs)(eB,{open:n,onOpenChange:c,children:[(0,t.jsx)(eJ,{asChild:!0,children:(0,t.jsxs)(y.z,{id:r,variant:"outline",className:(0,A.cn)("w-full justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[(0,t.jsx)(eT.Z,{className:"mr-2 h-4 w-4"}),a?(0,eA.WU)(a,"dd/MM/yyyy"):"Pick a date"]})}),(0,t.jsx)(eV,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(ez,{mode:"single",selected:a||void 0,onSelect:e=>{s(null!=e?e:null),c(!1)},initialFocus:!0})})]})})}function e2(e){let a={isValid:!0,errors:[]};if(13!==e.length)return a.errors.push("ID number must be exactly 13 digits"),a.isValid=!1,a;if(!/^\d+$/.test(e))return a.errors.push("ID number must contain only numeric digits"),a.isValid=!1,a;let s=parseInt(e.substring(0,2)),t=parseInt(e.substring(2,4)),l=parseInt(e.substring(4,6)),r=new Date(parseInt((s>22?"19":"20")+s),t-1,l);isNaN(r.getTime())||t<1||t>12||l<1||l>31?(a.errors.push("Invalid date of birth in ID number"),a.isValid=!1):r>new Date?(a.errors.push("Date of birth cannot be in the future"),a.isValid=!1):a.dateOfBirth=r;let i=parseInt(e.substring(6,10));switch(a.gender=i<5e3?"Female":"Male",parseInt(e.substring(10,11))){case 0:a.citizenship="Citizen";break;case 1:a.citizenship="Permanent Resident";break;default:a.citizenship="Other",a.errors.push("Invalid citizenship digit"),a.isValid=!1}let n=0,c=!1;for(let a=e.length-1;a>=0;a--){let s=parseInt(e.charAt(a));c&&(s*=2)>9&&(s-=9),n+=s,c=!c}return n%10!=0&&(a.errors.push("Invalid ID number checksum"),a.isValid=!1),a}function e5(e){let{data:a,updateData:s,errors:r}=e,[i,n]=(0,l.useState)(a.personalInfo),[c,d]=(0,l.useState)(a.contactDetails),[o,m]=(0,l.useState)(a.addressDetails),[u,h]=(0,l.useState)("personal-info"),[x,p]=(0,l.useState)("idle"),[j,v]=(0,l.useState)([]);(0,l.useEffect)(()=>{n(a.personalInfo),d(a.contactDetails),m(a.addressDetails)},[a]);let f=async(e,a)=>{let t={...i,[e]:a};if("idNumber"===e&&"string"==typeof a&&"South African ID"===t.idType){let e=e2(a);if(v(e.errors),e.isValid){try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Contracts"),(0,ej.ar)("memberIdNumber","==",a)),s=await (0,ej.PL)(e);if(!s.empty){let e=s.docs[0].data();v(["A contract already exists with this ID number (Contract Number: ".concat(e.contractNumber,")")]);return}}catch(e){console.error("Error checking for existing contract:",e),v(["Error checking for existing contract. Please try again."]);return}e.dateOfBirth&&(t.dateOfBirth=e.dateOfBirth),e.gender&&(t.gender=e.gender)}else e.dateOfBirth&&(t.dateOfBirth=e.dateOfBirth),e.gender&&(t.gender=e.gender)}"idType"===e&&v([]),n(t),s({personalInfo:t,contactDetails:c,addressDetails:o})},N=(e,a,t)=>{let l=[...c];l[e]={...l[e],[a]:t},d(l),s({personalInfo:i,contactDetails:l,addressDetails:o})},g=e=>{let a=c.filter((a,s)=>s!==e);d(a),s({personalInfo:i,contactDetails:a,addressDetails:o})},b=(e,a)=>{let t={...o,[e]:a};m(t),s({personalInfo:i,contactDetails:c,addressDetails:t})},w=async e=>{var a;if(null===(a=e.target.files)||void 0===a?void 0:a[0]){p("uploading");try{p("success")}catch(e){console.error("Error uploading file:",e),p("error")}}};return(0,t.jsxs)("div",{className:"space-y-4",children:[r&&(()=>{if(!r)return null;let e=Object.keys(r).some(e=>["title","firstName","lastName","initials","dateOfBirth","gender","language","maritalStatus","nationality","idType","idNumber"].includes(e)),a=Object.keys(r).some(e=>"contacts"===e||e.startsWith("contact")),s=Object.keys(r).some(e=>["streetAddress","city","stateProvince","postalCode","country"].includes(e)),l=[];return e&&"personal-info"!==u&&l.push("Personal Information"),a&&"contact-details"!==u&&l.push("Contact Details"),s&&"address-details"!==u&&l.push("Address Details"),l.length>0?(0,t.jsxs)("div",{className:"mb-4 text-sm text-amber-600 bg-amber-50 p-2 rounded border border-amber-200",children:["Please complete required fields in: ",l.join(", ")]}):null})(),(0,t.jsxs)(eg.mQ,{value:u,onValueChange:h,className:"w-full",children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(eg.SP,{value:"personal-info","data-state":"personal-info"===u?"active":"inactive",children:"Personal Information"}),(0,t.jsx)(eg.SP,{value:"contact-details","data-state":"contact-details"===u?"active":"inactive",children:"Contact Details"}),(0,t.jsx)(eg.SP,{value:"address-details","data-state":"address-details"===u?"active":"inactive",children:"Address Details"})]}),(0,t.jsx)(eg.nU,{value:"personal-info","data-state":"personal-info"===u?"active":"inactive",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"flex gap-3 col-span-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(H,{htmlFor:"type-of-id",children:"Type of ID"}),(0,t.jsxs)(er,{value:i.idType,onValueChange:e=>f("idType",e),children:[(0,t.jsx)(en,{id:"type-of-id",className:(null==r?void 0:r.idType)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select ID type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South African ID",children:"South African ID"}),(0,t.jsx)(em,{value:"Passport",children:"Passport"})]})]}),(null==r?void 0:r.idType)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.idType})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)(H,{htmlFor:"id-input",children:["ID Number / Passport Number","South African ID"===i.idType&&(0,t.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"(13 digits)"})]}),(0,t.jsx)(Y,{id:"id-input","data-testid":"id-input","aria-label":"ID Number / Passport Number",value:i.idNumber,onChange:e=>f("idNumber",e.target.value),className:(null==r?void 0:r.idNumber)?"border-red-500":""}),(null==r?void 0:r.idNumber)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.idNumber})]})]}),"South African ID"===i.idType&&j.length>0&&(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mt-1",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.X,{children:(0,t.jsx)("ul",{className:"list-disc pl-4",children:j.map((e,a)=>(0,t.jsx)("li",{className:"text-sm",children:e},a))})})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"title",children:"Title"}),(0,t.jsxs)(er,{value:i.title,onValueChange:e=>f("title",e),children:[(0,t.jsx)(en,{id:"title",className:(null==r?void 0:r.title)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select title"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Mr",children:"Mr"}),(0,t.jsx)(em,{value:"Mrs",children:"Mrs"}),(0,t.jsx)(em,{value:"Ms",children:"Ms"}),(0,t.jsx)(em,{value:"Dr",children:"Dr"})]})]}),(null==r?void 0:r.title)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.title})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"firstName",children:"First Name"}),(0,t.jsx)(Y,{id:"firstName",value:i.firstName,onChange:e=>f("firstName",e.target.value),className:(null==r?void 0:r.firstName)?"border-red-500":""}),(null==r?void 0:r.firstName)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.firstName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"lastName",children:"Last Name"}),(0,t.jsx)(Y,{id:"lastName",value:i.lastName,onChange:e=>f("lastName",e.target.value),className:(null==r?void 0:r.lastName)?"border-red-500":""}),(null==r?void 0:r.lastName)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.lastName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"initials",children:"Initials"}),(0,t.jsx)(Y,{id:"initials",value:i.initials,onChange:e=>f("initials",e.target.value),className:(null==r?void 0:r.initials)?"border-red-500":""}),(null==r?void 0:r.initials)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.initials})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"dateofbirth",children:"Date of Birth"}),(0,t.jsx)(e1,{id:"dateofbirth",selected:i.dateOfBirth,onSelect:e=>f("dateOfBirth",e),className:(null==r?void 0:r.dateOfBirth)?"border-red-500":""}),(null==r?void 0:r.dateOfBirth)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.dateOfBirth})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"gender",children:"Gender"}),(0,t.jsxs)(er,{value:i.gender,onValueChange:e=>f("gender",e),children:[(0,t.jsx)(en,{id:"gender",className:(null==r?void 0:r.gender)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select gender"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Male",children:"Male"}),(0,t.jsx)(em,{value:"Female",children:"Female"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==r?void 0:r.gender)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.gender})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"language",children:"Language"}),(0,t.jsxs)(er,{value:i.language,onValueChange:e=>f("language",e),children:[(0,t.jsx)(en,{id:"language",className:(null==r?void 0:r.language)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select language"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"English",children:"English"}),(0,t.jsx)(em,{value:"Afrikaans",children:"Afrikaans"}),(0,t.jsx)(em,{value:"Zulu",children:"Zulu"}),(0,t.jsx)(em,{value:"Xhosa",children:"Xhosa"}),(0,t.jsx)(em,{value:"Sotho",children:"Sotho"}),(0,t.jsx)(em,{value:"Tswana",children:"Tswana"})]})]}),(null==r?void 0:r.language)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.language})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"marital-status",children:"Marital Status"}),(0,t.jsxs)(er,{value:i.maritalStatus,onValueChange:e=>f("maritalStatus",e),children:[(0,t.jsx)(en,{id:"marital-status",className:(null==r?void 0:r.maritalStatus)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select marital status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{id:"single","data-value":"Single",value:"Single",children:"Single"}),(0,t.jsx)(em,{id:"married","data-value":"Married",value:"Married",children:"Married"}),(0,t.jsx)(em,{id:"divorced","data-value":"Divorced",value:"Divorced",children:"Divorced"}),(0,t.jsx)(em,{id:"widowed","data-value":"Widowed",value:"Widowed",children:"Widowed"})]})]}),(null==r?void 0:r.maritalStatus)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.maritalStatus})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"nationality",children:"Nationality"}),(0,t.jsxs)(er,{value:i.nationality,onValueChange:e=>f("nationality",e),children:[(0,t.jsx)(en,{id:"nationality",className:(null==r?void 0:r.nationality)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select nationality"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{id:"South African","data-value":"South African",value:"South African",children:"South African"}),(0,t.jsx)(em,{id:"Zimbabwean","data-value":"Zimbabwean",value:"Zimbabwean",children:"Zimbabwean"}),(0,t.jsx)(em,{id:"Mozambican","data-value":"Mozambican",value:"Mozambican",children:"Mozambican"}),(0,t.jsx)(em,{id:"Namibian","data-value":"Namibian",value:"Namibian",children:"Namibian"}),(0,t.jsx)(em,{id:"Botswanan","data-value":"Botswanan",value:"Botswanan",children:"Botswanan"}),(0,t.jsx)(em,{id:"Other","data-value":"Other",value:"Other",children:"Other"})]})]}),(null==r?void 0:r.nationality)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.nationality})]}),(0,t.jsxs)("div",{className:"col-span-3",children:[(0,t.jsx)(H,{htmlFor:"iddocument",children:"ID Document"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(Y,{id:"iddocument",type:"file",accept:".pdf",onChange:w,"aria-label":"ID Document",className:"flex-1"}),i.idDocumentUrl&&(0,t.jsx)("a",{href:i.idDocumentUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 hover:text-blue-700",children:"View Document"})]}),"uploading"===x&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Uploading..."}),"success"===x&&(0,t.jsx)("p",{className:"text-sm text-green-500 mt-1",children:"Upload successful"}),"error"===x&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:"Upload failed. Please try again."})]})]})})}),(0,t.jsx)(eg.nU,{value:"contact-details","data-state":"contact-details"===u?"active":"inactive",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(null==r?void 0:r.contacts)&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.X,{children:r.contacts})]}),c.map((e,a)=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(er,{value:e.type,onValueChange:e=>N(a,"type",e),children:[(0,t.jsx)(en,{className:(null==r?void 0:r["contact".concat(a)])?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select contact type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Email",children:"Email"}),(0,t.jsx)(em,{value:"Phone Number",children:"Phone Number"})]})]})}),(0,t.jsx)("div",{className:"flex-[2]",children:(0,t.jsx)(Y,{value:e.value,onChange:e=>N(a,"value",e.target.value),className:(null==r?void 0:r["contact".concat(a)])?"border-red-500":"",placeholder:"Email"===e.type?"Enter email address":"Enter phone number"})}),(0,t.jsx)(y.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>g(a),children:"Remove"})]}),(null==r?void 0:r["contact".concat(a)])&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:r["contact".concat(a)]})]},a)),(0,t.jsx)(y.z,{id:"Add Contact",type:"button",onClick:()=>{let e=[...c,{type:"Email",value:""}];d(e),s({personalInfo:i,contactDetails:e,addressDetails:o})},size:"sm",children:"Add Contact"})]})})}),(0,t.jsx)(eg.nU,{value:"address-details","data-state":"address-details"===u?"active":"inactive",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(null==r?void 0:r.addresses)&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.X,{children:r.addresses})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(H,{htmlFor:"streetAddress",children:"Street Address"}),(0,t.jsx)(Y,{id:"streetAddress",value:o.streetAddress,onChange:e=>b("streetAddress",e.target.value),className:(null==r?void 0:r.streetAddress)?"border-red-500":""}),(null==r?void 0:r.streetAddress)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.streetAddress})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"city",children:"City"}),(0,t.jsx)(Y,{id:"city",value:o.city,onChange:e=>b("city",e.target.value),className:(null==r?void 0:r.city)?"border-red-500":""}),(null==r?void 0:r.city)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.city})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"stateProvince",children:"State/Province"}),(0,t.jsx)(Y,{id:"stateProvince",value:o.stateProvince,onChange:e=>b("stateProvince",e.target.value),className:(null==r?void 0:r.stateProvince)?"border-red-500":""}),(null==r?void 0:r.stateProvince)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.stateProvince})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"postalCode",children:"Postal Code"}),(0,t.jsx)(Y,{id:"postalCode",value:o.postalCode,onChange:e=>b("postalCode",e.target.value),className:(null==r?void 0:r.postalCode)?"border-red-500":""}),(null==r?void 0:r.postalCode)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.postalCode})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"country",children:"Country"}),(0,t.jsxs)(er,{value:o.country,onValueChange:e=>b("country",e),children:[(0,t.jsx)(en,{id:"country",className:(null==r?void 0:r.country)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select country"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South Africa",children:"South Africa"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==r?void 0:r.country)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:r.country})]})]})]})})})]})]})}e4.displayName=e0.fC.displayName;var e3=s(93022),e8=s(37806);let e6={personalInfo:{title:"",firstName:"",lastName:"",initials:"",dateOfBirth:null,gender:"",language:"",maritalStatus:"",nationality:"",idType:"South African ID",idNumber:"",idDocumentUrl:null},contactDetails:[],addressDetails:{streetAddress:"",city:"",stateProvince:"",postalCode:"",country:""}};function e9(e){let{mainMember:a,updateMainMember:s,selectedPolicies:r,selectedCateringOptions:i,userRole:n}=e,[c,d]=(0,l.useState)(!1),[o,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(a||e6),[p,j]=(0,l.useState)(!1),[v,f]=(0,l.useState)(null),[N,g]=(0,l.useState)(!1),[b,w]=(0,l.useState)(null),[C,D]=(0,l.useState)(null),[S,I]=(0,l.useState)(null),[A,P]=(0,l.useState)(!1),M=n&&"View Only"!==n;(0,l.useEffect)(()=>{a&&a.personalInfo.firstName&&x(a)},[a]),(0,l.useEffect)(()=>{let e=sessionStorage.getItem("mainMember");if(e){let a=JSON.parse(e);x(a),s(a)}},[]),(0,l.useEffect)(()=>{a&&a.personalInfo.firstName&&sessionStorage.setItem("mainMember",JSON.stringify(a))},[a]);let k=e=>{let a={};if(e.personalInfo.title||(a.title="Title is required"),e.personalInfo.firstName||(a.firstName="First name is required"),e.personalInfo.lastName||(a.lastName="Last name is required"),e.personalInfo.initials||(a.initials="Initials are required"),e.personalInfo.dateOfBirth||(a.dateOfBirth="Date of birth is required"),e.personalInfo.gender||(a.gender="Gender is required"),e.personalInfo.language||(a.language="Language is required"),e.personalInfo.maritalStatus||(a.maritalStatus="Marital status is required"),e.personalInfo.nationality||(a.nationality="Nationality is required"),e.personalInfo.idType||(a.idType="Type of ID is required"),e.personalInfo.idNumber||(a.idNumber="ID number is required"),e.personalInfo.idNumber&&"South African ID"===e.personalInfo.idType){if(e2(e.personalInfo.idNumber).isValid){let s=new Date(e.personalInfo.dateOfBirth||""),t=new Date,l=t.getFullYear()-s.getFullYear(),r=t.getMonth()-s.getMonth();(r<0||0===r&&t.getDate()<s.getDate()?l-1:l)<18&&(a.idNumber="Main member must be at least 18 years old to open a contract")}else a.idNumber="Invalid South African ID number"}return e.contactDetails&&0!==e.contactDetails.length?e.contactDetails.forEach((e,s)=>{e.type||(a["contact".concat(s)]="Contact type is required"),e.value||(a["contact".concat(s)]="Contact value is required"),"Email"===e.type&&e.value&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value)&&(a["contact".concat(s)]="Invalid email format"),"Phone Number"===e.type&&e.value&&!/^[0-9+\-\s()]{10,}$/.test(e.value)&&(a["contact".concat(s)]="Invalid phone number format")}):a.contacts="At least one contact method is required",e.addressDetails.streetAddress||(a.streetAddress="Street address is required"),e.addressDetails.city||(a.city="City is required"),e.addressDetails.stateProvince||(a.stateProvince="State/Province is required"),e.addressDetails.postalCode||(a.postalCode="Postal code is required"),e.addressDetails.country||(a.country="Country is required"),Object.keys(a).length>0?a:null},O=async e=>{e.preventDefault();let a=k(h);if(a){w(a);return}await T(h)},E=e=>{D(e),u(!0)},F=async()=>{if(C&&a.contractId){P(!0);try{let e=k(C);if(e){I(e);return}let t=(0,ej.JU)(ev.db,"Contracts",a.contractId);await (0,ej.r7)(t,{mainMember:C}),s({...C,contractNumber:a.contractNumber,contractId:a.contractId}),u(!1),D(null),I(null),(0,ef.Am)({title:"Success",description:"Main member details updated successfully"})}catch(e){console.error("Error updating main member:",e),(0,ef.Am)({title:"Error",description:"Failed to update main member details. Please try again.",variant:"destructive"})}finally{P(!1)}}},T=async e=>{j(!0),w(null);try{let a=await (0,ej.ET)((0,ej.hJ)(ev.db,"Members"),{...e.personalInfo,id:e.personalInfo.idNumber,createdAt:new Date}),t=e.contactDetails.map(s=>(0,ej.ET)((0,ej.hJ)(ev.db,"Contacts"),{...s,memberId:a.id,memberIdNumber:e.personalInfo.idNumber,createdAt:new Date}));await Promise.all(t),await (0,ej.ET)((0,ej.hJ)(ev.db,"Address"),{...e.addressDetails,memberId:a.id,memberIdNumber:e.personalInfo.idNumber,createdAt:new Date});let l="CNT-".concat(Date.now().toString(36).toUpperCase(),"-").concat(Math.random().toString(36).substring(2,5).toUpperCase()),n=await (0,ej.ET)((0,ej.hJ)(ev.db,"Contracts"),{contractNumber:l,memberId:a.id,memberIdNumber:e.personalInfo.idNumber,status:"In Progress",policiesId:(null==r?void 0:r.policiesId)||null,cateringOptionIds:(null==i?void 0:i.map(e=>e.id))||[],totalPremium:((null==r?void 0:r.premium)||0)+((null==i?void 0:i.reduce((e,a)=>e+a.price,0))||0),createdAt:new Date,updatedAt:new Date});s({...e,contractNumber:l,contractId:n.id}),d(!1),u(!1),j(!1)}catch(e){console.error("Error saving member data:",e),w({general:e instanceof Error?e.message:"Failed to save member data. Please try again."}),j(!1)}};return N?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(e3.O,{className:"h-8 w-48"}),(0,t.jsx)(e3.O,{className:"h-9 w-32"})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("th",{className:"text-left p-4",children:(0,t.jsx)(e3.O,{className:"h-4 w-16"})}),(0,t.jsx)("th",{className:"text-left p-4",children:(0,t.jsx)(e3.O,{className:"h-4 w-24"})}),(0,t.jsx)("th",{className:"text-left p-4",children:(0,t.jsx)(e3.O,{className:"h-4 w-24"})}),(0,t.jsx)("th",{className:"text-left p-4",children:(0,t.jsx)(e3.O,{className:"h-4 w-24"})}),(0,t.jsx)("th",{className:"text-right p-4",children:(0,t.jsx)(e3.O,{className:"h-4 w-16"})})]})}),(0,t.jsx)("tbody",{children:(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"text-center p-8",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)(Q.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Loading member details..."})]})})})})]})})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Main Member Details"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Add or manage main member information"})]}),M&&a.personalInfo.firstName&&(0,t.jsxs)(y.z,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>E(a),children:[(0,t.jsx)(ea.Z,{className:"h-4 w-4"}),"Edit Main Member"]}),!a.personalInfo.firstName&&!v&&!N&&(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsxs)(eh.Vq,{open:c,onOpenChange:e=>{p||(d(e),e||w(null))},children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{id:"Add Main Member",className:"gap-2",children:[(0,t.jsx)(e8.Z,{className:"h-4 w-4"}),"Add Main Member"]})}),(0,t.jsxs)(eh.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,t.jsx)(eh.fK,{children:(0,t.jsxs)(eh.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(e8.Z,{className:"h-5 w-5"}),"Add Main Member Details",p&&(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin ml-2"})]})}),b&&"general"in b&&(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-4",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:b.general})]}),(0,t.jsx)(e5,{data:e6,updateData:x,errors:b||void 0}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>{p||(d(!1),w(null))},disabled:p,children:"Cancel"}),(0,t.jsx)(y.z,{onClick:O,disabled:p,id:"Save",className:"gap-2",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e8.Z,{className:"h-4 w-4"}),"Save"]})})]})]})]})}),(0,t.jsx)(Z._v,{children:"Add new main member details"})]})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("th",{className:"text-left p-4",children:"Title"}),(0,t.jsx)("th",{className:"text-left p-4",children:"First Name"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Last Name"}),(0,t.jsx)("th",{className:"text-left p-4",children:"ID Number"}),(0,t.jsx)("th",{className:"text-right p-4",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:a.personalInfo.firstName||v?(0,t.jsxs)("tr",{className:"border-b hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("td",{className:"p-4",children:a.personalInfo.title||(null==v?void 0:v.personalInfo.title)}),(0,t.jsx)("td",{className:"p-4",children:a.personalInfo.firstName||(null==v?void 0:v.personalInfo.firstName)}),(0,t.jsx)("td",{className:"p-4",children:a.personalInfo.lastName||(null==v?void 0:v.personalInfo.lastName)}),(0,t.jsx)("td",{className:"p-4",children:a.personalInfo.idNumber||(null==v?void 0:v.personalInfo.idNumber)}),(0,t.jsx)("td",{className:"p-4 text-right",children:M&&(0,t.jsxs)(eh.Vq,{open:o,onOpenChange:e=>{p||(u(e),e||w(null))},children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>E(a),children:[(0,t.jsx)(ea.Z,{className:"h-4 w-4"}),"Edit"]})}),(0,t.jsxs)(eh.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,t.jsx)(eh.fK,{children:(0,t.jsxs)(eh.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(ea.Z,{className:"h-5 w-5"}),"Edit Main Member Details",p&&(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin ml-2"})]})}),b&&"general"in b&&(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-4",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:b.general})]}),(0,t.jsx)(e5,{data:a,updateData:x,errors:b||void 0}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>{p||(u(!1),w(null))},disabled:p,children:"Cancel"}),(0,t.jsx)(y.z,{onClick:F,disabled:p,className:"gap-2",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),"Updating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.Z,{className:"h-4 w-4"}),"Update"]})})]})]})]})})]}):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"text-center p-8",children:N?(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)(Q.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Loading..."})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)(e8.Z,{className:"h-12 w-12 text-gray-300"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-gray-500",children:"No main member added yet"}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:'Click the "Add Main Member" button to get started'})]})]})})})})]}),(a.personalInfo.idDocumentUrl||(null==v?void 0:v.personalInfo.idDocumentUrl))&&(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsxs)("a",{href:a.personalInfo.idDocumentUrl||(null==v?void 0:v.personalInfo.idDocumentUrl)||"#",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-500 hover:text-blue-700",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),"View ID Document"]})}),(0,t.jsx)(Z._v,{children:"Open ID document in new tab"})]})})})]})]})}var e7=s(9089),ae=s(49663);function aa(e){let{data:a,updateData:s,mainMemberIdNumber:r,errors:i,onTabChange:n}=e,[c,d]=(0,l.useState)(a.personalInfo),[o,m]=(0,l.useState)(a.contactDetails),[u,h]=(0,l.useState)(a.addressDetails),[x,p]=(0,l.useState)("personal-info"),[j,v]=(0,l.useState)([]),f=(e,t)=>{let l={...c,[e]:t};if("idNumber"===e&&"string"==typeof t&&"South African ID"===l.idType){if(r&&t===r){v(["Beneficiary cannot have the same ID number as the main member"]);return}let e=e2(t);v(e.errors),e.isValid,e.dateOfBirth&&(l.dateOfBirth=e.dateOfBirth),e.gender&&(l.gender=e.gender)}"idType"===e&&v([]),d(l),s({...a,personalInfo:l})},N=(e,t,l)=>{let r=[...o];r[e]={...r[e],[t]:l},m(r),s({...a,contactDetails:r})},g=(e,t)=>{h(a=>({...a,[e]:t})),s({...a,addressDetails:{...u,[e]:t}})},b=e=>{let t=o.filter((a,s)=>s!==e);m(t),s({...a,contactDetails:t})};return(0,t.jsxs)("div",{className:"space-y-4",children:[i&&(()=>{if(!i)return null;let e=Object.keys(i).some(e=>["title","firstName","lastName","initials","dateOfBirth","gender","language","maritalStatus","nationality","idType","idNumber"].includes(e)),a=Object.keys(i).some(e=>"contacts"===e||e.startsWith("contact")),s=Object.keys(i).some(e=>["streetAddress","city","stateProvince","postalCode","country"].includes(e)),l=[];return e&&"personal-info"!==x&&l.push("Personal Information"),a&&"contact-details"!==x&&l.push("Contact Details"),s&&"address-details"!==x&&l.push("Address Details"),l.length>0?(0,t.jsxs)("div",{className:"mb-4 text-sm text-amber-600 bg-amber-50 p-2 rounded border border-amber-200",children:["Please complete required fields in: ",l.join(", ")]}):null})(),(0,t.jsxs)(eg.mQ,{defaultValue:"personal-info",className:"w-full",onValueChange:e=>null==n?void 0:n(e),children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(eg.SP,{value:"personal-info",children:"Personal Details"}),(0,t.jsx)(eg.SP,{value:"contact-details",children:"Contact Details"}),(0,t.jsx)(eg.SP,{value:"address-details",children:"Address Details"})]}),(0,t.jsx)(eg.nU,{value:"personal-info",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"flex gap-3 col-span-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(H,{htmlFor:"type-of-id",children:"Type of ID"}),(0,t.jsxs)(er,{value:c.idType,onValueChange:e=>{f("idType",e),v([])},children:[(0,t.jsx)(en,{id:"type-of-id",className:(null==i?void 0:i.idType)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select ID type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South African ID",children:"South African ID"}),(0,t.jsx)(em,{value:"Passport",children:"Passport"})]})]}),(null==i?void 0:i.idType)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.idType})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)(H,{htmlFor:"id-input",children:["ID Number / Passport Number","South African ID"===c.idType&&(0,t.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"(13 digits)"})]}),(0,t.jsx)(Y,{id:"id-input","data-testid":"id-input","aria-label":"ID Number / Passport Number",value:c.idNumber,onChange:e=>f("idNumber",e.target.value),className:(null==i?void 0:i.idNumber)?"border-red-500":""}),(null==i?void 0:i.idNumber)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.idNumber})]})]}),"South African ID"===c.idType&&j.length>0&&(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mt-1",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.X,{children:(0,t.jsx)("ul",{className:"list-disc pl-4",children:j.map((e,a)=>(0,t.jsx)("li",{className:"text-sm",children:e},a))})})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"title",children:"Title"}),(0,t.jsxs)(er,{value:c.title,onValueChange:e=>f("title",e),children:[(0,t.jsx)(en,{id:"title",className:(null==i?void 0:i.title)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select title"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Mr",children:"Mr"}),(0,t.jsx)(em,{value:"Mrs",children:"Mrs"}),(0,t.jsx)(em,{value:"Ms",children:"Ms"}),(0,t.jsx)(em,{value:"Dr",children:"Dr"})]})]}),(null==i?void 0:i.title)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.title})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"relationshipToMainMember",children:"Relationship"}),(0,t.jsxs)(er,{value:c.relationshipToMainMember,onValueChange:e=>f("relationshipToMainMember",e),children:[(0,t.jsx)(en,{id:"relationshipToMainMember",className:(null==i?void 0:i.relationshipToMainMember)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select relationship"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Spouse",children:"Spouse"}),(0,t.jsx)(em,{value:"Child",children:"Child"}),(0,t.jsx)(em,{value:"Parent",children:"Parent"}),(0,t.jsx)(em,{value:"Sibling",children:"Sibling"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==i?void 0:i.relationshipToMainMember)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.relationshipToMainMember})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"beneficiaryPercentage",children:"Benefit %"}),(0,t.jsx)(Y,{id:"beneficiaryPercentage",type:"number",min:"0",max:"100",value:c.beneficiaryPercentage,onChange:e=>f("beneficiaryPercentage",parseFloat(e.target.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"firstName",children:"First Name"}),(0,t.jsx)(Y,{id:"firstName",value:c.firstName,onChange:e=>f("firstName",e.target.value),className:(null==i?void 0:i.firstName)?"border-red-500":""}),(null==i?void 0:i.firstName)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.firstName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"lastName",children:"Last Name"}),(0,t.jsx)(Y,{id:"lastName",value:c.lastName,onChange:e=>f("lastName",e.target.value),className:(null==i?void 0:i.lastName)?"border-red-500":""}),(null==i?void 0:i.lastName)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.lastName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"initials",children:"Initials"}),(0,t.jsx)(Y,{id:"initials",value:c.initials,onChange:e=>f("initials",e.target.value),className:(null==i?void 0:i.initials)?"border-red-500":""}),(null==i?void 0:i.initials)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.initials})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"dateOfBirth",children:"Date of Birth"}),(0,t.jsx)(e1,{id:"dateOfBirth",selected:c.dateOfBirth,onSelect:e=>f("dateOfBirth",e),className:(null==i?void 0:i.dateOfBirth)?"border-red-500":""}),(null==i?void 0:i.dateOfBirth)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.dateOfBirth})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"gender",children:"Gender"}),(0,t.jsxs)(er,{value:c.gender,onValueChange:e=>f("gender",e),children:[(0,t.jsx)(en,{id:"gender",className:(null==i?void 0:i.gender)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select gender"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Male",children:"Male"}),(0,t.jsx)(em,{value:"Female",children:"Female"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==i?void 0:i.gender)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.gender})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"nationality",children:"Nationality"}),(0,t.jsxs)(er,{value:c.nationality,onValueChange:e=>f("nationality",e),children:[(0,t.jsx)(en,{id:"nationality",className:(null==i?void 0:i.nationality)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select nationality"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South African",children:"South African"}),(0,t.jsx)(em,{value:"Zimbabwean",children:"Zimbabwean"}),(0,t.jsx)(em,{value:"Mozambican",children:"Mozambican"}),(0,t.jsx)(em,{value:"Namibian",children:"Namibian"}),(0,t.jsx)(em,{value:"Botswanan",children:"Botswanan"}),(0,t.jsx)(em,{value:"Lesotho",children:"Lesotho"}),(0,t.jsx)(em,{value:"Swazi",children:"Swazi"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==i?void 0:i.nationality)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.nationality})]})]})})}),(0,t.jsx)(eg.nU,{value:"contact-details",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(null==i?void 0:i.contacts)&&(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-4",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.X,{children:i.contacts})]}),o.map((e,a)=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(er,{value:e.type,onValueChange:e=>N(a,"type",e),children:[(0,t.jsx)(en,{className:"w-[180px] ".concat((null==i?void 0:i["contact".concat(a)])?"border-red-500":""),children:(0,t.jsx)(ei,{placeholder:"Select contact type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Email",children:"Email"}),(0,t.jsx)(em,{value:"Phone Number",children:"Phone Number"})]})]})}),(0,t.jsx)("div",{className:"flex-[2]",children:(0,t.jsx)(Y,{value:e.value,onChange:e=>N(a,"value",e.target.value),className:(null==i?void 0:i["contact".concat(a)])?"border-red-500":"",placeholder:"Email"===e.type?"Enter email address":"Enter phone number"})}),(0,t.jsx)(y.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>b(a),children:"Remove"})]}),(null==i?void 0:i["contact".concat(a)])&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:i["contact".concat(a)]})]},a)),(0,t.jsx)(y.z,{id:"Add Contact",type:"button",onClick:()=>{let e=[...o,{type:"Email",value:""}];m(e),s({...a,contactDetails:e})},size:"sm",className:"mt-2",children:"Add Contact"})]})})}),(0,t.jsx)(eg.nU,{value:"address-details",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(H,{htmlFor:"streetAddress",children:"Street Address"}),(0,t.jsx)(Y,{id:"streetAddress",value:u.streetAddress,onChange:e=>g("streetAddress",e.target.value),className:(null==i?void 0:i.streetAddress)?"border-red-500":""}),(null==i?void 0:i.streetAddress)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.streetAddress})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"city",children:"City"}),(0,t.jsx)(Y,{id:"city",value:u.city,onChange:e=>g("city",e.target.value),className:(null==i?void 0:i.city)?"border-red-500":""}),(null==i?void 0:i.city)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.city})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"stateProvince",children:"State/Province"}),(0,t.jsx)(Y,{id:"stateProvince",value:u.stateProvince,onChange:e=>g("stateProvince",e.target.value),className:(null==i?void 0:i.stateProvince)?"border-red-500":""}),(null==i?void 0:i.stateProvince)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.stateProvince})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"postalCode",children:"Postal Code"}),(0,t.jsx)(Y,{id:"postalCode",value:u.postalCode,onChange:e=>g("postalCode",e.target.value),className:(null==i?void 0:i.postalCode)?"border-red-500":""}),(null==i?void 0:i.postalCode)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.postalCode})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"country",children:"Country"}),(0,t.jsxs)(er,{value:u.country,onValueChange:e=>g("country",e),children:[(0,t.jsx)(en,{id:"country",className:(null==i?void 0:i.country)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select country"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South Africa",children:"South Africa"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==i?void 0:i.country)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:i.country})]})]})})})]})]})}let as={personalInfo:{title:"",firstName:"",lastName:"",initials:"",dateOfBirth:null,gender:"",relationshipToMainMember:"",nationality:"",idType:"South African ID",idNumber:"",beneficiaryPercentage:0,idDocumentUrl:null},contactDetails:[],addressDetails:{streetAddress:"",city:"",stateProvince:"",postalCode:"",country:""}},at=async(e,a,s)=>{try{let t=await (0,ej.ET)((0,ej.hJ)(ev.db,"Beneficiaries"),{...e.personalInfo,contractNumber:a,mainMemberIdNumber:s,type:"Beneficiary",totalPercentage:e.personalInfo.beneficiaryPercentage,createdAt:new Date,updatedAt:new Date}),l=e.contactDetails.map(e=>(0,ej.ET)((0,ej.hJ)(ev.db,"Contacts"),{...e,beneficiaryId:t.id,contractNumber:a,mainMemberIdNumber:s,type:"Beneficiary",createdAt:new Date,updatedAt:new Date}));return await (0,ej.ET)((0,ej.hJ)(ev.db,"Address"),{...e.addressDetails,beneficiaryId:t.id,contractNumber:a,mainMemberIdNumber:s,type:"Beneficiary",createdAt:new Date,updatedAt:new Date}),await Promise.all(l),t.id}catch(e){throw console.error("Error saving beneficiary:",e),e}},al=async(e,a)=>{try{let s=(0,ej.IO)((0,ej.hJ)(ev.db,"Beneficiaries"),(0,ej.ar)("id","==",e),(0,ej.ar)("contractNumber","==",a)),t=await (0,ej.PL)(s);if(t.empty)throw Error("Beneficiary record not found");let l=[],r=(0,ej.IO)((0,ej.hJ)(ev.db,"Address"),(0,ej.ar)("beneficiaryId","==",e),(0,ej.ar)("contractNumber","==",a),(0,ej.ar)("type","==","Beneficiary")),i=await (0,ej.PL)(r);i.size>0&&l.push(...i.docs.map(e=>(0,ej.oe)(e.ref)));let n=(0,ej.IO)((0,ej.hJ)(ev.db,"Contacts"),(0,ej.ar)("beneficiaryId","==",e),(0,ej.ar)("contractNumber","==",a),(0,ej.ar)("type","==","Beneficiary")),c=await (0,ej.PL)(n);c.size>0&&l.push(...c.docs.map(e=>(0,ej.oe)(e.ref))),l.push((0,ej.oe)(t.docs[0].ref)),await Promise.all(l)}catch(e){if(console.error("Error removing beneficiary:",e),e instanceof Error){if("Beneficiary record not found"===e.message)throw Error("Cannot find the beneficiary record to delete");throw Error("Failed to remove beneficiary: ".concat(e.message))}throw Error("An unexpected error occurred while removing the beneficiary")}},ar=(e,a)=>{var s,t,l,r,i,n,c,d,o,m,u,h,x,p;let j=[];(null===(s=e.personalInfo.title)||void 0===s?void 0:s.trim())||j.push("Title: Title is required"),(null===(t=e.personalInfo.firstName)||void 0===t?void 0:t.trim())||j.push("First Name: First name is required"),(null===(l=e.personalInfo.lastName)||void 0===l?void 0:l.trim())||j.push("Last Name: Last name is required"),(null===(r=e.personalInfo.initials)||void 0===r?void 0:r.trim())||j.push("Initials: Initials are required"),e.personalInfo.dateOfBirth||j.push("Date of Birth: Date of birth is required"),(null===(i=e.personalInfo.gender)||void 0===i?void 0:i.trim())||j.push("Gender: Gender is required"),(null===(n=e.personalInfo.relationshipToMainMember)||void 0===n?void 0:n.trim())||j.push("Relationship: Relationship to main member is required"),(null===(c=e.personalInfo.nationality)||void 0===c?void 0:c.trim())||j.push("Nationality: Nationality is required"),(null===(d=e.personalInfo.idType)||void 0===d?void 0:d.trim())||j.push("Type of ID: ID type is required"),(null===(o=e.personalInfo.idNumber)||void 0===o?void 0:o.trim())||j.push("ID Number: ID number is required");let v=e.personalInfo.beneficiaryPercentage;return"number"!=typeof v||v<0||v>100?j.push("Benefit Percentage: Must be between 0 and 100"):a.reduce((e,a)=>e+(a.personalInfo.beneficiaryPercentage||0),0)+v>100&&j.push("Benefit Percentage: Total allocation cannot exceed 100%"),0===e.contactDetails.length?j.push("Contact Details: At least one contact method is required"):e.contactDetails.forEach((e,a)=>{var s,t;(null===(s=e.type)||void 0===s?void 0:s.trim())||j.push("Contact ".concat(a+1,": Contact type is required")),(null===(t=e.value)||void 0===t?void 0:t.trim())?"Email"===e.type?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())||j.push("Contact ".concat(a+1,": Invalid email format")):"Phone Number"!==e.type||/^[0-9+\-\s()]*$/.test(e.value.trim())||j.push("Contact ".concat(a+1,": Invalid phone number format")):j.push("Contact ".concat(a+1,": Contact value is required"))}),(null===(m=e.addressDetails.streetAddress)||void 0===m?void 0:m.trim())||j.push("Street Address: Street address is required"),(null===(u=e.addressDetails.city)||void 0===u?void 0:u.trim())||j.push("City: City is required"),(null===(h=e.addressDetails.stateProvince)||void 0===h?void 0:h.trim())||j.push("State/Province: State/Province is required"),(null===(x=e.addressDetails.postalCode)||void 0===x?void 0:x.trim())||j.push("Postal Code: Postal code is required"),(null===(p=e.addressDetails.country)||void 0===p?void 0:p.trim())||j.push("Country: Country is required"),j},ai=(e,a)=>{var s,t,l,r,i,n,c,d,o,m,u,h,x,p;switch(a){case"personal-info":return!!((null===(s=e.personalInfo.title)||void 0===s?void 0:s.trim())&&(null===(t=e.personalInfo.firstName)||void 0===t?void 0:t.trim())&&(null===(l=e.personalInfo.lastName)||void 0===l?void 0:l.trim())&&(null===(r=e.personalInfo.initials)||void 0===r?void 0:r.trim())&&e.personalInfo.dateOfBirth&&(null===(i=e.personalInfo.gender)||void 0===i?void 0:i.trim())&&(null===(n=e.personalInfo.relationshipToMainMember)||void 0===n?void 0:n.trim())&&(null===(c=e.personalInfo.nationality)||void 0===c?void 0:c.trim())&&(null===(d=e.personalInfo.idType)||void 0===d?void 0:d.trim())&&(null===(o=e.personalInfo.idNumber)||void 0===o?void 0:o.trim())&&e.personalInfo.beneficiaryPercentage>=0&&e.personalInfo.beneficiaryPercentage<=100);case"contact-details":return e.contactDetails.length>0&&e.contactDetails.every(e=>{var a,s;return(null===(a=e.type)||void 0===a?void 0:a.trim())&&(null===(s=e.value)||void 0===s?void 0:s.trim())&&("Email"!==e.type||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim()))&&("Phone Number"!==e.type||/^[0-9+\-\s()]*$/.test(e.value.trim()))});case"address-details":return!!((null===(m=e.addressDetails.streetAddress)||void 0===m?void 0:m.trim())&&(null===(u=e.addressDetails.city)||void 0===u?void 0:u.trim())&&(null===(h=e.addressDetails.stateProvince)||void 0===h?void 0:h.trim())&&(null===(x=e.addressDetails.postalCode)||void 0===x?void 0:x.trim())&&(null===(p=e.addressDetails.country)||void 0===p?void 0:p.trim()));default:return!1}};function an(e){let{beneficiaries:a,updateBeneficiaries:s,contractNumber:r,mainMemberIdNumber:i}=e,[n,c]=(0,l.useState)(!1),[d,o]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null),[h,x]=(0,l.useState)(null),[p,j]=(0,l.useState)(null),[f,N]=(0,l.useState)(as),[g,b]=(0,l.useState)(null),[w,C]=(0,l.useState)(null),[D,S]=(0,l.useState)(!1),[I,A]=(0,l.useState)("personal-info"),[P,M]=(0,l.useState)({checking:!1,isDuplicate:!1,message:null}),k=async()=>{try{if(!r||!i){C("Contract information is missing. Please add main member details first.");return}S(!0),C(null);let e=ar(f,a);if(e.length>0){let a=e.reduce((e,a)=>{let[s,t]=a.split(":").map(e=>e.trim());return e[s.toLowerCase().replace(/\s+/g,"").replace("firstname","firstName").replace("lastname","lastName").replace("dateofbirth","dateOfBirth").replace("idnumber","idNumber").replace("idtype","idType").replace("relationshiptomainmember","relationshipToMainMember").replace("benefitpercentage","beneficiaryPercentage").replace("streetaddress","streetAddress").replace("stateprovince","stateProvince").replace("postalcode","postalCode")]=t||s,e},{});b(a);let s={"personal-info":e.filter(e=>e.toLowerCase().includes("title")||e.toLowerCase().includes("first name")||e.toLowerCase().includes("last name")||e.toLowerCase().includes("initials")||e.toLowerCase().includes("date of birth")||e.toLowerCase().includes("gender")||e.toLowerCase().includes("relationship")||e.toLowerCase().includes("nationality")||e.toLowerCase().includes("id")||e.toLowerCase().includes("percentage")),"contact-details":e.filter(e=>e.toLowerCase().includes("contact")),"address-details":e.filter(e=>e.toLowerCase().includes("address")||e.toLowerCase().includes("city")||e.toLowerCase().includes("state")||e.toLowerCase().includes("postal")||e.toLowerCase().includes("country"))},l=s[I];if(l&&l.length>0)C((0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Please correct the following errors:"}),(0,t.jsx)(ex.X,{children:(0,t.jsx)("ul",{className:"list-disc pl-4 mt-2",children:l.map((e,a)=>{var s;return(0,t.jsx)("li",{children:(null===(s=e.split(":")[1])||void 0===s?void 0:s.trim())||e},a)})})})]}));else{let e=Object.entries(s).filter(e=>{let[a,s]=e;return s.length>0}).map(e=>{let[a,s]=e;switch(a){case"personal-info":return"Personal Information";case"contact-details":return"Contact Details";case"address-details":return"Address Details";default:return""}}).filter(Boolean);e.length>0&&C((0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Please complete required fields in:"}),(0,t.jsx)(ex.X,{children:(0,t.jsx)("ul",{className:"list-disc pl-4 mt-2",children:e.map((e,a)=>(0,t.jsx)("li",{children:e},a))})})]}))}S(!1);return}if(await F(f.personalInfo.idNumber)){C("This person is already registered as a beneficiary"),S(!1);return}let l=await at(f,r,i),n={...f,id:l};s([...a,n]),c(!1),N(as),b(null),C(null)}catch(e){console.error("Error adding beneficiary:",e),C("Failed to add beneficiary. Please try again.")}finally{S(!1)}},O=async()=>{try{if(!r||!i){C("Contract information is missing");return}if(S(!0),b(null),C(null),null!==p){let e=a.filter((e,a)=>a!==p),l=ar(f,e);if(l.length>0){let e={"personal-info":l.filter(e=>e.toLowerCase().includes("title")||e.toLowerCase().includes("first name")||e.toLowerCase().includes("last name")||e.toLowerCase().includes("initials")||e.toLowerCase().includes("date of birth")||e.toLowerCase().includes("gender")||e.toLowerCase().includes("relationship")||e.toLowerCase().includes("nationality")||e.toLowerCase().includes("id")||e.toLowerCase().includes("percentage")),"contact-details":l.filter(e=>e.toLowerCase().includes("contact")),"address-details":l.filter(e=>e.toLowerCase().includes("address")||e.toLowerCase().includes("city")||e.toLowerCase().includes("state")||e.toLowerCase().includes("postal")||e.toLowerCase().includes("country"))},a=l.reduce((e,a)=>{let[s,t]=a.split(":").map(e=>e.trim());return e[s.toLowerCase().replace(/\s+/g,"").replace("firstname","firstName").replace("lastname","lastName").replace("dateofbirth","dateOfBirth").replace("idnumber","idNumber").replace("idtype","idType").replace("relationshiptomainmember","relationshipToMainMember").replace("benefitpercentage","beneficiaryPercentage").replace("streetaddress","streetAddress").replace("stateprovince","stateProvince").replace("postalcode","postalCode")]=t||s,e},{});b(a);let s=e[I];if(s&&s.length>0)C((0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Please correct the following errors:"}),(0,t.jsx)(ex.X,{children:(0,t.jsx)("ul",{className:"list-disc pl-4 mt-2",children:s.map((e,a)=>{var s;return(0,t.jsx)("li",{children:(null===(s=e.split(":")[1])||void 0===s?void 0:s.trim())||e},a)})})})]}));else{let a=Object.entries(e).filter(e=>{let[a,s]=e;return s.length>0}).map(e=>{let[a,s]=e;switch(a){case"personal-info":return"Personal Information";case"contact-details":return"Contact Details";case"address-details":return"Address Details";default:return""}}).filter(Boolean);a.length>0&&C((0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Please complete required fields in:"}),(0,t.jsx)(ex.X,{children:(0,t.jsx)("ul",{className:"list-disc pl-4 mt-2",children:a.map((e,a)=>(0,t.jsx)("li",{children:e},a))})})]}))}S(!1);return}let n=await at(f,r,i),d=[...a];d[p]={...f,id:n},s(d),c(!1),x(null),j(null),N(as),b(null),C(null)}}catch(e){console.error("Error updating beneficiary:",e),C("Failed to update beneficiary. Please try again.")}finally{S(!1)}},Z=()=>{c(!1),x(null),j(null),N(as)},E=async e=>{if(!D)try{S(!0);let t=a[e];if(!t.id||!r)throw Error("Missing beneficiary ID or contract number");let l=[...a];l[e]={...t,isDeleting:!0},s(l),await al(t.id,r),s(a.filter((a,s)=>s!==e)),b(null),o(!1),u(null)}catch(e){console.error("Error removing beneficiary:",e),C(e instanceof Error?e.message:"Failed to remove beneficiary. Please try again.")}finally{S(!1)}},F=async e=>{M(e=>({...e,checking:!0}));try{let a=(0,ej.IO)((0,ej.hJ)(ev.db,"Beneficiaries"),(0,ej.ar)("idNumber","==",e),(0,ej.ar)("status","==","Active")),s=!(await (0,ej.PL)(a)).empty;return M({checking:!1,isDuplicate:s,message:s?"This person is already registered as a beneficiary":null}),s}catch(e){return console.error("Error checking duplicate:",e),M({checking:!1,isDuplicate:!1,message:"Error checking duplicate status"}),!1}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Beneficiaries"}),(0,t.jsxs)(eh.Vq,{open:n,onOpenChange:e=>{c(e),e||(x(null),j(null),N(as))},children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsx)(y.z,{onClick:()=>{x(null),j(null),N(as)},children:"Add Beneficiary"})}),(0,t.jsxs)(eh.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:h?"Edit Beneficiary":"Add New Beneficiary"})}),w&&(0,t.jsx)("div",{className:"mb-4",children:w}),(0,t.jsx)(aa,{data:h||f,updateData:e=>{N(e),ai(e,I)&&(b(e=>{if(!e)return null;let a={...e};return Object.keys(a).forEach(e=>{("personal-info"===I&&e.includes("personal")||"contact-details"===I&&e.includes("contact")||"address-details"===I&&e.includes("address"))&&delete a[e]}),Object.keys(a).length>0?a:null}),C(null))},mainMemberIdNumber:i,errors:g,onTabChange:e=>{A(e),C(null)}}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>{Z(),b(null),C(null)},disabled:D,children:"Cancel"}),(0,t.jsx)(y.z,{onClick:h?O:k,disabled:D,children:D?"Saving...":"Save"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Beneficiaries"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["Total Allocation: ",a.reduce((e,a)=>e+a.personalInfo.beneficiaryPercentage,0),"%"]}),100===a.reduce((e,a)=>e+a.personalInfo.beneficiaryPercentage,0)?(0,t.jsxs)(eu.C,{variant:"outline",className:"gap-1 bg-green-50 text-green-700 border-green-200",children:[(0,t.jsx)(e7.Z,{className:"w-3 h-3"}),"Complete"]}):(0,t.jsxs)(eu.C,{variant:"outline",className:"gap-1 bg-yellow-50 text-yellow-700 border-yellow-200",children:[(0,t.jsx)(v.Z,{className:"w-3 h-3"}),"Incomplete"]})]})]}),(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("th",{className:"text-left p-4",children:"Name"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Relationship"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Percentage"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Status"}),(0,t.jsx)("th",{className:"text-right p-4",children:"Actions"})]})}),(0,t.jsxs)("tbody",{children:[a.map((e,a)=>(0,t.jsxs)("tr",{className:"border-b hover:bg-gray-50 transition-all duration-200 ".concat(e.isDeleting?"opacity-50 bg-gray-50":""),children:[(0,t.jsxs)("td",{className:"p-4",children:[e.personalInfo.title," ",e.personalInfo.firstName," ",e.personalInfo.lastName]}),(0,t.jsx)("td",{className:"p-4",children:e.personalInfo.relationshipToMainMember}),(0,t.jsx)("td",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-primary h-2 rounded-full",style:{width:"".concat(e.personalInfo.beneficiaryPercentage,"%")}})}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e.personalInfo.beneficiaryPercentage,"%"]})]})}),(0,t.jsx)("td",{className:"p-4",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm bg-green-100 text-green-700",children:[(0,t.jsx)(ae.Z,{className:"w-3 h-3"}),"Active"]})}),(0,t.jsxs)("td",{className:"p-4 text-right space-x-2",children:[(0,t.jsx)(y.z,{variant:"outline",size:"sm",disabled:e.isDeleting,onClick:()=>{x(e),j(a),c(!0)},children:"Edit"}),(0,t.jsx)(y.z,{variant:"destructive",size:"sm",disabled:e.isDeleting||D,onClick:()=>{u(a),o(!0)},children:e.isDeleting?"Removing...":"Remove"})]})]},a)),0===a.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"text-center p-4 text-gray-500",children:"No beneficiaries added yet"})})]})]})]}),(0,t.jsx)(eh.Vq,{open:d,onOpenChange:e=>{D||(o(e),e||(u(null),b(null)))},children:(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:w?"Error Removing Beneficiary":"Confirm Deletion"})}),(0,t.jsx)("div",{className:"py-4",children:w?(0,t.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-md",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"Error"}),(0,t.jsx)("p",{className:"text-sm",children:w}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Please try again or contact support if the problem persists."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-gray-600",children:"Are you sure you want to remove this beneficiary? This action cannot be undone."}),null!==m&&(0,t.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[(0,t.jsxs)("p",{className:"font-medium",children:[a[m].personalInfo.title," ",a[m].personalInfo.firstName," ",a[m].personalInfo.lastName]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[a[m].personalInfo.relationshipToMainMember," • ",a[m].personalInfo.beneficiaryPercentage,"%"]})]})]})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>{D||(o(!1),u(null),b(null))},disabled:D,children:w?"Close":"Cancel"}),!w&&(0,t.jsx)(y.z,{variant:"destructive",onClick:()=>null!==m&&E(m),disabled:D,children:D?"Removing...":"Remove Beneficiary"})]})]})})]})}function ac(e){let{data:a,updateData:s,error:r,mainMemberIdNumber:i,validationErrors:n={}}=e,[c,d]=(0,l.useState)(a.personalInfo),[o,m]=(0,l.useState)(a.contactDetails),[u,h]=(0,l.useState)(a.addressDetails),[x,p]=(0,l.useState)(r||null),[j,v]=(0,l.useState)([]);(0,l.useEffect)(()=>{p(r||null)},[r]);let f=(e,t)=>{p(null);let l={...c,[e]:t};if("idNumber"===e&&"string"==typeof t&&"South African ID"===l.idType){if(i&&t===i){v(["Dependent cannot have the same ID number as the main member"]);return}let e=e2(t);v(e.errors),e.isValid,e.dateOfBirth&&(l.dateOfBirth=e.dateOfBirth),e.gender&&(l.gender=e.gender)}"idType"===e&&v([]),d(l),s({...a,personalInfo:l})},N=(e,t,l)=>{p(null);let r=[...o];r[e]={...r[e],[t]:l},m(r),s({...a,contactDetails:r})},g=(e,t)=>{p(null);let l={...u,[e]:t};h(l),s({...a,addressDetails:l})},b=e=>{p(null);let t=o.filter((a,s)=>s!==e);m(t),s({...a,contactDetails:t})};return(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)(eg.mQ,{defaultValue:"personal",className:"w-full",children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(eg.SP,{value:"personal",children:"Personal Details"}),(0,t.jsx)(eg.SP,{value:"contact",children:"Contact Details"}),(0,t.jsx)(eg.SP,{value:"address",children:"Address Details"})]}),(0,t.jsx)(eg.nU,{value:"personal",children:(0,t.jsx)(T.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"flex gap-3 col-span-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(H,{htmlFor:"type-of-id",children:"Type of ID"}),(0,t.jsxs)(er,{value:c.idType,onValueChange:e=>f("idType",e),children:[(0,t.jsx)(en,{id:"type-of-id",className:(null==n?void 0:n.idType)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select ID type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South African ID",children:"South African ID"}),(0,t.jsx)(em,{value:"Passport",children:"Passport"})]})]}),(null==n?void 0:n.idType)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.idType})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)(H,{htmlFor:"id-input",children:["ID Number / Passport Number","South African ID"===c.idType&&(0,t.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"(13 digits)"})]}),(0,t.jsx)(Y,{id:"id-input","data-testid":"id-input","aria-label":"ID Number / Passport Number",value:c.idNumber,onChange:e=>f("idNumber",e.target.value),className:(null==n?void 0:n.idNumber)||j.length>0?"border-red-500":""}),((null==n?void 0:n.idNumber)||j.length>0)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:(null==n?void 0:n.idNumber)||j[0]})]})]}),"South African ID"===c.idType&&j.length>0&&(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsx)("ul",{className:"text-sm text-red-500 mt-1 pl-4 list-disc",children:j.map((e,a)=>(0,t.jsx)("li",{children:e},a))})}),(0,t.jsxs)("div",{className:"col-span-3 grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"firstName",children:"First Name"}),(0,t.jsx)(Y,{id:"firstName",value:c.firstName,onChange:e=>f("firstName",e.target.value),className:(null==n?void 0:n.firstName)?"border-red-500":""}),(null==n?void 0:n.firstName)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.firstName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"lastName",children:"Last Name"}),(0,t.jsx)(Y,{id:"lastName",value:c.lastName,onChange:e=>f("lastName",e.target.value),className:(null==n?void 0:n.lastName)?"border-red-500":""}),(null==n?void 0:n.lastName)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.lastName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"initials",children:"Initials"}),(0,t.jsx)(Y,{id:"initials",value:c.initials,onChange:e=>f("initials",e.target.value),className:(null==n?void 0:n.initials)?"border-red-500":""}),(null==n?void 0:n.initials)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.initials})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"dateOfBirth",children:"Date of Birth"}),(0,t.jsx)(e1,{selected:c.dateOfBirth,onSelect:e=>f("dateOfBirth",e),className:(null==n?void 0:n.dateOfBirth)?"border-red-500":""}),(null==n?void 0:n.dateOfBirth)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.dateOfBirth})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"gender",children:"Gender"}),(0,t.jsxs)(er,{value:c.gender,onValueChange:e=>f("gender",e),children:[(0,t.jsx)(en,{id:"gender",className:(null==n?void 0:n.gender)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select gender"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Male",children:"Male"}),(0,t.jsx)(em,{value:"Female",children:"Female"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==n?void 0:n.gender)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.gender})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"relationshipToMainMember",children:"Relationship"}),(0,t.jsxs)(er,{value:c.relationshipToMainMember,onValueChange:e=>f("relationshipToMainMember",e),children:[(0,t.jsx)(en,{id:"relationshipToMainMember",className:(null==n?void 0:n.relationshipToMainMember)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select relationship"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Spouse",children:"Spouse"}),(0,t.jsx)(em,{value:"Child",children:"Child"}),(0,t.jsx)(em,{value:"Parent",children:"Parent"}),(0,t.jsx)(em,{value:"Sibling",children:"Sibling"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==n?void 0:n.relationshipToMainMember)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.relationshipToMainMember})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"nationality",children:"Nationality"}),(0,t.jsxs)(er,{value:c.nationality,onValueChange:e=>f("nationality",e),children:[(0,t.jsx)(en,{id:"nationality",className:(null==n?void 0:n.nationality)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select nationality"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South African",children:"South African"}),(0,t.jsx)(em,{value:"Zimbabwean",children:"Zimbabwean"}),(0,t.jsx)(em,{value:"Mozambican",children:"Mozambican"}),(0,t.jsx)(em,{value:"Namibian",children:"Namibian"}),(0,t.jsx)(em,{value:"Botswanan",children:"Botswanan"}),(0,t.jsx)(em,{value:"Lesotho",children:"Lesotho"}),(0,t.jsx)(em,{value:"Swazi",children:"Swazi"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==n?void 0:n.nationality)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.nationality})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"dependentStatus",children:"Status"}),(0,t.jsxs)(er,{value:c.dependentStatus,onValueChange:e=>f("dependentStatus",e),children:[(0,t.jsx)(en,{id:"dependentStatus",className:(null==n?void 0:n.dependentStatus)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Active",children:"Active"}),(0,t.jsx)(em,{value:"Inactive",children:"Inactive"})]})]}),(null==n?void 0:n.dependentStatus)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.dependentStatus})]})]})]})})}),(0,t.jsx)(eg.nU,{value:"contact",children:(0,t.jsxs)(T.Zb,{className:"p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Contact Details"}),(0,t.jsxs)("div",{className:"space-y-2",children:[o.map((e,a)=>(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)(er,{value:e.type,onValueChange:e=>N(a,"type",e),children:[(0,t.jsx)(en,{className:"w-[180px] ".concat((null==n?void 0:n["contact".concat(a,"Type")])?"border-red-500":""),children:(0,t.jsx)(ei,{placeholder:"Select contact type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Email",children:"Email"}),(0,t.jsx)(em,{value:"Phone Number",children:"Phone Number"})]})]}),(null==n?void 0:n["contact".concat(a,"Type")])&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n["contact".concat(a,"Type")]})]}),(0,t.jsxs)("div",{className:"flex-[2]",children:[(0,t.jsx)(Y,{value:e.value,onChange:e=>N(a,"value",e.target.value),className:(null==n?void 0:n["contact".concat(a,"Value")])?"border-red-500":"",placeholder:"Email"===e.type?"Enter email address":"Enter phone number"}),(null==n?void 0:n["contact".concat(a,"Value")])&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n["contact".concat(a,"Value")]})]}),(0,t.jsx)(y.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>b(a),children:"Remove"})]})},a)),(0,t.jsx)(y.z,{id:"Add Contact",type:"button",onClick:()=>{p(null);let e=[...o,{type:"Email",value:""}];m(e),s({...a,contactDetails:e})},size:"sm",className:"mt-2",children:"Add Contact"})]})]})}),(0,t.jsx)(eg.nU,{value:"address",children:(0,t.jsxs)(T.Zb,{className:"p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Address Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(H,{htmlFor:"streetAddress",children:"Street Address"}),(0,t.jsx)(Y,{id:"streetAddress",value:u.streetAddress,onChange:e=>g("streetAddress",e.target.value),className:(null==n?void 0:n.streetAddress)?"border-red-500":""}),(null==n?void 0:n.streetAddress)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.streetAddress})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"city",children:"City"}),(0,t.jsx)(Y,{id:"city",value:u.city,onChange:e=>g("city",e.target.value),className:(null==n?void 0:n.city)?"border-red-500":""}),(null==n?void 0:n.city)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.city})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"stateProvince",children:"State/Province"}),(0,t.jsx)(Y,{id:"stateProvince",value:u.stateProvince,onChange:e=>g("stateProvince",e.target.value),className:(null==n?void 0:n.stateProvince)?"border-red-500":""}),(null==n?void 0:n.stateProvince)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.stateProvince})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"postalCode",children:"Postal Code"}),(0,t.jsx)(Y,{id:"postalCode",value:u.postalCode,onChange:e=>g("postalCode",e.target.value),className:(null==n?void 0:n.postalCode)?"border-red-500":""}),(null==n?void 0:n.postalCode)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.postalCode})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"country",children:"Country"}),(0,t.jsxs)(er,{value:u.country,onValueChange:e=>g("country",e),children:[(0,t.jsx)(en,{id:"country",className:(null==n?void 0:n.country)?"border-red-500":"",children:(0,t.jsx)(ei,{placeholder:"Select country"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"South Africa",children:"South Africa"}),(0,t.jsx)(em,{value:"Other",children:"Other"})]})]}),(null==n?void 0:n.country)&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:n.country})]})]})]})})]})})}var ad=s(43745);let ao={isDeleting:!1,personalInfo:{firstName:"",lastName:"",initials:"",dateOfBirth:null,gender:"",relationshipToMainMember:"",nationality:"",idType:"South African ID",idNumber:"",dependentStatus:"Active",medicalAidNumber:"",employer:"",school:"",idDocumentUrl:null},contactDetails:[],addressDetails:{streetAddress:"",city:"",stateProvince:"",postalCode:"",country:""}},am=async(e,a)=>{try{let s=(0,ej.IO)((0,ej.hJ)(ev.db,"Contracts"),(0,ej.ar)("contractNumber","==",e)),t=await (0,ej.PL)(s);if(t.empty)throw Error("Contract not found");let l=t.docs[0].data().policiesId,r=await (0,ej.QT)((0,ej.JU)(ev.db,"Policies",l));if(!r.exists())throw Error("policies not found");let i=r.data().maxDependents||0;return a<i}catch(e){return console.error("Error checking dependent limit:",e),!1}},au=async(e,a,s)=>{try{let t=await (0,ej.ET)((0,ej.hJ)(ev.db,"Dependents"),{...e.personalInfo,contractNumber:a,mainMemberIdNumber:s,type:"Dependent",createdAt:new Date,updatedAt:new Date}),l=e.contactDetails.map(e=>(0,ej.ET)((0,ej.hJ)(ev.db,"Contacts"),{...e,dependentId:t.id,contractNumber:a,mainMemberIdNumber:s,type:"Dependent",createdAt:new Date,updatedAt:new Date}));return await (0,ej.ET)((0,ej.hJ)(ev.db,"Address"),{...e.addressDetails,dependentId:t.id,contractNumber:a,mainMemberIdNumber:s,type:"Dependent",createdAt:new Date,updatedAt:new Date}),await Promise.all(l),t.id}catch(e){throw console.error("Error saving dependent:",e),e}},ah=async(e,a)=>{try{let s=(0,ej.IO)((0,ej.hJ)(ev.db,"Address"),(0,ej.ar)("dependentId","==",e),(0,ej.ar)("contractNumber","==",a),(0,ej.ar)("type","==","Dependent")),t=(await (0,ej.PL)(s)).docs.map(e=>(0,ej.oe)(e.ref));await Promise.all(t);let l=(0,ej.IO)((0,ej.hJ)(ev.db,"Contacts"),(0,ej.ar)("dependentId","==",e),(0,ej.ar)("contractNumber","==",a),(0,ej.ar)("type","==","Dependent")),r=(await (0,ej.PL)(l)).docs.map(e=>(0,ej.oe)(e.ref));await Promise.all(r);let i=(0,ej.IO)((0,ej.hJ)(ev.db,"Dependents"),(0,ej.ar)("id","==",e),(0,ej.ar)("contractNumber","==",a),(0,ej.ar)("type","==","Dependent")),n=await (0,ej.PL)(i);n.empty||await (0,ej.oe)(n.docs[0].ref)}catch(e){throw console.error("Error removing dependent:",e),Error("Failed to remove dependent and related records")}},ax=e=>{var a,s,t,l,r,i,n,c,d,o,m,u,h;let x=[];if((null===(a=e.personalInfo.firstName)||void 0===a?void 0:a.trim())||x.push("First Name is required"),(null===(s=e.personalInfo.lastName)||void 0===s?void 0:s.trim())||x.push("Last Name is required"),(null===(t=e.personalInfo.initials)||void 0===t?void 0:t.trim())||x.push("Initials are required"),e.personalInfo.dateOfBirth||x.push("Date of Birth is required"),(null===(l=e.personalInfo.gender)||void 0===l?void 0:l.trim())||x.push("Gender is required"),(null===(r=e.personalInfo.relationshipToMainMember)||void 0===r?void 0:r.trim())||x.push("Relationship to Main Member is required"),(null===(i=e.personalInfo.nationality)||void 0===i?void 0:i.trim())||x.push("Nationality is required"),(null===(n=e.personalInfo.idType)||void 0===n?void 0:n.trim())||x.push("Type of ID is required"),(null===(c=e.personalInfo.idNumber)||void 0===c?void 0:c.trim())||x.push("ID Number is required"),e.personalInfo.dependentStatus||x.push("Dependent Status is required"),"South African ID"===e.personalInfo.idType&&e.personalInfo.idNumber&&!/^\d{13}$/.test(e.personalInfo.idNumber.trim())&&x.push("South African ID number must be 13 digits"),e.personalInfo.dateOfBirth){let a=new Date().getFullYear()-e.personalInfo.dateOfBirth.getFullYear();"Child"===e.personalInfo.relationshipToMainMember&&a>=21&&x.push("Child dependents must be under 21 years old")}return e.contactDetails.length>0&&e.contactDetails.forEach((e,a)=>{var s;e.type||x.push("Contact type is required for contact #".concat(a+1)),(null===(s=e.value)||void 0===s?void 0:s.trim())||x.push("Contact value is required for contact #".concat(a+1)),"Email"===e.type&&e.value&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())&&x.push("Invalid email format for contact #".concat(a+1)),"Phone Number"===e.type&&e.value&&!/^[0-9+\-\s()]{10,}$/.test(e.value.trim())&&x.push("Invalid phone number format for contact #".concat(a+1))}),Object.values(e.addressDetails).some(e=>""!==e.trim())&&((null===(d=e.addressDetails.streetAddress)||void 0===d?void 0:d.trim())||x.push("Street Address is required when providing address details"),(null===(o=e.addressDetails.city)||void 0===o?void 0:o.trim())||x.push("City is required when providing address details"),(null===(m=e.addressDetails.stateProvince)||void 0===m?void 0:m.trim())||x.push("State/Province is required when providing address details"),(null===(u=e.addressDetails.postalCode)||void 0===u?void 0:u.trim())||x.push("Postal Code is required when providing address details"),(null===(h=e.addressDetails.country)||void 0===h?void 0:h.trim())||x.push("Country is required when providing address details"),e.addressDetails.postalCode&&!/^\d{4}$/.test(e.addressDetails.postalCode)&&x.push("Invalid South African postal code")),x};function ap(e){let{dependents:a,updateDependents:s,contractNumber:r,mainMemberIdNumber:i}=e,[n,c]=(0,l.useState)(!1),[d,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(null),[h,x]=(0,l.useState)(ao),[p,j]=(0,l.useState)(null),[v,f]=(0,l.useState)(null),[N,g]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[C,D]=(0,l.useState)(null),[S,I]=(0,l.useState)(!1),[A,P]=(0,l.useState)(null),[M,k]=(0,l.useState)({checking:!1,isDuplicate:!1,message:null});(0,l.useEffect)(()=>{(async()=>{if(r){I(!0);try{let e=await am(r,a.length);P(e?a.length+1:a.length)}catch(e){console.error("Error checking policies limit:",e)}finally{I(!1)}}})()},[r,a.length]);let O=async e=>{k(e=>({...e,checking:!0}));try{let a=(0,ej.IO)((0,ej.hJ)(ev.db,"Dependents"),(0,ej.ar)("idNumber","==",e),(0,ej.ar)("status","==","Active")),s=!(await (0,ej.PL)(a)).empty;return k({checking:!1,isDuplicate:s,message:s?"This person is already registered as a dependent":null}),s}catch(e){return console.error("Error checking duplicate:",e),k({checking:!1,isDuplicate:!1,message:"Error checking duplicate status"}),!1}},E=async()=>{try{if(!r||!i){j("Contract information is missing. Please add main member details first.");return}if(g(!0),j(null),!await am(r,a.length)){j("Maximum number of dependents (".concat(A,") reached for this policies")),g(!1);return}if("South African ID"===h.personalInfo.idType&&h.personalInfo.idNumber){let e=h.personalInfo.idNumber.trim();if(e.match(/^\d{6}/)){let a=(parseInt(e.substring(0,2))>22?"19":"20")+e.substring(0,2),s=e.substring(2,4),t=e.substring(4,6),l=new Date("".concat(a,"-").concat(s,"-").concat(t));isNaN(l.getTime())||(h.personalInfo.dateOfBirth=l)}}let e=ax(h);if(e.length>0){let a={};e.forEach(e=>{if(e.includes("First Name")&&(a.firstName=e),e.includes("Last Name")&&(a.lastName=e),e.includes("Initials")&&(a.initials=e),e.includes("Date of Birth")&&(a.dateOfBirth=e),e.includes("Gender")&&(a.gender=e),e.includes("Relationship")&&(a.relationshipToMainMember=e),e.includes("Nationality")&&(a.nationality=e),e.includes("Type of ID")&&(a.idType=e),(e.includes("ID Number")||e.includes("South African ID number"))&&(a.idNumber=e),e.includes("Dependent Status")&&(a.dependentStatus=e),e.includes("Child dependents")&&(a.relationshipToMainMember=e),e.includes("contact")){var s;let t=null===(s=e.match(/contact #(\d+)/))||void 0===s?void 0:s[1];if(t){let s=parseInt(t)-1;e.includes("type")&&(a["contact".concat(s,"Type")]=e),(e.includes("value")||e.includes("email")||e.includes("phone"))&&(a["contact".concat(s,"Value")]=e)}}e.includes("Street Address")&&(a.streetAddress=e),e.includes("City")&&(a.city=e),e.includes("State/Province")&&(a.stateProvince=e),(e.includes("Postal Code")||e.includes("postal code"))&&(a.postalCode=e),e.includes("Country")&&(a.country=e)}),j((0,t.jsx)(ac,{data:h,updateData:x,validationErrors:a,mainMemberIdNumber:i})),g(!1);return}if(await O(h.personalInfo.idNumber)){j("This person is already registered as a dependent");return}let l=await au(h,r,i),n={...h,id:l};s([...a,n]),c(!1),x(ao),j(null)}catch(e){console.error("Error adding dependent:",e),j(e instanceof Error?e.message:"Failed to add dependent. Please try again.")}finally{g(!1)}},F=async()=>{try{if(!r||!i){j("Contract information is missing");return}g(!0),j(null);let e=ax(h);if(e.length>0){let a={};e.forEach(e=>{if(e.includes("First Name")&&(a.firstName=e),e.includes("Last Name")&&(a.lastName=e),e.includes("Initials")&&(a.initials=e),e.includes("Date of Birth")&&(a.dateOfBirth=e),e.includes("Gender")&&(a.gender=e),e.includes("Relationship")&&(a.relationshipToMainMember=e),e.includes("Nationality")&&(a.nationality=e),e.includes("Type of ID")&&(a.idType=e),(e.includes("ID Number")||e.includes("South African ID number"))&&(a.idNumber=e),e.includes("Dependent Status")&&(a.dependentStatus=e),e.includes("Child dependents")&&(a.relationshipToMainMember=e),e.includes("contact")){var s;let t=null===(s=e.match(/contact #(\d+)/))||void 0===s?void 0:s[1];if(t){let s=parseInt(t)-1;e.includes("type")&&(a["contact".concat(s,"Type")]=e),(e.includes("value")||e.includes("email")||e.includes("phone"))&&(a["contact".concat(s,"Value")]=e)}}e.includes("Street Address")&&(a.streetAddress=e),e.includes("City")&&(a.city=e),e.includes("State/Province")&&(a.stateProvince=e),(e.includes("Postal Code")||e.includes("postal code"))&&(a.postalCode=e),e.includes("Country")&&(a.country=e)}),j((0,t.jsx)(ac,{data:h,updateData:x,validationErrors:a,mainMemberIdNumber:i})),g(!1);return}if(null!==m){let e=await au(h,r,i),t=[...a];t[m]={...h,id:e},s(t),c(!1),o(null),u(null),x(ao),j(null)}}catch(e){console.error("Error updating dependent:",e),j("Failed to update dependent. Please try again.")}finally{g(!1)}},T=async e=>{if(!N)try{g(!0);let t=a[e];if(t.id&&r){let l=[...a];l[e]={...t,isDeleting:!0},s(l),await ah(t.id,r),s(a.filter((a,s)=>s!==e)),f(null),w(!1),D(null)}}catch(l){console.error("Error removing dependent:",l);let t=[...a];e<t.length&&(t[e]={...t[e],isDeleting:!1},s(t)),f(l instanceof Error?l.message:"Failed to remove dependent. Please try again.")}finally{g(!1)}},L=null!==A&&a.length>=A,U=null!==A&&a.length>=A-1;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Dependents"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Add or manage dependents for this contract"}),S?(0,t.jsxs)("span",{className:"text-sm text-gray-400 flex items-center",children:[(0,t.jsx)(Q.Z,{className:"w-3 h-3 mr-1 animate-spin"}),"Checking policies limit..."]}):null!==A&&(0,t.jsxs)("span",{className:"text-sm ".concat(L?"text-red-500":U?"text-yellow-500":"text-gray-500"),children:["(",a.length,"/",A," dependents)",L&&" - Maximum limit reached",U&&!L&&" - Approaching limit"]})]})]}),(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsxs)(eh.Vq,{open:n,onOpenChange:e=>{N||(c(e),e||(o(null),u(null),x(ao),j(null)))},children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsx)(y.z,{id:"Add Dependent",onClick:()=>{N||(o(null),u(null),x(ao),j(null))},disabled:N||L,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e8.Z,{className:"w-4 h-4 mr-2"}),"Add Dependent"]})})}),(0,t.jsxs)(eh.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,t.jsx)(eh.fK,{children:(0,t.jsxs)(eh.$N,{children:[d?"Edit Dependent":"Add New Dependent",N&&(0,t.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"(Saving...)"})]})}),(0,t.jsx)(ac,{data:d||h,updateData:e=>{if("South African ID"===e.personalInfo.idType&&e.personalInfo.idNumber&&e.personalInfo.idNumber.length>=6){let a=e.personalInfo.idNumber.trim();if(a.match(/^\d{6}/)){let s=(parseInt(a.substring(0,2))>22?"19":"20")+a.substring(0,2),t=a.substring(2,4),l=a.substring(4,6),r=new Date("".concat(s,"-").concat(t,"-").concat(l));isNaN(r.getTime())||(e.personalInfo.dateOfBirth=r)}}x(e),j(null)},error:"string"==typeof p?p:null,mainMemberIdNumber:i,validationErrors:"string"!=typeof p&&l.isValidElement(p)?p.props.validationErrors:{}}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>{N||(c(!1),o(null),u(null),x(ao),j(null))},disabled:N,children:"Cancel"}),(0,t.jsx)(y.z,{onClick:d?F:E,disabled:N,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"w-4 h-4 mr-2 animate-spin"}),d?"Updating...":"Adding..."]}):"Save"})]})]})]})})}),(0,t.jsx)(Z._v,{children:L?"Maximum number of dependents reached for your policies":"Add a new dependent to this contract"})]})})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("th",{className:"text-left p-4",children:"Name"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Relationship"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Status"}),(0,t.jsx)("th",{className:"text-left p-4",children:"Age"}),(0,t.jsx)("th",{className:"text-right p-4",children:"Actions"})]})}),(0,t.jsxs)("tbody",{children:[a.map((e,a)=>(0,t.jsxs)("tr",{className:"border-b hover:bg-gray-50 transition-all duration-200 ".concat(e.isDeleting?"opacity-50 bg-gray-50":""),children:[(0,t.jsxs)("td",{className:"p-4",children:[e.personalInfo.firstName," ",e.personalInfo.lastName]}),(0,t.jsx)("td",{className:"p-4",children:e.personalInfo.relationshipToMainMember}),(0,t.jsx)("td",{className:"p-4",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm ".concat("Active"===e.personalInfo.dependentStatus?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:["Active"===e.personalInfo.dependentStatus?(0,t.jsx)(ae.Z,{className:"w-3 h-3"}):(0,t.jsx)(ad.Z,{className:"w-3 h-3"}),e.personalInfo.dependentStatus]})}),(0,t.jsx)("td",{className:"p-4",children:e.personalInfo.dateOfBirth?(0,t.jsxs)("span",{className:"text-sm",children:[new Date().getFullYear()-e.personalInfo.dateOfBirth.getFullYear()," years"]}):(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"Not specified"})}),(0,t.jsxs)("td",{className:"p-4 text-right space-x-2",children:[(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"outline",size:"sm",disabled:e.isDeleting||N,onClick:()=>{o(e),u(a),c(!0)},children:e.isDeleting?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"w-3 h-3 mr-1 animate-spin"}),"Removing..."]}):"Edit"})}),(0,t.jsx)(Z._v,{children:e.isDeleting?"Removing dependent...":"Edit dependent details"})]})}),(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"destructive",size:"sm",disabled:e.isDeleting||N,onClick:()=>{D(a),w(!0)},children:e.isDeleting?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"w-3 h-3 mr-1 animate-spin"}),"Removing..."]}):"Remove"})}),(0,t.jsx)(Z._v,{children:e.isDeleting?"Removing dependent...":"Remove this dependent"})]})})]})]},a)),0===a.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"text-center p-4 text-gray-500",children:S?(0,t.jsxs)("span",{className:"flex items-center justify-center",children:[(0,t.jsx)(Q.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Checking policies details..."]}):(0,t.jsx)("span",{children:"No dependents added yet"})})})]})]})}),(0,t.jsx)(eh.Vq,{open:b,onOpenChange:e=>{N||(w(e),e||(D(null),f(null)))},children:(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:v?"Error Removing Dependent":"Confirm Deletion"})}),(0,t.jsx)("div",{className:"py-4",children:v?(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:v})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-gray-600",children:"Are you sure you want to remove this dependent? This action cannot be undone."}),null!==C&&(0,t.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[(0,t.jsxs)("p",{className:"font-medium",children:[a[C].personalInfo.firstName," ",a[C].personalInfo.lastName]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[a[C].personalInfo.relationshipToMainMember," • ",a[C].personalInfo.dependentStatus]}),a[C].personalInfo.medicalAidNumber&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Medical Aid: ",a[C].personalInfo.medicalAidNumber]}),a[C].personalInfo.employer&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Employer: ",a[C].personalInfo.employer]}),a[C].personalInfo.school&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["School: ",a[C].personalInfo.school]})]})]})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>{N||(w(!1),D(null),f(null))},disabled:N,children:v?"Close":"Cancel"}),!v&&(0,t.jsx)(y.z,{variant:"destructive",onClick:()=>null!==C&&T(C),disabled:N,children:N?"Removing...":"Remove Dependent"})]})]})})]})}var aj=s(42325);let av=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(aj.fC,{className:(0,A.cn)("grid gap-2",s),...l,ref:a})});av.displayName=aj.fC.displayName;let af=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(aj.ck,{ref:a,className:(0,A.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:(0,t.jsx)(aj.z$,{className:"flex items-center justify-center",children:(0,t.jsx)(I.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});function aN(e){var a,s,r;let{selectedpolicies:i,onpolicieselect:n,selectedCateringOptions:c=[]}=e,[d,o]=(0,l.useState)([]),[m,u]=(0,l.useState)(!0),[h,x]=(0,l.useState)(null),[p,j]=(0,l.useState)(null),[v,f]=(0,l.useState)([]),[N,y]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{try{u(!0),x(null);let e=(0,ej.hJ)(ev.db,"Policies"),a=(await (0,ej.PL)(e)).docs.map(e=>{let a=e.data();return{id:a.id,name:a.name||"Unnamed policies",description:a.description||"No description available",premium:a.premium||0,coverAmount:a.coverAmount||0,features:a.features||[],maxDependents:a.maxDependents||0}});0===a.length?x("No policies available at the moment. Please try again later."):o(a)}catch(e){console.error("Error fetching policies:",e),x("Failed to load policies. Please check your connection and try again.")}finally{u(!1)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"features"),(0,ej.Xo)("id","asc")),a=(await (0,ej.PL)(e)).docs.map(e=>({id:e.data().id,...e.data()}));f(a);let s=a.reduce((e,a)=>({...e,[a.id]:a.name}),{});y(s)}catch(e){console.error("Error fetching features:",e)}})()},[]);let g=async e=>{try{j(e);let a=d.find(a=>a.name===e);a&&n({policiesId:a.id,name:a.name,coverAmount:a.coverAmount.toString(),premium:a.premium})}catch(e){console.error("Error selecting policy:",e),x("Failed to select policy. Please try again.")}finally{j(null)}};return m?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(e3.O,{className:"h-8 w-48 mb-2"}),(0,t.jsx)(e3.O,{className:"h-4 w-96"})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsxs)(T.Zb,{className:"relative",children:[(0,t.jsxs)(T.Ol,{children:[(0,t.jsx)(e3.O,{className:"h-6 w-32 mb-2"}),(0,t.jsx)(e3.O,{className:"h-4 w-48"})]}),(0,t.jsxs)(T.aY,{children:[(0,t.jsx)(e3.O,{className:"h-8 w-24 mb-4"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(e3.O,{className:"h-4 w-full"}),(0,t.jsx)(e3.O,{className:"h-4 w-full"}),(0,t.jsx)(e3.O,{className:"h-4 w-full"})]})]})]},e))})]}):h?(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-6",children:[(0,t.jsx)(ex.Cd,{children:"Error Loading policies"}),(0,t.jsxs)(ex.X,{children:[h,(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-2 underline hover:no-underline",children:"Refresh page"})]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Select a Policy"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Choose the policy that best suits your needs and budget"})]}),(0,t.jsx)(av,{value:i.name,onValueChange:g,children:(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:d.map(e=>(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsxs)(T.Zb,{className:"relative cursor-pointer transition-all duration-200 hover:shadow-md ".concat(i.name===e.name?"border-primary ring-1 ring-primary ring-opacity-50 shadow-md transform scale-[1.01]":"hover:border-primary/50"," ").concat(p===e.name?"opacity-70":""),children:[(0,t.jsxs)(T.Ol,{className:"space-y-3 p-4",children:[(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(af,{value:e.name,id:e.name,"data-value":e.name,disabled:null!==p,className:"h-4 w-4 mt-1"}),(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(T.ll,{children:(0,t.jsxs)(H,{htmlFor:e.name,className:"cursor-pointer text-base font-semibold",children:[e.name,p===e.name&&(0,t.jsx)(Q.Z,{className:"w-3 h-3 ml-2 inline animate-spin"})]})}),(0,t.jsx)(T.SZ,{className:"text-xs line-clamp-2",children:e.description})]})]}),(0,t.jsx)("div",{className:"pt-2 border-t",children:(0,t.jsxs)("div",{className:"flex justify-between items-baseline gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-primary",children:["R",e.premium.toLocaleString()]}),(0,t.jsx)("div",{className:"text-xs font-medium text-muted-foreground",children:"per month"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-lg font-bold text-gray-700",children:["R",e.coverAmount.toLocaleString()]}),(0,t.jsx)("div",{className:"text-xs font-medium text-muted-foreground",children:"cover amount"})]})]})})]}),(0,t.jsx)(T.aY,{className:"p-4 pt-0",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-muted-foreground",children:"Policy Features:"}),(0,t.jsxs)("ul",{className:"space-y-2",children:[e.features.map(e=>(0,t.jsxs)("li",{className:"flex items-center text-xs",children:[(0,t.jsx)("span",{className:"mr-2 flex-shrink-0 rounded-full bg-primary/10 p-0.5",children:(0,t.jsx)("svg",{className:"h-2.5 w-2.5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("span",{className:"text-gray-600",children:N[e]||e})]},e)),(0,t.jsxs)("li",{className:"flex items-center text-xs mt-2 pt-2 border-t",children:[(0,t.jsx)("span",{className:"mr-2 flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-4 w-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,t.jsxs)("span",{className:"font-medium text-blue-600",children:["Up to ",e.maxDependents," dependents included"]})]})]})]})})]})}),(0,t.jsx)(Z._v,{side:"right",className:"max-w-[250px]",children:(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description}),(0,t.jsxs)("p",{className:"text-xs",children:["Includes coverage for up to ",e.maxDependents," dependents"]})]})})]})},e.id))})}),i.name&&(0,t.jsxs)(ex.bZ,{className:"mt-4 border-primary/20 bg-primary/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"h-4 w-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)(ex.Cd,{className:"text-primary font-semibold text-sm",children:"Contract Overview"})]}),(0,t.jsxs)(ex.X,{className:"mt-2 flex flex-col gap-1 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Selected Policy:"}),(0,t.jsx)("span",{className:"font-semibold",id:"Selected Policy",children:i.name})]}),(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Policy Premium:"}),(0,t.jsxs)("span",{className:"font-semibold",id:"Policy Premium",children:["R",null===(a=i.premium)||void 0===a?void 0:a.toLocaleString()]})]}),c.length>0&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Catering Options Total:"}),(0,t.jsxs)("span",{className:"font-semibold",id:"Catering Options Total",children:["R",c.reduce((e,a)=>e+a.price,0).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex items-baseline gap-2 pt-2 border-t mt-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Monthly Premium:"}),(0,t.jsxs)("span",{className:"text-base font-bold text-primary",id:"Total Monthly Premium",children:["R",((i.premium||0)+c.reduce((e,a)=>e+a.price,0)).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Cover Amount:"}),(0,t.jsxs)("span",{className:"text-base font-bold",id:"Cover Amount",children:["R",i.coverAmount]})]}),(null===(s=d.find(e=>e.name===i.name))||void 0===s?void 0:s.maxDependents)&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:(0,t.jsxs)("span",{className:"inline-flex items-center",children:[(0,t.jsx)("svg",{className:"h-3 w-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Includes coverage for up to ",null===(r=d.find(e=>e.name===i.name))||void 0===r?void 0:r.maxDependents," dependents"]})}),c.length>0&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Selected Catering Options:"}),(0,t.jsx)("ul",{className:"space-y-1",children:c.map(e=>(0,t.jsxs)("li",{className:"text-xs flex justify-between",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{className:"font-medium",children:["R",e.price.toLocaleString()]})]},e.id))})]})]})]})]})}af.displayName=aj.ck.displayName;var ay=s(9270);let ag=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(ay.fC,{ref:a,className:(0,A.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...l,children:(0,t.jsx)(ay.z$,{className:(0,A.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(S.Z,{className:"h-4 w-4"})})})});function ab(e){let{selectedOptions:a,onChange:s}=e,[r,i]=(0,l.useState)([]),[n,c]=(0,l.useState)(!0),[d,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(null),[h,x]=(0,l.useState)(0);(0,l.useEffect)(()=>{(async()=>{try{c(!0),o(null);let e=(0,ej.hJ)(ev.db,"catering"),a=(await (0,ej.PL)(e)).docs.map(e=>{let a=e.data();return{id:e.id,name:a.name||"Unnamed Option",description:a.description||"No description available",price:a.price||0,available:!1!==a.available,minimumOrder:a.minimumOrder,maximumOrder:a.maximumOrder}});0===a.length?o("No catering options available at the moment. Please try again later."):i(a)}catch(e){console.error("Error fetching catering options:",e),o("Failed to load catering options. Please check your connection and try again.")}finally{c(!1)}})()},[]),(0,l.useEffect)(()=>{x(a.reduce((e,a)=>e+a.price,0))},[a]);let p=async e=>{try{u(e);let t=r.find(a=>a.id===e);if(!t)return;a.some(a=>a.id===e)?s(a.filter(a=>a.id!==e)):s([...a,{id:t.id,name:t.name,price:t.price}])}catch(e){console.error("Error toggling option:",e),o("Failed to update selection. Please try again.")}finally{u(null)}};return n?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(e3.O,{className:"h-8 w-48 mb-2"}),(0,t.jsx)(e3.O,{className:"h-4 w-96"})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2,3,4].map(e=>(0,t.jsxs)(T.Zb,{children:[(0,t.jsxs)(T.Ol,{className:"pb-2",children:[(0,t.jsx)(e3.O,{className:"h-6 w-32 mb-2"}),(0,t.jsx)(e3.O,{className:"h-4 w-48"})]}),(0,t.jsx)(T.aY,{children:(0,t.jsx)(e3.O,{className:"h-6 w-24"})})]},e))})]}):d?(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-6",children:[(0,t.jsx)(ex.Cd,{children:"Error Loading Catering Options"}),(0,t.jsxs)(ex.X,{children:[d,(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-2 underline hover:no-underline",children:"Refresh page"})]})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Additional Services"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Select additional services you would like to include"})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:r.map(e=>(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsxs)(T.Zb,{className:"relative transition-all duration-200 ".concat(a.some(a=>a.id===e.id)?"border-primary ring-2 ring-primary ring-opacity-50":""," ").concat(e.available?"":"opacity-50"," ").concat(m===e.id?"opacity-70":""),children:[(0,t.jsxs)(T.Ol,{className:"pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ag,{id:e.id,"data-value":e.name,checked:a.some(a=>a.id===e.id),onCheckedChange:()=>p(e.id),disabled:!e.available||null!==m,className:"data-[state=checked]:bg-primary"}),(0,t.jsx)(T.ll,{children:(0,t.jsxs)(H,{htmlFor:e.id,className:"cursor-pointer ".concat(e.available?"":"text-gray-400"),children:[e.name,m===e.id&&(0,t.jsx)(Q.Z,{className:"w-4 h-4 ml-2 inline animate-spin"}),!e.available&&(0,t.jsx)("span",{className:"ml-2 text-sm text-red-500",children:"(Unavailable)"})]})})]}),(0,t.jsx)(T.SZ,{children:e.description}),(e.minimumOrder||e.maximumOrder)&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[e.minimumOrder&&(0,t.jsxs)("span",{children:["Minimum: ",e.minimumOrder," • "]}),e.maximumOrder&&(0,t.jsxs)("span",{children:["Maximum: ",e.maximumOrder]})]})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"text-lg font-bold",children:["R",e.price.toLocaleString()]})})]})}),(0,t.jsx)(Z._v,{children:e.available?m===e.id?"Processing your selection...":a.some(a=>a.id===e.id)?"Click to remove this option":"Click to add this option":"This option is currently unavailable"})]})},e.id))}),a.length>0&&(0,t.jsxs)(ex.bZ,{className:"mt-4",children:[(0,t.jsxs)(ex.Cd,{children:["Selected Options (",a.length,")"]}),(0,t.jsx)(ex.X,{children:(0,t.jsxs)("ul",{className:"mt-2 space-y-1",children:[a.map(e=>(0,t.jsxs)("li",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{children:["R",e.price.toLocaleString()]})]},e.id)),(0,t.jsxs)("li",{className:"flex justify-between font-bold pt-2 border-t",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:["R",h.toLocaleString()]})]})]})})]})]})}ag.displayName=ay.fC.displayName;var aw=s(32660),aC=s(76858),aD=s(99376);let aS={mainMember:{personalInfo:{title:"",firstName:"",lastName:"",initials:"",dateOfBirth:null,gender:"",language:"",maritalStatus:"",nationality:"",idType:"South African ID",idNumber:"",idDocumentUrl:null},contactDetails:[],addressDetails:{streetAddress:"",city:"",stateProvince:"",postalCode:"",country:""}},beneficiaries:[],dependents:[],policiesDetails:{policiesId:"",name:"",coverAmount:"",premium:null},cateringOptions:[]};function aI(e){let{userRole:a}=e,[s,r]=(0,l.useState)("policies"),[i,n]=(0,l.useState)(null),[c,d]=(0,l.useState)(!1),[o,m]=(0,l.useState)(!1),[u,h]=(0,l.useState)({mainMember:{personalInfo:{title:"",firstName:"",lastName:"",initials:"",dateOfBirth:null,gender:"",language:"",maritalStatus:"",nationality:"",idType:"South African ID",idNumber:"",idDocumentUrl:null},contactDetails:[],addressDetails:{streetAddress:"",city:"",stateProvince:"",postalCode:"",country:""}},beneficiaries:[],dependents:[],policiesDetails:{policiesId:"",name:"",coverAmount:"",premium:null},cateringOptions:[]}),[x,p]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),f=(0,aD.useRouter)(),[N,g]=(0,l.useState)(!1),[b,w]=(0,l.useState)(null),C=()=>{r("policies"),n(null),d(!1),h({mainMember:{personalInfo:{title:"",firstName:"",lastName:"",initials:"",dateOfBirth:null,gender:"",language:"",maritalStatus:"",nationality:"",idType:"South African ID",idNumber:"",idDocumentUrl:null},contactDetails:[],addressDetails:{streetAddress:"",city:"",stateProvince:"",postalCode:"",country:""}},beneficiaries:[],dependents:[],policiesDetails:{policiesId:"",name:"",coverAmount:"",premium:null},cateringOptions:[]}),sessionStorage.removeItem("mainMember")};(0,l.useEffect)(()=>{C()},[]);let D=e=>{j||(n(null),p(!0),S(e)&&r(e),p(!1))},S=e=>{let a=!0;try{var s,t,l,r,i,c;if(console.log("Validating tab:",e,"policiesDetails:",u.policiesDetails),"policies"!==e&&(!(null===(s=u.policiesDetails)||void 0===s?void 0:s.policiesId)||!(null===(t=u.policiesDetails)||void 0===t?void 0:t.name)))return console.log("Failed validation - policiesId:",null===(l=u.policiesDetails)||void 0===l?void 0:l.policiesId,"name:",null===(r=u.policiesDetails)||void 0===r?void 0:r.name),n("Please select a policy before proceeding to other sections."),!1;switch(e){case"policies":case"main-member":break;case"catering":(null===(i=u.policiesDetails)||void 0===i?void 0:i.policiesId)&&(null===(c=u.policiesDetails)||void 0===c?void 0:c.name)||(n("Please select a policy before proceeding to catering options."),a=!1);break;case"dependents":if(!u.mainMember.personalInfo.firstName)return n("Please add main member details before proceeding"),!1;break;case"beneficiaries":case"summary":let{personalInfo:d}=u.mainMember;if([{key:"firstName",label:"First Name"},{key:"lastName",label:"Last Name"},{key:"idNumber",label:"ID Number"},{key:"dateOfBirth",label:"Date of Birth"},{key:"gender",label:"Gender"}].filter(e=>{let{key:a}=e,s=d[a];return"dateOfBirth"===a?!s:!String(s).trim()}).map(e=>{let{label:a}=e;return a}),"summary"===e&&0===u.beneficiaries.length)return n("At least one beneficiary is required"),!1}}catch(e){console.error("Error in validateCurrentTab:",e),n("An error occurred while validating the form"),a=!1}return a},I=async()=>{try{if(m(!0),n(null),!S("summary")){m(!1);return}if(u.mainMember.contractId){let e=(0,ej.JU)(ev.db,"Contracts",u.mainMember.contractId);await (0,ej.r7)(e,{status:"In-Force",updatedAt:new Date})}let e=u.mainMember.contractNumber;w(e||null),d(!1),g(!0),setTimeout(()=>{C(),f.push("/")},2e3)}catch(e){console.error("Error submitting contract:",e),n("Failed to submit contract. Please try again.")}finally{m(!1)}},A=(()=>{let e,a=0;e=1,u.policiesDetails.policiesId&&a++,u.cateringOptions.length>0&&(a++,e++);let s=u.mainMember.personalInfo;return e+=5,s.firstName&&a++,s.lastName&&a++,s.idNumber&&a++,s.dateOfBirth&&a++,s.gender&&a++,e+=1,u.beneficiaries.length>0&&100===u.beneficiaries.reduce((e,a)=>e+a.personalInfo.beneficiaryPercentage,0)&&a++,Math.round(a/e*100)})();return(0,t.jsxs)("div",{className:"container mx-auto py-6 space-y-8",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"New Contract"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Progress"}),(0,t.jsxs)("span",{children:[A,"%"]})]}),(0,t.jsx)(e4,{value:A,className:"h-2"})]})]}),i&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:i})]}),(0,t.jsxs)(eg.mQ,{value:s,onValueChange:D,children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-6",children:[(0,t.jsxs)(eg.SP,{value:"policies",disabled:x||j,children:["policies",x&&"policies"===s&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 animate-spin"})]}),(0,t.jsxs)(eg.SP,{value:"catering",disabled:x||j,children:["Catering",x&&"catering"===s&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 animate-spin"})]}),(0,t.jsxs)(eg.SP,{value:"main-member",disabled:x||j,children:["Main Member",x&&"main-member"===s&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 animate-spin"})]}),(0,t.jsxs)(eg.SP,{value:"dependents",disabled:x||j,children:["Dependents",x&&"dependents"===s&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 animate-spin"})]}),(0,t.jsxs)(eg.SP,{value:"beneficiaries",disabled:x||j,children:["Beneficiaries",x&&"beneficiaries"===s&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 animate-spin"})]}),(0,t.jsxs)(eg.SP,{value:"summary",disabled:x||j,children:["Summary",x&&"summary"===s&&(0,t.jsx)(Q.Z,{className:"ml-2 h-4 w-4 animate-spin"})]})]}),(0,t.jsx)(eg.nU,{value:"main-member",children:(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(e9,{mainMember:u.mainMember,updateMainMember:e=>h({...u,mainMember:e}),selectedPolicies:{...u.policiesDetails,policiesId:u.policiesDetails.policiesId},selectedCateringOptions:u.cateringOptions,userRole:a})})}),(0,t.jsx)(eg.nU,{value:"beneficiaries",children:(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(an,{contractNumber:u.mainMember.contractNumber,mainMemberIdNumber:u.mainMember.personalInfo.idNumber,beneficiaries:u.beneficiaries,updateBeneficiaries:e=>h({...u,beneficiaries:e})})})}),(0,t.jsx)(eg.nU,{value:"dependents",children:(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(ap,{dependents:u.dependents,updateDependents:e=>h({...u,dependents:e}),contractNumber:u.mainMember.contractNumber,mainMemberIdNumber:u.mainMember.personalInfo.idNumber})})}),(0,t.jsx)(eg.nU,{value:"policies",children:(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(aN,{selectedpolicies:u.policiesDetails,onpolicieselect:e=>h({...u,policiesDetails:e})})})}),(0,t.jsx)(eg.nU,{value:"catering",children:(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(ab,{selectedOptions:u.cateringOptions,onChange:e=>h({...u,cateringOptions:e})})})}),(0,t.jsx)(eg.nU,{value:"summary",children:(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(eP.s,{data:u,onEdit:e=>D(e)})})})]}),(0,t.jsxs)("div",{className:"flex justify-between space-x-4",children:[(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsxs)(y.z,{id:"Previous",variant:"outline",onClick:()=>D("policies"===s?"policies":"catering"===s?"policies":"main-member"===s?"catering":"dependents"===s?"main-member":"beneficiaries"===s?"dependents":"beneficiaries"),disabled:"policies"===s||x||j,className:"gap-2",children:[(0,t.jsx)(aw.Z,{className:"h-4 w-4"}),"Previous"]})}),(0,t.jsx)(Z._v,{children:"Go back to previous section"})]})}),(0,t.jsxs)("div",{className:"space-x-4",children:[(0,t.jsx)(y.z,{id:"Cancel",variant:"outline",onClick:()=>{window.confirm("Are you sure you want to cancel? All progress will be lost.")&&(h(aS),r("policies"),n(null))},disabled:x||j,children:"Cancel"}),(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{id:"summary"===s?"Submit":"Next",onClick:()=>{"summary"===s?d(!0):D("policies"===s?"catering":"catering"===s?"main-member":"main-member"===s?"dependents":"dependents"===s?"beneficiaries":"summary")},disabled:x||j,className:"gap-2",children:"summary"===s?(0,t.jsx)(t.Fragment,{children:"Submit"}):(0,t.jsxs)(t.Fragment,{children:["Next",(0,t.jsx)(aC.Z,{className:"h-4 w-4"})]})})}),(0,t.jsx)(Z._v,{children:"summary"===s?"Submit the contract for processing":"Proceed to next section"})]})})]})]}),(0,t.jsx)(eh.Vq,{open:c,onOpenChange:d,children:(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:"Submit Contract"})}),(0,t.jsxs)("div",{className:"py-4",children:[i?(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-4",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:i})]}):(0,t.jsxs)(ex.bZ,{className:"mb-4",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Ready to Submit"}),(0,t.jsx)(ex.X,{children:"Please review all information before submitting. This action cannot be undone."})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Contract Number"}),(0,t.jsx)("span",{className:"font-medium",children:u.mainMember.contractNumber})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Main Member"}),(0,t.jsxs)("span",{className:"font-medium",children:[u.mainMember.personalInfo.firstName," ",u.mainMember.personalInfo.lastName]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Selected policies"}),(0,t.jsx)("span",{className:"font-medium",children:u.policiesDetails.name})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Monthly Premium"}),(0,t.jsxs)("span",{className:"font-medium",children:["R",((u.policiesDetails.premium||0)+u.cateringOptions.reduce((e,a)=>e+a.price,0)).toLocaleString()]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(y.z,{id:"Cancel",variant:"outline",onClick:()=>d(!1),disabled:o,children:"Cancel"}),(0,t.jsx)(y.z,{id:"Confirm Submission",onClick:I,disabled:o,className:"gap-2",children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),"Submitting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),"Confirm Submission"]})})]})]})}),(0,t.jsx)(eh.Vq,{open:N,onOpenChange:g,children:(0,t.jsxs)(eh.cZ,{className:"sm:max-w-md",children:[(0,t.jsx)(eh.fK,{children:(0,t.jsxs)(eh.$N,{className:"flex items-center gap-2 text-green-600",children:[(0,t.jsx)(eb.Z,{className:"h-5 w-5"}),"Contract Submitted Successfully"]})}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)("div",{className:"rounded-full bg-green-50 p-3",children:(0,t.jsx)(eb.Z,{className:"h-8 w-8 text-green-600"})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("p",{className:"text-lg font-semibold",children:["Contract #",b]}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Your contract has been submitted successfully."})]}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Redirecting to contract details..."})]})})]})})]})}function aA(e){let{userRole:a}=e,[s,r]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[x,p]=(0,l.useState)([]),[j,v]=(0,l.useState)({contractNumber:"",mainMemberIdNumber:"",policies:"all",status:"all"}),[f,N]=(0,l.useState)(null),[g,b]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1),[D,S]=(0,l.useState)(0),I=async()=>{try{let e=(0,ej.hJ)(ev.db,"policies Database"),a=(await (0,ej.PL)(e)).docs.map(e=>({id:e.id,name:e.data().Name||"Unnamed policies"}));p(a)}catch(e){console.error("Error fetching policiess:",e)}};(0,l.useEffect)(()=>{I()},[]),(0,l.useEffect)(()=>{(async()=>{try{d(!0),h(null);let s=(0,ej.IO)((0,ej.hJ)(ev.db,"Contracts")),t=await (0,ej.PL)(s),l=[];for(let s of t.docs){var e,a;let t=s.data(),r=(0,ej.IO)((0,ej.hJ)(ev.db,"Members"),(0,ej.ar)("idNumber","==",t.memberIdNumber)),i=await (0,ej.PL)(r),n=null===(e=i.docs[0])||void 0===e?void 0:e.data(),c=(0,ej.IO)((0,ej.hJ)(ev.db,"Policies"),(0,ej.ar)("id","==",t.policiesId)),d=await (0,ej.PL)(c),o=null===(a=d.docs[0])||void 0===a?void 0:a.data();l.push({id:s.id,contractNumber:t.contractNumber||"N/A",mainMemberName:n?"".concat(n.firstName," ").concat(n.lastName):"Unknown",mainMemberIdNumber:t.memberIdNumber||"N/A",policies:(null==o?void 0:o.name)||"Unknown policies",status:t.status||"unknown"})}r(l),n(l)}catch(e){console.error("Error fetching contracts:",e),h("Failed to load contracts. Please try again.")}finally{d(!1)}})()},[]);let A=e=>{let{name:a,value:s}=e.target;v(e=>({...e,[a]:s}))},P=(e,a)=>{v(s=>({...s,[e]:a}))},M=async e=>{e.preventDefault(),C(!0);let a=s.filter(e=>{let a=""===j.contractNumber||e.contractNumber.toLowerCase().includes(j.contractNumber.toLowerCase()),s=""===j.mainMemberIdNumber||e.mainMemberIdNumber.includes(j.mainMemberIdNumber),t="all"===j.policies||e.policies.toLowerCase()===j.policies.toLowerCase(),l="all"===j.status||e.status.toLowerCase()===j.status.toLowerCase();return a&&s&&t&&l});S(30),await new Promise(e=>setTimeout(e,300)),S(60),await new Promise(e=>setTimeout(e,200)),S(100),await new Promise(e=>setTimeout(e,200)),n(a),C(!1),S(0)},k=async e=>{try{var a,s;b(!0),h(null),S(0),S(10);let t=(0,ej.JU)(ev.db,"Contracts",e),l=await (0,ej.QT)(t);if(!l.exists()){h("Contract not found");return}let r=l.data();S(20),S(30);let i=(0,ej.IO)((0,ej.hJ)(ev.db,"Members"),(0,ej.ar)("idNumber","==",r.memberIdNumber)),n=await (0,ej.PL)(i),c=null===(a=n.docs[0])||void 0===a?void 0:a.data();S(40),S(50);let d=(0,ej.JU)(ev.db,"Policies",r.policiesId),o=(await (0,ej.QT)(d)).data();S(60),S(70);let m=(0,ej.IO)((0,ej.hJ)(ev.db,"Beneficiaries"),(0,ej.ar)("contractNumber","==",r.contractNumber)),u=(await (0,ej.PL)(m)).docs.map(e=>e.data());S(80),S(85);let x=(0,ej.IO)((0,ej.hJ)(ev.db,"Dependents"),(0,ej.ar)("contractNumber","==",r.contractNumber)),p=(await (0,ej.PL)(x)).docs.map(e=>e.data());S(90),S(95);let j=await Promise.all((r.cateringOptionIds||[]).map(async e=>{let a=(0,ej.JU)(ev.db,"catering",e),s=await (0,ej.QT)(a);return{id:e,...s.data()}})),v={mainMember:{personalInfo:c,contactDetails:[],addressDetails:{},contractNumber:r.contractNumber,contractId:l.id},beneficiaries:u.map(e=>({personalInfo:e.personalInfo,contactDetails:e.contactDetails,addressDetails:e.addressDetails})),dependents:p,policiesDetails:{policiesId:r.policiesId,name:(null==o?void 0:o.Name)||"Unknown policies",coverAmount:(null==o?void 0:null===(s=o.Price)||void 0===s?void 0:s.toString())||"0",premium:(null==o?void 0:o.Price)||null},cateringOptions:j,status:r.status};S(100),await new Promise(e=>setTimeout(e,200)),N(v)}catch(e){console.error("Error fetching contract details:",e),h("Failed to load contract details. Please try again.")}finally{b(!1),S(0)}};return g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 transition-opacity duration-300"}),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,t.jsx)(T.Zb,{className:"mx-auto w-[90%] max-w-md p-6 shadow-lg transition-all duration-300 ease-out",children:(0,t.jsxs)(T.aY,{className:"flex flex-col items-center justify-center space-y-6",children:[(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Loading progress"}),(0,t.jsxs)("span",{className:"text-primary font-medium",children:[D,"%"]})]}),(0,t.jsx)(e4,{value:D,className:"h-2"}),(0,t.jsx)("div",{className:"mt-4 flex justify-center",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(m.Z,{className:"h-8 w-8 text-primary animate-pulse"})})]})})]}),(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)(T.ll,{children:"Loading Contract Details"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:D<20?"Fetching contract information...":D<40?"Loading member details...":D<60?"Retrieving policies information...":D<80?"Loading beneficiaries...":D<90?"Loading dependents...":D<100?"Getting catering options...":"Finalizing..."})]})]})})})]}):c?(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(e3.O,{className:"h-8 w-48"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:[1,2,3,4].map(e=>(0,t.jsxs)("div",{children:[(0,t.jsx)(e3.O,{className:"h-4 w-24 mb-2"}),(0,t.jsx)(e3.O,{className:"h-10 w-full"})]},e))}),(0,t.jsx)(e3.O,{className:"h-10 w-24"})]})})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(e3.O,{className:"h-8 w-48"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"grid grid-cols-5 gap-4",children:[1,2,3,4,5].map(e=>(0,t.jsx)(e3.O,{className:"h-6"},e))}),[1,2,3].map(e=>(0,t.jsx)("div",{className:"grid grid-cols-5 gap-4",children:[1,2,3,4,5].map(e=>(0,t.jsx)(e3.O,{className:"h-10"},e))},e))]})})]})]}):u?(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ex.Cd,{children:"Error Loading Contracts"}),(0,t.jsxs)(ex.X,{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:u}),(0,t.jsx)(y.z,{variant:"outline",onClick:()=>window.location.reload(),className:"ml-4",children:"Try Again"})]})]})}):f?(0,t.jsxs)("div",{className:"container mx-auto py-6 space-y-8",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(y.z,{variant:"outline",onClick:()=>N(null),children:[(0,t.jsx)(aw.Z,{className:"mr-2 h-4 w-4"})," Back to Search"]}),(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Contract Details"})]})}),(0,t.jsx)(T.Zb,{className:"p-6",children:(0,t.jsx)(eP.s,{data:f,onEdit:()=>{}})})]}):(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Search Contracts"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"contractNumber",children:"Contract Number"}),(0,t.jsx)(Y,{id:"contractNumber",name:"contractNumber",value:j.contractNumber,onChange:A,placeholder:"Enter contract number"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"mainMemberIdNumber",children:"Main Member ID Number"}),(0,t.jsx)(Y,{id:"mainMemberIdNumber",name:"mainMemberIdNumber",value:j.mainMemberIdNumber,onChange:A,placeholder:"Enter ID number"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"policies",children:"policies"}),(0,t.jsxs)(er,{name:"policies",value:j.policies,onValueChange:e=>P("policies",e),children:[(0,t.jsx)(en,{id:"policies",children:(0,t.jsx)(ei,{placeholder:"Select policies"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All"}),x.map(e=>(0,t.jsx)(em,{value:e.name,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"status",children:"Status"}),(0,t.jsxs)(er,{name:"status",value:j.status,onValueChange:e=>P("status",e),children:[(0,t.jsx)(en,{id:"status",children:(0,t.jsx)(ei,{placeholder:"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All"}),(0,t.jsx)(em,{value:"new",children:"New"}),(0,t.jsx)(em,{value:"in-force",children:"In Force"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(y.z,{id:"Search",type:"submit",disabled:w,className:"relative",children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Search"]})}),w&&(0,t.jsx)(e4,{value:D,className:"flex-1 h-2"})]})]})})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Search Results"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"Contract Number"}),(0,t.jsx)(K.ss,{children:"Main Member Name"}),(0,t.jsx)(K.ss,{children:"Main Member ID Number"}),(0,t.jsx)(K.ss,{children:"policies"}),(0,t.jsx)(K.ss,{children:"Status"})]})}),(0,t.jsx)(K.RM,{children:0===i.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No contracts found matching your search criteria"})}):i.map(e=>(0,t.jsxs)(K.SC,{className:"cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>k(e.id),children:[(0,t.jsx)(K.pj,{className:"text-blue-600 hover:text-blue-800 font-medium",children:e.contractNumber}),(0,t.jsx)(K.pj,{children:e.mainMemberName}),(0,t.jsx)(K.pj,{children:e.mainMemberIdNumber}),(0,t.jsx)(K.pj,{children:e.policies}),(0,t.jsx)(K.pj,{children:(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\n                        ".concat("in-force"===e.status?"bg-green-100 text-green-800":"new"===e.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status})})]},e.contractNumber))})]})})]})]})}var aP=s(32489);function aM(e){let{searchParams:a,setSearchParams:s}=e,l=(e,t)=>{s({...a,[e]:t})};return(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsx)(T.ll,{children:"Claims Search"})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Contract Number"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by contract...",value:a.contractNumber,onChange:e=>l("contractNumber",e.target.value),className:"pl-8"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Claim ID"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by claim ID...",value:a.claimId,onChange:e=>l("claimId",e.target.value),className:"pl-8"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Claimant Name"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by name...",value:a.claimantName,onChange:e=>l("claimantName",e.target.value),className:"pl-8"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Date From"}),(0,t.jsx)(Y,{type:"date",value:a.dateFrom,onChange:e=>l("dateFrom",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Date To"}),(0,t.jsx)(Y,{type:"date",value:a.dateTo,onChange:e=>l("dateTo",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Status"}),(0,t.jsxs)(er,{value:a.status,onValueChange:e=>l("status",e),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Filter by status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Statuses"}),(0,t.jsx)(em,{value:"Under Investigation",children:"Under Investigation"}),(0,t.jsx)(em,{value:"Approved",children:"Approved"}),(0,t.jsx)(em,{value:"Rejected",children:"Rejected"}),(0,t.jsx)(em,{value:"Paid",children:"Paid"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(er,{value:a.claimType,onValueChange:e=>l("claimType",e),children:[(0,t.jsx)(en,{className:"w-[200px]",children:(0,t.jsx)(ei,{placeholder:"Filter by claim type"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Types"}),(0,t.jsx)(em,{value:"Medical",children:"Medical"}),(0,t.jsx)(em,{value:"Property",children:"Property"}),(0,t.jsx)(em,{value:"Liability",children:"Liability"})]})]}),(0,t.jsxs)(y.z,{variant:"outline",onClick:()=>{s({contractNumber:"",claimId:"",dateFrom:"",dateTo:"",status:"all",claimantName:"",claimType:"all"})},className:"flex items-center gap-2",children:[(0,t.jsx)(aP.Z,{className:"h-4 w-4"}),"Clear Filters"]})]})]})})]})}function ak(e){var a;let{claim:s,onClose:r,onStatusChange:i,updating:n}=e,[c,d]=(0,l.useState)(null),o=e=>{var a;let t=null===(a=s.documents)||void 0===a?void 0:a.find(a=>a.type===e);t&&d(t)},u=async e=>{var a;let t=null===(a=s.documents)||void 0===a?void 0:a.find(a=>a.type===e);if(null==t?void 0:t.url)try{let a=await fetch(t.url);if(!a.ok)throw Error("Download failed");let s=await a.blob(),l="".concat(e.toLowerCase().replace(/\s+/g,"_"),".pdf"),r=window.URL.createObjectURL(s),i=document.createElement("a");i.style.display="none",i.href=r,i.download=l,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(r)},100)}catch(e){console.error("Error downloading document:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to download document. Please try again."})}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(y.z,{variant:"ghost",onClick:r,className:"mb-4",children:[(0,t.jsx)(aw.Z,{className:"mr-2 h-4 w-4"}),"Back to Claims"]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)(T.ll,{children:["Claim Details - ",s.id]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,t.jsx)("span",{className:"font-medium",children:"Contract Number:"})," ",s.contractNumber,s.claimNumber&&(0,t.jsxs)("span",{className:"ml-4",children:[(0,t.jsx)("span",{className:"font-medium",children:"Claim Number:"})," ",s.claimNumber]})]})]}),(0,t.jsx)(eu.C,{className:(e=>{if(!e)return"bg-gray-100 text-gray-800";switch(e.toLowerCase()){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"under investigation":return"bg-yellow-100 text-yellow-800";case"paid":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(s.status),children:n?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Q.Z,{className:"h-3 w-3 animate-spin"}),"Updating..."]}):s.status})]})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsxs)(eg.mQ,{defaultValue:"claim",className:"w-full",children:[(0,t.jsxs)(eg.dr,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(eg.SP,{value:"claim",children:"Claim Details"}),(0,t.jsx)(eg.SP,{value:"deceased",children:"Deceased Details"}),(0,t.jsx)(eg.SP,{value:"bank",children:"Bank Details"}),(0,t.jsx)(eg.SP,{value:"documents",children:"Documents"})]}),(0,t.jsxs)("div",{className:"mt-4 border rounded-md p-4",children:[(0,t.jsx)(eg.nU,{value:"claim",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Claimant Name"}),(0,t.jsx)(K.pj,{children:s.claimantName})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Last Updated"}),(0,t.jsx)(K.pj,{children:(e=>{try{if(!e)return"N/A";return(0,eA.WU)(new Date(e),"dd/MM/yyyy HH:mm:ss")}catch(e){return"Invalid Date"}})(s.lastUpdated)})]}),s.policy&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Policy Number"}),(0,t.jsx)(K.pj,{children:s.policy.policyNumber})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Policy Holder"}),(0,t.jsx)(K.pj,{children:s.policy.holderName})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Coverage Amount"}),(0,t.jsxs)(K.pj,{children:["$",(null===(a=s.policy.coverageAmount)||void 0===a?void 0:a.toFixed(2))||"0.00"]})]})]})]})})}),s.deceased&&(0,t.jsx)(eg.nU,{value:"deceased",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Full Name"}),(0,t.jsxs)(K.pj,{children:[s.deceased.firstName," ",s.deceased.lastName]})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"ID Number"}),(0,t.jsx)(K.pj,{children:s.deceased.idNumber})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Date of Death"}),(0,t.jsx)(K.pj,{children:s.deceased.dateOfDeath})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Cause of Death"}),(0,t.jsx)(K.pj,{children:s.deceased.causeOfDeath})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Place of Death"}),(0,t.jsx)(K.pj,{children:s.deceased.placeOfDeath})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Relationship"}),(0,t.jsx)(K.pj,{children:s.deceased.relationship})]})]})})}),s.bankDetails&&(0,t.jsx)(eg.nU,{value:"bank",children:(0,t.jsx)(K.iA,{children:(0,t.jsxs)(K.RM,{children:[(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Account Holder"}),(0,t.jsx)(K.pj,{children:s.bankDetails.accountHolder})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Bank Name"}),(0,t.jsx)(K.pj,{children:s.bankDetails.bankName})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Account Type"}),(0,t.jsx)(K.pj,{children:s.bankDetails.accountType})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Account Number"}),(0,t.jsx)(K.pj,{children:s.bankDetails.accountNumber})]}),(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:"Branch Code"}),(0,t.jsx)(K.pj,{children:s.bankDetails.branchCode})]})]})})}),(0,t.jsx)(eg.nU,{value:"documents",children:(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Mandatory Documents"}),(0,t.jsx)(K.iA,{children:(0,t.jsx)(K.RM,{children:["Death Certificate","ID Document","Bank Statement"].map(e=>{var a;return(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:e}),(0,t.jsx)(K.pj,{children:(null===(a=s.documents)||void 0===a?void 0:a.some(a=>a.type===e))?(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-500",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Uploaded"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>o(e),children:(0,t.jsx)(eD.Z,{className:"h-4 w-4"})}),(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>u(e),children:(0,t.jsx)(eS.Z,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-yellow-500",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Pending"})]})})]},e)})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Optional Documents"}),(0,t.jsx)(K.iA,{children:(0,t.jsx)(K.RM,{children:["Funeral Invoice","Medical Certificate","Other"].map(e=>{var a;return(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:e}),(0,t.jsx)(K.pj,{children:(null===(a=s.documents)||void 0===a?void 0:a.some(a=>a.type===e))?(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-500",children:[(0,t.jsx)(eb.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Uploaded"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>o(e),children:(0,t.jsx)(eD.Z,{className:"h-4 w-4"})}),(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>u(e),children:(0,t.jsx)(eS.Z,{className:"h-4 w-4"})})]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Not uploaded"})]})})]},e)})})})]})]})})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center gap-4 mt-4 pt-4 border-t",children:[(0,t.jsxs)(er,{value:s.status,onValueChange:e=>i(s.id,e),disabled:n,children:[(0,t.jsx)(en,{className:"w-[200px]",children:(0,t.jsx)(ei,{placeholder:n?"Updating...":"Select status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"FNOL",children:"FNOL"}),(0,t.jsx)(em,{value:"under investigation",children:"Under Investigation"}),(0,t.jsx)(em,{value:"approved",children:"Approved"}),(0,t.jsx)(em,{value:"paid",children:"Paid"}),(0,t.jsx)(em,{value:"rejected",children:"Rejected"})]})]}),(0,t.jsx)(y.z,{variant:"outline",onClick:r,children:"Close"})]})]})]}),(0,t.jsx)(eh.Vq,{open:!!c,onOpenChange:()=>d(null),children:(0,t.jsxs)(eh.cZ,{className:"max-w-4xl h-[80vh]",children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:null==c?void 0:c.type})}),(0,t.jsx)("div",{className:"flex-1 h-full",children:(0,t.jsx)("iframe",{src:null==c?void 0:c.url,className:"w-full h-full rounded-md",title:null==c?void 0:c.type})})]})})]})}function aO(e){let{userRole:a}=e,s=a&&"View Only"!==a,[r,i]=(0,l.useState)([]),[n,c]=(0,l.useState)(!0),[d,m]=(0,l.useState)(null),[u,h]=(0,l.useState)({contractNumber:"",claimId:"",dateFrom:"",dateTo:"",status:"all",claimantName:"",claimType:"all"}),[x,p]=(0,l.useState)(null),[j,v]=(0,l.useState)(!1),[f,N]=(0,l.useState)({field:"dateSubmitted",direction:"desc"}),[g,b]=(0,l.useState)(null),[w,C]=(0,l.useState)(!0),[D,S]=(0,l.useState)(!1);(0,aD.useRouter)(),(0,l.useEffect)(()=>{I()},[u,f]);let I=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{c(!0),m(null);let a=await eZ(u,f,e?g:null,10);b(a.lastVisible),C(a.hasMore);let s=a.claims.map(P);e?i(e=>[...e,...s]):i(s)}catch(e){console.error("Error fetching claims:",e),m("Failed to load claims. Please try again.")}finally{c(!1)}},A=async(e,a)=>{if(s)try{S(!0);let s=(0,ej.JU)(ev.db,"Claims",e);await (0,ej.r7)(s,{status:a,lastUpdated:new Date}),i(s=>s.map(s=>s.id===e?P({...s,status:a,lastUpdated:new Date}):s)),(0,ef.Am)({title:"Success",description:"Claim status updated successfully"})}catch(e){console.error("Error updating claim status:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to update claim status"})}finally{S(!1)}},P=e=>{var a,s,t,l,r;return{...e,id:e.id,claimNumber:e.claimNumber||e.id,contractNumber:e.contractNumber,claimantName:e.claimantName,claimType:e.claimType,status:e.status,amount:e.amount,description:e.description,dateSubmitted:(null===(s=e.dateSubmitted)||void 0===s?void 0:null===(a=s.toDate)||void 0===a?void 0:a.call(s))||new Date(e.dateSubmitted),lastUpdated:(null===(l=e.lastUpdated)||void 0===l?void 0:null===(t=l.toDate)||void 0===t?void 0:t.call(l))||new Date(e.lastUpdated),documents:null===(r=e.documents)||void 0===r?void 0:r.map(e=>({type:e.type,url:e.url})),relationship:e.relationship,serviceDate:e.serviceDate,serviceProvider:e.serviceProvider,location:e.location,policy:e.policy,deceased:e.deceased,bankDetails:e.bankDetails}},M=async e=>{try{c(!0);let a=await eO(e);a&&p(P(a))}catch(e){console.error("Error fetching claim details:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load claim details"})}finally{c(!1)}},k=e=>{N(a=>({field:e,direction:a.field===e&&"asc"===a.direction?"desc":"asc"})),b(null)},O=e=>{if(!e)return"bg-gray-100 text-gray-800";switch(e.toLowerCase()){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"under investigation":return"bg-yellow-100 text-yellow-800";case"paid":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return(0,t.jsxs)("div",{className:"space-y-6",children:[!x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(Y,{placeholder:"Search by claim number or contract number",value:u.claimId||u.contractNumber,onChange:e=>{let a=e.target.value;h(e=>({...e,claimId:a,contractNumber:a}))}})}),(0,t.jsx)(y.z,{id:"Search",variant:"outline",onClick:()=>I(),disabled:n,children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Search"]})})]}),(0,t.jsx)(aM,{searchParams:u,setSearchParams:h})]}),x?(0,t.jsx)(ak,{claim:x,onClose:()=>p(null),onStatusChange:A,updating:D}):(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(T.ll,{children:"Claims List"}),(0,t.jsx)("div",{className:"flex gap-4",children:["FNOL","under investigation","approved","paid","rejected"].map(e=>(0,t.jsxs)(eu.C,{className:O(e),children:[e.toUpperCase(),": ",r.filter(a=>a.status.toLowerCase()===e.toLowerCase()).length]},e))})]})}),(0,t.jsxs)(T.aY,{children:[d&&(0,t.jsxs)(ex.bZ,{variant:"destructive",className:"mb-4",children:[(0,t.jsx)(ew.Z,{className:"h-4 w-4"}),(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:d})]}),(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Claim ID",(0,t.jsx)(ee.Z,{className:"h-4 w-4"})]})}),(0,t.jsx)(K.ss,{className:"cursor-pointer",onClick:()=>k("contractNumber"),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Contract Number",(0,t.jsx)(ee.Z,{className:"h-4 w-4"})]})}),(0,t.jsx)(K.ss,{className:"cursor-pointer",onClick:()=>k("claimantName"),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Claimant Name",(0,t.jsx)(ee.Z,{className:"h-4 w-4"})]})}),(0,t.jsx)(K.ss,{className:"cursor-pointer",onClick:()=>k("dateSubmitted"),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Date Submitted",(0,t.jsx)(ee.Z,{className:"h-4 w-4"})]})}),(0,t.jsx)(K.ss,{className:"cursor-pointer",onClick:()=>k("status"),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["Status",(0,t.jsx)(ee.Z,{className:"h-4 w-4"})]})})]})}),(0,t.jsx)(K.RM,{children:n?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:5,className:"text-center py-8",children:(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(Q.Z,{className:"h-6 w-6 animate-spin"})})})}):0===r.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:5,className:"text-center py-8",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(ew.Z,{className:"h-8 w-8"}),(0,t.jsx)("p",{children:"No claims found"})]})})}):r.map(e=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{children:(0,t.jsx)(y.z,{id:"View Claim",variant:"link",onClick:()=>M(e.id),className:"p-0 h-auto font-medium",children:e.id})}),(0,t.jsx)(K.pj,{children:e.contractNumber}),(0,t.jsx)(K.pj,{children:e.claimantName}),(0,t.jsx)(K.pj,{children:(0,eA.WU)(e.dateSubmitted,"dd/MM/yyyy")}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(eu.C,{className:O(e.status),children:e.status})})]},e.id))})]}),w&&!n&&(0,t.jsx)("div",{className:"flex justify-center mt-4",children:(0,t.jsx)(y.z,{id:"Load More Claims",variant:"outline",onClick:()=>I(!0),className:"flex items-center gap-2",children:"Load More Claims"})})]})]})]})}function aZ(){let[e,a]=(0,l.useState)([]),[s,r]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[c,d]=(0,l.useState)({name:"",categoryId:"all",priceRange:""}),[m,u]=(0,l.useState)([]),[h,x]=(0,l.useState)(!1),[p,j]=(0,l.useState)(!1),[v,f]=(0,l.useState)(!1),[N,g]=(0,l.useState)(null),[b,w]=(0,l.useState)(null),[C,S]=(0,l.useState)(null),[I,A]=(0,l.useState)({field:"name",order:"asc"}),[P,M]=(0,l.useState)(1),[k,O]=(0,l.useState)(""),[E,F]=(0,l.useState)({name:"",price:0,description:"",categoryId:"",features:[]}),L=async e=>{try{let a=(0,ej.hJ)(ev.db,"Contracts"),s=(0,ej.IO)(a,(0,ej.ar)("cateringOptionIds","array-contains",e));return(await (0,ej.PL)(s)).size>0}catch(e){return console.error("Error checking contract dependencies:",e),!1}};(0,l.useEffect)(()=>{(async()=>{try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"catering"),(0,ej.Xo)("createdAt","desc")),s=await (0,ej.PL)(e),t=await Promise.all(s.docs.map(async e=>{var a;let s=e.data(),t=await L(s.id);return{id:s.id,name:s.name,price:s.price,description:s.description,categoryId:s.categoryId,features:s.features||[],createdAt:(null===(a=s.createdAt)||void 0===a?void 0:a.toDate())||new Date,isLinked:t}}));a(t),u(t)}catch(e){console.error("Error fetching catering options:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load catering options. Please refresh the page."})}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Category"),(0,ej.Xo)("date","desc")),a=(await (0,ej.PL)(e)).docs.map(e=>{var a;return{id:e.id,name:e.data().name,date:(null===(a=e.data().date)||void 0===a?void 0:a.toDate())||new Date}});r(a)}catch(e){console.error("Error fetching categories:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load categories. Please refresh the page."})}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Features")),a=(await (0,ej.PL)(e)).docs.map(e=>({id:e.id,name:e.data().name,description:e.data().description}));n(a)}catch(e){console.error("Error fetching features:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load features. Please refresh the page."})}})()},[]);let U=e=>{let{name:a,value:s}=e.target;a.startsWith("form")?F(e=>({...e,[a.replace("form","").toLowerCase()]:s})):d(e=>({...e,[a]:s}))},z=(e,a)=>{"formCategory"===a?F(a=>({...a,categoryId:e})):d(s=>({...s,[a]:e}))},R=e=>{A(a=>({field:e,order:a.field===e&&"asc"===a.order?"desc":"asc"}))},B=async a=>{a.preventDefault(),x(!0),M(1),await new Promise(e=>setTimeout(e,500)),u(e.filter(e=>{let a=e.name.toLowerCase().includes(c.name.toLowerCase()),s="all"===c.categoryId||e.categoryId===c.categoryId,t=!c.priceRange||e.price<=parseInt(c.priceRange);return a&&s&&t})),x(!1)},J=e=>{g(e),F({name:e.name,price:e.price,description:e.description,categoryId:e.categoryId,features:e.features||[]}),j(!0)},V=async e=>{try{if(await L(e.id)){(0,ef.Am)({variant:"destructive",title:"Cannot Delete",description:"This catering option is linked to existing contracts and cannot be deleted."});return}w(e),f(!0)}catch(e){console.error("Error checking contract dependencies:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to check if this option can be deleted. Please try again."})}},_=async()=>{if(b)try{if(x(!0),await L(b.id)){(0,ef.Am)({variant:"destructive",title:"Cannot Delete",description:"This catering option is linked to existing contracts and cannot be deleted."}),f(!1);return}let s=(0,ej.JU)(ev.db,"catering",b.id);await (0,ej.oe)(s);let t=e.filter(e=>e.id!==b.id);a(t),u(t),(0,ef.Am)({title:"Success",description:"".concat(b.name," has been deleted successfully.")})}catch(e){console.error("Error deleting catering option:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to delete catering option. Please try again."})}finally{x(!1),f(!1),w(null)}},q=async()=>{try{let e=(0,ej.hJ)(ev.db,"catering"),a=(await (0,ej.PL)(e)).docs.map(e=>e.data().id||"").filter(e=>e.startsWith("CAT")).map(e=>parseInt(e.substring(3))).filter(e=>!isNaN(e)),s=a.length>0?Math.max(...a):0;return"CAT".concat(String(s+1).padStart(3,"0"))}catch(e){return console.error("Error generating ID:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to generate ID. Please try again."}),null}},X=async()=>{let e=await q();e&&(O(e),g(null),F({name:"",price:0,description:"",categoryId:"",features:[]}),j(!0))},W=async e=>{if(e.preventDefault(),S(null),!E.name||!E.categoryId||E.price<=0){S("Please fill in all required fields with valid values");return}try{let e=new Date,s=N?N.id:k,t=await L(s),l={id:s,name:E.name,price:Number(E.price),description:E.description,categoryId:E.categoryId,features:E.features,createdAt:e,isLinked:t};if(N){let a=(0,ej.JU)(ev.db,"catering",N.id);await (0,ej.pl)(a,{...l,id:N.id,createdAt:N.createdAt,updatedAt:e},{merge:!0}),(0,ef.Am)({title:"Success",description:"Catering option updated successfully"})}else{let e=(0,ej.JU)(ev.db,"catering",k);await (0,ej.pl)(e,l),(0,ef.Am)({title:"Success",description:"Catering option added successfully"})}let r=(0,ej.IO)((0,ej.hJ)(ev.db,"catering"),(0,ej.Xo)("createdAt","desc")),i=await (0,ej.PL)(r),n=await Promise.all(i.docs.map(async e=>{var a;let s=e.data(),t=await L(s.id);return{id:s.id,name:s.name,price:s.price,description:s.description,categoryId:s.categoryId,features:s.features||[],createdAt:(null===(a=s.createdAt)||void 0===a?void 0:a.toDate())||new Date,isLinked:t}}));a(n),u(n),F({name:"",price:0,description:"",categoryId:"",features:[]}),g(null),O(""),j(!1)}catch(e){console.error("Error saving catering option:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to save catering option. Please try again."})}},$=Math.ceil(m.length/5),et=[...m].sort((e,a)=>{let s=e[I.field],t=a[I.field],l="asc"===I.order?1:-1;return"string"==typeof s?s.localeCompare(String(t))*l:(s-t)*l}).slice((P-1)*5,5*P),el=e=>{F(a=>{let s=a.features||[];return s.includes(e)?{...a,features:s.filter(a=>a!==e)}:{...a,features:[...s,e]}})};return(0,t.jsx)(Z.pn,{children:(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsxs)(T.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(T.ll,{children:"Search Catering Options"}),(0,t.jsxs)(eh.Vq,{open:p,onOpenChange:j,children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{onClick:X,children:[(0,t.jsx)(G.Z,{className:"mr-2 h-4 w-4"}),"Add New Option"]})}),(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:N?"Edit Catering Option":"Add New Catering Option"})}),(0,t.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[C&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:C})]}),!N&&(0,t.jsxs)("div",{className:"hidden",children:[(0,t.jsx)(H,{htmlFor:"formId",children:"Package ID"}),(0,t.jsx)(Y,{id:"formId",name:"formId",value:k,disabled:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"formName",children:"Package Name *"}),(0,t.jsx)(Y,{id:"formName",name:"formName",value:E.name,onChange:U,placeholder:"Enter package name"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"formCategory",children:"Category *"}),(0,t.jsxs)(er,{value:E.categoryId,onValueChange:e=>z(e,"formCategory"),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select category"})}),(0,t.jsx)(eo,{children:s.map(e=>(0,t.jsx)(em,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"formPrice",children:"Price *"}),(0,t.jsx)(Y,{id:"formPrice",name:"formPrice",type:"number",value:E.price,onChange:U,min:"0",step:"100"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"formDescription",children:"Description"}),(0,t.jsx)(ep,{id:"formDescription",name:"formDescription",value:E.description,onChange:U,placeholder:"Enter package description"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{children:"Features"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:i.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ag,{id:e.id,checked:E.features.includes(e.id),onCheckedChange:()=>el(e.id)}),(0,t.jsx)(H,{htmlFor:e.id,className:"cursor-pointer",children:e.name})]},e.id))})]}),(0,t.jsxs)(y.z,{type:"submit",className:"w-full",children:[N?"Update":"Add"," Catering Option"]})]})]})]})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("form",{onSubmit:B,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"name",children:"Package Name"}),(0,t.jsx)(Y,{id:"name",name:"name",value:c.name,onChange:U,placeholder:"Search by package name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"category",children:"Category"}),(0,t.jsxs)(er,{value:c.categoryId,onValueChange:e=>z(e,"category"),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select category"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Categories"}),s.map(e=>(0,t.jsx)(em,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"priceRange",children:"Max Price Range"}),(0,t.jsx)(Y,{id:"priceRange",name:"priceRange",type:"number",value:c.priceRange,onChange:U,placeholder:"Enter maximum price",min:"0",step:"100"})]})]}),(0,t.jsx)(y.z,{type:"submit",disabled:h,children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Search"]})})]})})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)(T.ll,{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Search Results"}),(0,t.jsxs)(eu.C,{variant:"secondary",children:[m.length," ",1===m.length?"item":"items"]})]})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"Package ID"}),(0,t.jsxs)(K.ss,{onClick:()=>R("name"),className:"cursor-pointer hover:bg-accent",children:["Name ","name"===I.field&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsxs)(K.ss,{onClick:()=>R("categoryId"),className:"cursor-pointer hover:bg-accent",children:["Category ","categoryId"===I.field&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsx)(K.ss,{children:"Description"}),(0,t.jsxs)(K.ss,{onClick:()=>R("price"),className:"cursor-pointer hover:bg-accent",children:["Price ","price"===I.field&&(0,t.jsx)(ee.Z,{className:"inline h-4 w-4"})]}),(0,t.jsx)(K.ss,{children:"Features"}),(0,t.jsx)(K.ss,{children:"Actions"})]})}),(0,t.jsx)(K.RM,{children:0===et.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No catering options found matching your search criteria"})}):et.map(e=>{var a,l;return(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{className:"font-medium",children:e.id}),(0,t.jsx)(K.pj,{children:e.name}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(eu.C,{variant:"outline",children:(null===(a=s.find(a=>a.id===e.categoryId))||void 0===a?void 0:a.name)||"Unknown Category"})}),(0,t.jsx)(K.pj,{children:e.description}),(0,t.jsxs)(K.pj,{children:["R",e.price.toLocaleString()]}),(0,t.jsx)(K.pj,{children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:null===(l=e.features)||void 0===l?void 0:l.map(e=>{let a=i.find(a=>a.id===e);return a?(0,t.jsx)(eu.C,{variant:"secondary",className:"text-xs",children:a.name},e):null})})}),(0,t.jsx)(K.pj,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>J(e),children:(0,t.jsx)(ea.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(Z._v,{children:"Edit option"})]}),(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>V(e),disabled:e.isLinked,children:(0,t.jsx)(es.Z,{className:"h-4 w-4 ".concat(e.isLinked?"text-gray-300":"text-red-500")})})}),(0,t.jsx)(Z._v,{children:e.isLinked?"Cannot delete - linked to contracts":"Delete option"})]})]})})]},e.id)})})]}),m.length>0&&(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(P-1)*5+1," to ",Math.min(5*P,m.length)," of ",m.length," entries"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(y.z,{variant:"outline",size:"sm",onClick:()=>M(e=>Math.max(1,e-1)),disabled:1===P,children:(0,t.jsx)(eL.Z,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"text-sm",children:["Page ",P," of ",$]}),(0,t.jsx)(y.z,{variant:"outline",size:"sm",onClick:()=>M(e=>Math.min($,e+1)),disabled:P===$,children:(0,t.jsx)(D.Z,{className:"h-4 w-4"})})]})]})]})]}),(0,t.jsx)(()=>(0,t.jsx)(eh.Vq,{open:v,onOpenChange:f,children:(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:"Confirm Deletion"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{children:['Are you sure you want to delete "',null==b?void 0:b.name,'"?']}),(0,t.jsxs)(ex.bZ,{variant:"default",children:[(0,t.jsx)(ex.Cd,{children:"Warning"}),(0,t.jsx)(ex.X,{children:"This action cannot be undone. The system will check for any linked contracts before proceeding."})]})]}),(0,t.jsxs)(eh.cN,{children:[(0,t.jsx)(y.z,{variant:"outline",onClick:()=>f(!1),disabled:h,children:"Cancel"}),(0,t.jsx)(y.z,{variant:"destructive",onClick:_,disabled:h,children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Checking..."]}):"Delete"})]})]})}),{})]})})}function aE(){let[e,a]=(0,l.useState)([]),[s,r]=(0,l.useState)(new Set),[i,n]=(0,l.useState)({name:"",id:"",date:""}),[c,d]=(0,l.useState)(!0),[m,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(null),[p,j]=(0,l.useState)({name:""}),[v,f]=(0,l.useState)(null),[N,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{w()},[]);let b=async()=>{try{let e=(0,ej.hJ)(ev.db,"catering"),a=await (0,ej.PL)(e),s=new Set;a.forEach(e=>{let a=e.data();a.categoryId&&s.add(a.categoryId)}),r(s)}catch(e){console.error("Error checking linked categories:",e)}},w=async()=>{try{d(!0);let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Category"),(0,ej.Xo)("date","desc")),s=(await (0,ej.PL)(e)).docs.map(e=>{var a;return{id:e.data().id,name:e.data().name,date:(null===(a=e.data().date)||void 0===a?void 0:a.toDate())||new Date}});a(s),await b()}catch(e){console.error("Error fetching categories:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load categories"})}finally{d(!1)}},C=async a=>{if(a.preventDefault(),f(null),!p.name.trim()){f("Category name is required");return}try{g(!0);let a=new Date,s={name:p.name,date:a};if(h)await (0,ej.pl)((0,ej.JU)(ev.db,"Category",h.id),s),(0,ef.Am)({title:"Success",description:"Category updated successfully"});else{let a="CAT".concat(String(e.length+1).padStart(3,"0"));await (0,ej.pl)((0,ej.JU)(ev.db,"Category",a),{...s,id:a}),(0,ef.Am)({title:"Success",description:"Category added successfully"})}j({name:""}),x(null),u(!1),w()}catch(e){console.error("Error saving category:",e),f("Failed to save category")}finally{g(!1)}},D=async e=>{if(window.confirm("Are you sure you want to delete this category?"))try{await (0,ej.oe)((0,ej.JU)(ev.db,"Category",e.id)),(0,ef.Am)({title:"Success",description:"Category deleted successfully"}),w()}catch(e){console.error("Error deleting category:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to delete category"})}},S=(e,a)=>{n(s=>({...s,[e]:a}))},I=e.filter(e=>{let a=e.name.toLowerCase().includes(i.name.toLowerCase()),s=e.id.toLowerCase().includes(i.id.toLowerCase()),t=!i.date||(0,eA.WU)(e.date,"yyyy-MM-dd")===i.date;return a&&s&&t});return(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsxs)(T.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(T.ll,{children:"Category Maintenance"}),(0,t.jsxs)(eh.Vq,{open:m,onOpenChange:u,children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{onClick:()=>{x(null),j({name:""})},children:[(0,t.jsx)(G.Z,{className:"mr-2 h-4 w-4"}),"Add Category"]})}),(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:h?"Edit Category":"Add New Category"})}),(0,t.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[v&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:v})]}),(0,t.jsx)("div",{className:"space-y-2",children:(0,t.jsx)(Y,{placeholder:"Category name",value:p.name,onChange:e=>j({name:e.target.value})})}),(0,t.jsx)(eh.cN,{children:(0,t.jsx)(y.z,{type:"submit",disabled:N,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Updating...":"Adding..."]}):h?"Update Category":"Add Category"})})]})]})]})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by name...",value:i.name,onChange:e=>S("name",e.target.value),className:"pl-8"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by ID...",value:i.id,onChange:e=>S("id",e.target.value),className:"pl-8"})]}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(Y,{type:"date",value:i.date,onChange:e=>S("date",e.target.value),className:"pl-8"})})]}),(i.name||i.id||i.date)&&(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(y.z,{variant:"outline",size:"sm",onClick:()=>{n({name:"",id:"",date:""})},className:"flex items-center gap-2",children:[(0,t.jsx)(aP.Z,{className:"h-4 w-4"}),"Clear Filters"]})}),c?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(Q.Z,{className:"h-6 w-6 animate-spin"})}):(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"ID"}),(0,t.jsx)(K.ss,{children:"Name"}),(0,t.jsx)(K.ss,{children:"Date Added"}),(0,t.jsx)(K.ss,{children:"Actions"})]})}),(0,t.jsx)(K.RM,{children:0===I.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:4,className:"text-center",children:"No categories found"})}):I.map(e=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{children:e.id}),(0,t.jsx)(K.pj,{children:e.name}),(0,t.jsx)(K.pj,{children:(0,eA.WU)(e.date,"dd/MM/yyyy")}),(0,t.jsx)(K.pj,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>{x(e),j({name:e.name}),u(!0)},children:(0,t.jsx)(ea.Z,{className:"h-4 w-4"})}),s.has(e.id)?(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center text-muted-foreground",children:(0,t.jsx)(ew.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"Cannot delete: Category is linked to one or more catering options"})})]})}):(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>D(e),children:(0,t.jsx)(es.Z,{className:"h-4 w-4 text-red-500"})})]})})]},e.id))})]})]})})]})})}function aF(){let[e,a]=(0,l.useState)([]),[s,r]=(0,l.useState)(new Set),[i,n]=(0,l.useState)({name:"",id:"",date:""}),[c,d]=(0,l.useState)(!0),[m,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(null),[p,j]=(0,l.useState)({name:""}),[v,f]=(0,l.useState)(null),[N,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{w()},[]);let b=async()=>{try{let e=(0,ej.hJ)(ev.db,"Policies"),a=await (0,ej.PL)(e),s=new Set;a.forEach(e=>{let a=e.data();a.features&&Array.isArray(a.features)&&a.features.forEach(e=>{s.add(e)})}),r(s)}catch(e){console.error("Error checking linked features:",e)}},w=async()=>{try{d(!0);let e=(0,ej.IO)((0,ej.hJ)(ev.db,"features"),(0,ej.Xo)("date","desc")),s=(await (0,ej.PL)(e)).docs.map(e=>{var a;return{id:e.data().id,name:e.data().name,date:(null===(a=e.data().date)||void 0===a?void 0:a.toDate())||new Date}});a(s),await b()}catch(e){console.error("Error fetching features:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load features"})}finally{d(!1)}},C=async a=>{if(a.preventDefault(),f(null),!p.name.trim()){f("Feature name is required");return}try{g(!0);let a=new Date,s={name:p.name,date:a};if(h)await (0,ej.pl)((0,ej.JU)(ev.db,"features",h.id),s),(0,ef.Am)({title:"Success",description:"Feature updated successfully"});else{let a="FEX".concat(String(e.length+1).padStart(3,"0"));await (0,ej.pl)((0,ej.JU)(ev.db,"features",a),{...s,id:a}),(0,ef.Am)({title:"Success",description:"Feature added successfully"})}j({name:""}),x(null),u(!1),w()}catch(e){console.error("Error saving feature:",e),f("Failed to save feature")}finally{g(!1)}},D=async e=>{if(window.confirm("Are you sure you want to delete this feature?"))try{await (0,ej.oe)((0,ej.JU)(ev.db,"features",e.id)),(0,ef.Am)({title:"Success",description:"Feature deleted successfully"}),w()}catch(e){console.error("Error deleting feature:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to delete feature"})}},S=(e,a)=>{n(s=>({...s,[e]:a}))},I=e.filter(e=>{let a=e.name.toLowerCase().includes(i.name.toLowerCase()),s=e.id.toLowerCase().includes(i.id.toLowerCase()),t=!i.date||(0,eA.WU)(e.date,"yyyy-MM-dd")===i.date;return a&&s&&t});return(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(T.Zb,{children:[(0,t.jsxs)(T.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(T.ll,{children:"Feature Maintenance"}),(0,t.jsxs)(eh.Vq,{open:m,onOpenChange:u,children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{onClick:()=>{x(null),j({name:""})},children:[(0,t.jsx)(G.Z,{className:"mr-2 h-4 w-4"}),"Add Feature"]})}),(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:h?"Edit Feature":"Add New Feature"})}),(0,t.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[v&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:v})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"name",children:"Feature Name"}),(0,t.jsx)(Y,{id:"name",placeholder:"Feature name",value:p.name,onChange:e=>j({name:e.target.value})})]}),(0,t.jsx)(eh.cN,{children:(0,t.jsx)(y.z,{type:"submit",disabled:N,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Updating...":"Adding..."]}):h?"Update Feature":"Add Feature"})})]})]})]})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by name...",value:i.name,onChange:e=>S("name",e.target.value),className:"pl-8"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by ID...",value:i.id,onChange:e=>S("id",e.target.value),className:"pl-8"})]}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(Y,{type:"date",value:i.date,onChange:e=>S("date",e.target.value),className:"pl-8"})})]}),(i.name||i.id||i.date)&&(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(y.z,{variant:"outline",size:"sm",onClick:()=>{n({name:"",id:"",date:""})},className:"flex items-center gap-2",children:[(0,t.jsx)(aP.Z,{className:"h-4 w-4"}),"Clear Filters"]})}),c?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(Q.Z,{className:"h-6 w-6 animate-spin"})}):(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"ID"}),(0,t.jsx)(K.ss,{children:"Name"}),(0,t.jsx)(K.ss,{children:"Date Added"}),(0,t.jsx)(K.ss,{children:"Actions"})]})}),(0,t.jsx)(K.RM,{children:0===I.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:4,className:"text-center",children:"No features found"})}):I.map(e=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{children:e.id}),(0,t.jsx)(K.pj,{children:e.name}),(0,t.jsx)(K.pj,{children:(0,eA.WU)(e.date,"dd/MM/yyyy")}),(0,t.jsx)(K.pj,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>{x(e),j({name:e.name}),u(!0)},children:(0,t.jsx)(ea.Z,{className:"h-4 w-4"})}),s.has(e.id)?(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center text-muted-foreground",children:(0,t.jsx)(ew.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"Cannot delete: Feature is linked to one or more policies"})})]})}):(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>D(e),children:(0,t.jsx)(es.Z,{className:"h-4 w-4 text-red-500"})})]})})]},e.id))})]})]})})]})})}var aT=s(80804);function aL(){let[e,a]=(0,l.useState)([]),[s,r]=(0,l.useState)({contractNumber:"",reference:"",date:"",status:"all"}),[i,n]=(0,l.useState)(!0),[c,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null),[h,x]=(0,l.useState)({contractNumber:"",amount:"",paymentMethod:"",reference:"",receiptUrl:""}),[p,j]=(0,l.useState)(null),[v,f]=(0,l.useState)(!1),[N,g]=(0,l.useState)(!1),[b,w]=(0,l.useState)(null),[C,D]=(0,l.useState)(null),[S,I]=(0,l.useState)(!1),[A,P]=(0,l.useState)(null),[M,k]=(0,l.useState)(!1);(0,l.useEffect)(()=>{O()},[]);let O=async()=>{try{n(!0);let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Payments"),(0,ej.Xo)("paymentDate","desc")),s=(await (0,ej.PL)(e)).docs.map(e=>{var a;return{id:e.id,contractNumber:e.data().contractNumber,amount:e.data().amount,paymentMethod:e.data().paymentMethod,status:e.data().status,reference:e.data().reference,receiptUrl:e.data().receiptUrl,paymentDate:(null===(a=e.data().paymentDate)||void 0===a?void 0:a.toDate())||new Date}});a(s)}catch(e){console.error("Error fetching payments:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load payments"})}finally{n(!1)}},E=async e=>{try{let a=(0,ej.IO)((0,ej.hJ)(ev.db,"Contracts"),(0,ej.ar)("contractNumber","==",e));return!(await (0,ej.PL)(a)).empty}catch(e){return console.error("Error validating contract:",e),!1}},F=async e=>{try{g(!0);let a=Date.now(),s="receipts/".concat(a,"_").concat(e.name.replace(/[^a-zA-Z0-9.]/g,"_")),t=(0,eI.iH)(ev.t,s);await (0,eI.KV)(t,e);let l=await (0,eI.Jt)(t),r=URL.createObjectURL(e);w(r),x(e=>({...e,receiptUrl:l})),(0,ef.Am)({title:"Success",description:"Receipt uploaded successfully"})}catch(e){console.error("Error uploading receipt:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to upload receipt"})}finally{g(!1)}};(0,l.useEffect)(()=>()=>{b&&URL.revokeObjectURL(b)},[b]);let L=async()=>{try{let e=(0,ej.hJ)(ev.db,"Payments"),a=(0,ej.IO)(e,(0,ej.Xo)("reference","desc"),(0,ej.b9)(1)),s=await (0,ej.PL)(a),t=1;if(!s.empty){let e=s.docs[0].data().reference.match(/ref-(\d+)/);e&&(t=parseInt(e[1])+1)}return"ref-".concat(String(t).padStart(10,"0"))}catch(e){throw console.error("Error generating reference:",e),Error("Failed to generate reference number")}},U=async e=>{let a=(0,ej.hJ)(ev.db,"Payments"),s=(0,ej.IO)(a,(0,ej.ar)("reference","==",e));return!(await (0,ej.PL)(s)).empty},z=async a=>{if(a.preventDefault(),j(null),!h.contractNumber.trim()||!h.amount||!h.paymentMethod||!h.receiptUrl){j("All fields are required, including receipt image");return}if(!await E(h.contractNumber)){j("Invalid contract number");return}try{f(!0);let a=h.reference;if(!m&&(a=await L(),await U(a))){j("Duplicate reference number detected. Please try again.");return}let s=new Date,t={contractNumber:h.contractNumber,amount:parseFloat(h.amount),paymentDate:s,paymentMethod:h.paymentMethod,status:"Completed",reference:a,receiptUrl:h.receiptUrl};if(m){if(m.receiptUrl&&m.receiptUrl!==h.receiptUrl)try{let e=(0,eI.iH)(ev.t,m.receiptUrl);await (0,eI.oq)(e)}catch(e){console.error("Error deleting old receipt:",e)}await (0,ej.pl)((0,ej.JU)(ev.db,"Payments",m.id),t),(0,ef.Am)({title:"Success",description:"Payment updated successfully"})}else{let a="PAY".concat(String(e.length+1).padStart(3,"0"));await (0,ej.pl)((0,ej.JU)(ev.db,"Payments",a),{...t,id:a}),(0,ef.Am)({title:"Success",description:"Payment added successfully"})}x({contractNumber:"",amount:"",paymentMethod:"",reference:"",receiptUrl:""}),w(null),u(null),d(!1),O()}catch(e){console.error("Error saving payment:",e),j("Failed to save payment")}finally{f(!1)}},R=(e,a)=>{r(s=>({...s,[e]:a}))},B=e.filter(e=>{let a=e.contractNumber.toLowerCase().includes(s.contractNumber.toLowerCase()),t=e.reference.toLowerCase().includes(s.reference.toLowerCase()),l=!s.date||(0,eA.WU)(e.paymentDate,"yyyy-MM-dd")===s.date,r="all"===s.status||e.status.toLowerCase()===s.status.toLowerCase();return a&&t&&l&&r}),J=()=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{children:(0,t.jsx)(e3.O,{className:"h-4 w-32"})}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(e3.O,{className:"h-4 w-24"})}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(e3.O,{className:"h-4 w-28"})}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(e3.O,{className:"h-4 w-32"})}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(e3.O,{className:"h-4 w-24"})}),(0,t.jsx)(K.pj,{children:(0,t.jsx)(e3.O,{className:"h-4 w-20"})})]}),V=async()=>{if(h.contractNumber.trim()){k(!0),j(null);try{let e=(0,ej.IO)((0,ej.hJ)(ev.db,"Contracts"),(0,ej.ar)("contractNumber","==",h.contractNumber.trim().toUpperCase())),a=await (0,ej.PL)(e);if(a.empty){j("Contract not found"),P(null);return}let s=a.docs[0].data(),t=(0,ej.JU)(ev.db,"Policies",s.policiesId),l=await (0,ej.QT)(t),r=l.exists()&&l.data().premium||0,i=0;if(s.cateringOptionIds&&s.cateringOptionIds.length>0)for(let e of s.cateringOptionIds){let a=(0,ej.JU)(ev.db,"catering",e),s=await (0,ej.QT)(a);s.exists()&&(i+=s.data().price||0)}let n=(0,ej.IO)((0,ej.hJ)(ev.db,"Members"),(0,ej.ar)("idNumber","==",s.memberIdNumber)),c=await (0,ej.PL)(n),d=c.empty?"Unknown":"".concat(c.docs[0].data().firstName," ").concat(c.docs[0].data().lastName),o=r+i;P({policyAmount:r,cateringTotal:i,totalAmount:o,mainMemberName:d}),x(e=>({...e,amount:o.toString()}))}catch(e){console.error("Error looking up contract:",e),j("Failed to lookup contract details"),P(null)}finally{k(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsxs)(T.Ol,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(T.ll,{children:"Payment Management"}),(0,t.jsxs)(eh.Vq,{open:c,onOpenChange:d,children:[(0,t.jsx)(eh.hg,{asChild:!0,children:(0,t.jsxs)(y.z,{id:"Add Payment",onClick:()=>d(!0),children:[(0,t.jsx)(G.Z,{className:"h-4 w-4 mr-2"}),"Add Payment"]})}),(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:m?"Edit Payment":"Add New Payment"})}),(0,t.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[p&&(0,t.jsxs)(ex.bZ,{variant:"destructive",children:[(0,t.jsx)(ex.Cd,{children:"Error"}),(0,t.jsx)(ex.X,{children:p})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(H,{htmlFor:"contractNumber",children:"Contract Number"}),(0,t.jsx)(Y,{id:"contractNumber",placeholder:"Enter contract number",value:h.contractNumber,onChange:e=>x(a=>({...a,contractNumber:e.target.value}))})]}),(0,t.jsx)(y.z,{type:"button",className:"mt-8",onClick:V,disabled:M||!h.contractNumber.trim(),children:M?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"})}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"})})})]}),A&&(0,t.jsxs)("div",{className:"space-y-4 p-4 bg-[#F8F9FC] rounded-lg border-2 border-[#E4E7EC]",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Policy Amount:"}),(0,t.jsxs)("span",{className:"text-base font-semibold",children:["R ",A.policyAmount.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Catering Total:"}),(0,t.jsxs)("span",{className:"text-base font-semibold",children:["R ",A.cateringTotal.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-[#E4E7EC]",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Total Amount:"}),(0,t.jsxs)("span",{className:"text-lg font-bold",children:["R ",A.totalAmount.toLocaleString()]})]})]}),(0,t.jsxs)("div",{hidden:!0,className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"amount",children:"Amount"}),(0,t.jsx)(Y,{id:"amount",type:"number",placeholder:"Enter amount",value:h.amount,onChange:e=>x(a=>({...a,amount:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"paymentMethod",children:"Payment Method"}),(0,t.jsxs)(er,{value:h.paymentMethod,onValueChange:e=>x(a=>({...a,paymentMethod:e})),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Select payment method"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"Cash",children:"Cash"}),(0,t.jsx)(em,{value:"Credit Card",children:"Credit Card"}),(0,t.jsx)(em,{value:"Debit Card",children:"Debit Card"}),(0,t.jsx)(em,{value:"Bank Transfer",children:"Bank Transfer"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H,{htmlFor:"reference",children:"Reference"}),(0,t.jsx)(Y,{id:"reference",placeholder:"Auto-generated reference",value:h.reference,disabled:!0,className:"bg-muted"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(H,{className:"flex items-center gap-2",children:["Receipt Image",(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"(Required)"})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"Upload a picture of the receipt - this is required"})})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(Y,{type:"file",accept:"image/*",className:"hidden",id:"receipt-upload",required:!0,onChange:e=>{var a;let s=null===(a=e.target.files)||void 0===a?void 0:a[0];s&&F(s)}}),(0,t.jsx)(y.z,{type:"button",variant:h.receiptUrl?"outline":"secondary",onClick:()=>{var e;return null===(e=document.getElementById("receipt-upload"))||void 0===e?void 0:e.click()},className:"flex items-center gap-2",disabled:N,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eC.Z,{className:"h-4 w-4"}),h.receiptUrl?"Change Receipt":"Upload Receipt *"]})}),h.receiptUrl&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{type:"button",variant:"ghost",size:"sm",className:"p-0",onClick:()=>window.open(b||h.receiptUrl,"_blank"),children:(0,t.jsx)(aT.Z,{className:"h-4 w-4 text-green-500"})})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"Click to view receipt"})})]})}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Receipt uploaded"}),(0,t.jsx)(y.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>{x(e=>({...e,receiptUrl:""})),w(null)},children:(0,t.jsx)(aP.Z,{className:"h-4 w-4"})})]})]})]}),(0,t.jsx)(eh.cN,{children:(0,t.jsx)(y.z,{type:"submit",disabled:v,children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),m?"Updating...":"Adding..."]}):m?"Update Payment":"Add Payment"})})]})]})]})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[i?(0,t.jsx)(()=>(0,t.jsx)("div",{className:"grid grid-cols-4 gap-4",children:[1,2,3,4].map(e=>(0,t.jsx)(e3.O,{className:"h-10"},e))}),{}):(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by contract...",value:s.contractNumber,onChange:e=>R("contractNumber",e.target.value),className:"pl-8"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(Y,{placeholder:"Search by reference...",value:s.reference,onChange:e=>R("reference",e.target.value),className:"pl-8"})]}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(Y,{type:"date",value:s.date,onChange:e=>R("date",e.target.value),className:"pl-8"})}),(0,t.jsxs)(er,{value:s.status,onValueChange:e=>R("status",e),children:[(0,t.jsx)(en,{children:(0,t.jsx)(ei,{placeholder:"Filter by status"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{value:"all",children:"All Statuses"}),(0,t.jsx)(em,{value:"Completed",children:"Completed"}),(0,t.jsx)(em,{value:"Pending",children:"Pending"}),(0,t.jsx)(em,{value:"Failed",children:"Failed"})]})]})]}),(s.contractNumber||s.reference||s.date||"all"!==s.status)&&!i&&(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(y.z,{variant:"outline",size:"sm",onClick:()=>{r({contractNumber:"",reference:"",date:"",status:"all"})},className:"flex items-center gap-2",disabled:i,children:[(0,t.jsx)(aP.Z,{className:"h-4 w-4"}),"Clear Filters"]})}),(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"Contract Number"}),(0,t.jsx)(K.ss,{children:"Amount"}),(0,t.jsx)(K.ss,{children:"Payment Method"}),(0,t.jsx)(K.ss,{children:"Reference"}),(0,t.jsx)(K.ss,{children:"Date"}),(0,t.jsx)(K.ss,{children:"Status"}),(0,t.jsx)(K.ss,{children:"Actions"})]})}),(0,t.jsx)(K.RM,{children:i?Array.from({length:5}).map((e,a)=>(0,t.jsx)(J,{},a)):0===B.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:7,className:"text-center py-8",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(ew.Z,{className:"h-8 w-8"}),(0,t.jsx)("p",{children:"No payments found"})]})})}):B.map(e=>(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{children:e.contractNumber}),(0,t.jsxs)(K.pj,{children:["R ",e.amount.toLocaleString()]}),(0,t.jsx)(K.pj,{children:e.paymentMethod}),(0,t.jsx)(K.pj,{children:e.reference}),(0,t.jsx)(K.pj,{children:(0,eA.WU)(e.paymentDate,"dd/MM/yyyy")}),(0,t.jsx)(K.pj,{children:(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("Completed"===e.status?"bg-green-100 text-green-800":"Pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})}),(0,t.jsx)(K.pj,{children:e.receiptUrl&&(0,t.jsx)(Z.pn,{children:(0,t.jsxs)(Z.u,{children:[(0,t.jsx)(Z.aJ,{asChild:!0,children:(0,t.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>D({url:e.receiptUrl,reference:e.reference}),children:(0,t.jsx)(aT.Z,{className:"h-4 w-4 text-blue-500"})})}),(0,t.jsx)(Z._v,{children:(0,t.jsx)("p",{children:"View receipt"})})]})})})]},e.id))})]})]})})]}),(0,t.jsx)(eh.Vq,{open:null!==C,onOpenChange:e=>!e&&D(null),children:(0,t.jsxs)(eh.cZ,{className:"max-w-4xl",children:[(0,t.jsx)(eh.fK,{className:"border-b pb-4",children:(0,t.jsxs)(eh.$N,{className:"text-xl font-semibold flex items-center gap-2",children:[(0,t.jsx)(aT.Z,{className:"h-5 w-5"}),"Payment Receipt"]})}),(0,t.jsxs)("div",{className:"flex flex-col min-h-[60vh]",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-[1fr,300px] gap-6 pt-2 flex-1",children:[(0,t.jsxs)("div",{className:"relative bg-gray-50 rounded-lg overflow-hidden border shadow-inner",children:[(0,t.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center",children:[S&&(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-100/90 backdrop-blur-sm z-10 gap-3",children:[(0,t.jsx)(Q.Z,{className:"h-10 w-10 animate-spin text-primary"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground animate-pulse",children:"Loading receipt..."})]}),(null==C?void 0:C.url)&&(0,t.jsx)("img",{src:C.url,alt:"Receipt for ".concat(C.reference),className:"max-w-full max-h-[60vh] object-contain transition-opacity duration-300 ".concat(S?"opacity-0":"opacity-100"),onLoadStart:()=>I(!0),onLoad:()=>I(!1),onError:()=>{I(!1),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to load receipt image"})}})]}),(0,t.jsx)("div",{className:"aspect-[3/4] md:aspect-auto md:h-[60vh]"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm",children:[(0,t.jsxs)("h3",{className:"font-semibold mb-4 flex items-center gap-2 text-primary",children:[(0,t.jsx)(aT.Z,{className:"h-4 w-4"}),"Receipt Information"]}),(0,t.jsxs)("dl",{className:"space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"grid grid-cols-[100px,1fr] items-center py-1 border-b",children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Reference:"}),(0,t.jsx)("dd",{className:"font-medium",children:null==C?void 0:C.reference})]}),(0,t.jsxs)("div",{className:"grid grid-cols-[100px,1fr] items-center py-1",children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Status:"}),(0,t.jsx)("dd",{children:(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Uploaded"})})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm",children:[(0,t.jsxs)("h3",{className:"font-semibold mb-4 flex items-center gap-2 text-primary",children:[(0,t.jsx)(eS.Z,{className:"h-4 w-4"}),"Actions"]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(y.z,{className:"w-full justify-start",variant:"outline",onClick:()=>window.open(null==C?void 0:C.url,"_blank"),children:[(0,t.jsx)(eD.Z,{className:"mr-2 h-4 w-4"}),"Open in New Tab"]}),(0,t.jsxs)(y.z,{className:"w-full justify-start",variant:"outline",onClick:()=>{let e=document.createElement("a");e.href=(null==C?void 0:C.url)||"",e.download="receipt-".concat(null==C?void 0:C.reference),e.click()},children:[(0,t.jsx)(eS.Z,{className:"mr-2 h-4 w-4"}),"Download Receipt"]})]})]})]})]}),(0,t.jsx)("div",{className:"flex justify-end border-t mt-6 pt-4",children:(0,t.jsx)(y.z,{variant:"outline",onClick:()=>D(null),className:"px-8",children:"Cancel"})})]})]})})]})}let aU=async()=>{try{let e=(0,ej.hJ)(ev.db,"users");return(await (0,ej.PL)(e)).docs.map(e=>{var a,s;return{id:e.id,...e.data(),createdAt:null===(a=e.data().createdAt)||void 0===a?void 0:a.toDate(),lastLogin:null===(s=e.data().lastLogin)||void 0===s?void 0:s.toDate()}})}catch(e){throw console.error("Error getting users:",e),e}},az=async(e,a)=>{try{let s=(0,ej.hJ)(ev.db,"users"),t=(0,ej.IO)(s);return e&&(t=(0,ej.IO)(t,(0,ej.ar)("username",">=",e),(0,ej.ar)("username","<=",e+""))),a&&"all"!==a&&(t=(0,ej.IO)(t,(0,ej.ar)("role","==",a))),(await (0,ej.PL)(t)).docs.map(e=>{var a,s;return{id:e.id,...e.data(),createdAt:null===(a=e.data().createdAt)||void 0===a?void 0:a.toDate(),lastLogin:null===(s=e.data().lastLogin)||void 0===s?void 0:s.toDate()}})}catch(e){throw console.error("Error searching users:",e),e}},aR=async e=>{try{let a=(0,ej.hJ)(ev.db,"users"),s=(0,ej.IO)(a,(0,ej.ar)("username","==",e.username));if(!(await (0,ej.PL)(s)).empty){let a="".concat(e.username).concat(Math.floor(1e3*Math.random()));throw Error("Username already exists. Try: ".concat(a))}return(await (0,ej.ET)(a,{...e,createdAt:(0,ej.Bt)()})).id}catch(e){throw console.error("Error adding user:",e),e}},aB=async(e,a)=>{try{let s=(0,ej.JU)(ev.db,"users",e),t={...a};a.password||delete t.password,await (0,ej.r7)(s,t)}catch(e){throw console.error("Error updating user:",e),e}},aJ=async e=>{try{let a=(0,ej.JU)(ev.db,"users",e);await (0,ej.oe)(a)}catch(e){throw console.error("Error deleting user:",e),e}},aV=["Admin","New Claim","Process Claim","New Contract","View Only"];function a_(){let[e,a]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(""),[c,d]=(0,l.useState)({username:"",role:"all"}),[m,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(null),[p,j]=(0,l.useState)({username:"",password:"",role:"View Only"});(0,l.useEffect)(()=>{v()},[]);let v=async()=>{try{r(!0);let e=await aU();a(e)}catch(e){console.error("Error fetching users:",e),n("Failed to load users")}finally{r(!1)}},f=async()=>{try{r(!0);let e=await az(c.username,c.role);a(e)}catch(e){console.error("Error searching users:",e),n("Failed to search users")}finally{r(!1)}},N=async e=>{e.preventDefault();try{if(r(!0),h)await aB(h.id,p),(0,ef.Am)({title:"Success",description:"User updated successfully"});else try{await aR(p),(0,ef.Am)({title:"Success",description:"User added successfully"})}catch(e){if(e.message.includes("Username already exists")){(0,ef.Am)({variant:"destructive",title:"Error",description:e.message});return}throw e}u(!1),v()}catch(e){console.error("Error saving user:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to save user"})}finally{r(!1)}},g=async e=>{if(confirm("Are you sure you want to delete this user?"))try{r(!0),await aJ(e),(0,ef.Am)({title:"Success",description:"User deleted successfully"}),v()}catch(e){console.error("Error deleting user:",e),(0,ef.Am)({variant:"destructive",title:"Error",description:"Failed to delete user"})}finally{r(!1)}},b=e=>{x(e),j({username:e.username,password:"",role:e.role}),u(!0)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(T.ll,{children:"User Management"}),(0,t.jsxs)(y.z,{id:"Add User",onClick:()=>{x(null),j({username:"",password:"",role:"View Only"}),u(!0)},children:[(0,t.jsx)(G.Z,{className:"mr-2 h-4 w-4"}),"Add User"]})]})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(Y,{placeholder:"Search by username",value:c.username,onChange:e=>d(a=>({...a,username:e.target.value}))})}),(0,t.jsxs)(er,{value:c.role,onValueChange:e=>d(a=>({...a,role:e})),children:[(0,t.jsx)(en,{id:"role",className:"w-[200px]",children:(0,t.jsx)(ei,{placeholder:"Select role"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{id:"All Roles","data-value":"All Roles",value:"all",children:"All Roles"}),aV.map(e=>(0,t.jsx)(em,{id:e,"data-value":e,value:e,children:e},e))]})]}),(0,t.jsxs)(y.z,{id:"Search",onClick:f,children:[(0,t.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Search"]})]}),i&&(0,t.jsx)(ex.bZ,{variant:"destructive",className:"mb-6",children:(0,t.jsx)(ex.X,{children:i})}),(0,t.jsxs)(K.iA,{children:[(0,t.jsx)(K.xD,{children:(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.ss,{children:"Username"}),(0,t.jsx)(K.ss,{children:"Role"}),(0,t.jsx)(K.ss,{children:"Created At"}),(0,t.jsx)(K.ss,{children:"Last Login"}),(0,t.jsx)(K.ss,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(K.RM,{children:s?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:5,className:"text-center py-8",children:(0,t.jsx)(Q.Z,{className:"h-6 w-6 animate-spin mx-auto"})})}):0===e.length?(0,t.jsx)(K.SC,{children:(0,t.jsx)(K.pj,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):e.map(e=>{var a;return(0,t.jsxs)(K.SC,{children:[(0,t.jsx)(K.pj,{children:e.username}),(0,t.jsx)(K.pj,{children:e.role}),(0,t.jsx)(K.pj,{children:e.createdAt.toLocaleDateString()}),(0,t.jsx)(K.pj,{children:(null===(a=e.lastLogin)||void 0===a?void 0:a.toLocaleDateString())||"Never"}),(0,t.jsxs)(K.pj,{className:"text-right space-x-2",children:[(0,t.jsx)(y.z,{id:"Edit",variant:"ghost",size:"icon",onClick:()=>b(e),children:(0,t.jsx)(ea.Z,{className:"h-4 w-4"})}),(0,t.jsx)(y.z,{id:"Delete",variant:"ghost",size:"icon",className:"text-red-600 hover:text-red-700 hover:bg-red-100",onClick:()=>g(e.id),children:(0,t.jsx)(es.Z,{className:"h-4 w-4"})})]})]},e.id)})})]})]})]}),(0,t.jsx)(eh.Vq,{open:m,onOpenChange:u,children:(0,t.jsxs)(eh.cZ,{children:[(0,t.jsx)(eh.fK,{children:(0,t.jsx)(eh.$N,{children:h?"Edit User":"Add New User"})}),(0,t.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"username",children:"Username"}),(0,t.jsx)(Y,{id:"username",value:p.username,onChange:e=>j(a=>({...a,username:e.target.value})),disabled:!!h})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"password",children:"Password"}),(0,t.jsx)(Y,{id:"password",type:"password",value:p.password,onChange:e=>j(a=>({...a,password:e.target.value})),placeholder:h?"(unchanged)":""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"role",children:"Role"}),(0,t.jsxs)(er,{value:p.role,onValueChange:e=>j(a=>({...a,role:e})),children:[(0,t.jsx)(en,{id:"role",children:(0,t.jsx)(ei,{placeholder:"Select role"})}),(0,t.jsx)(eo,{children:aV.map(e=>(0,t.jsx)(em,{id:e,"data-value":e,value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(y.z,{id:"Cancel",type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),(0,t.jsx)(y.z,{id:"Save",type:"submit",disabled:s,children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Q.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})})]})}var aq=s(98420),aX=s(92369),aY=s(66337),aW=s(44752);let a$=async(e,a)=>{try{let s=(0,aW.v0)();if(!(await (0,aW.e5)(s,e,a)).user)return{success:!1,role:"",error:"Authentication failed"};let t=(0,ej.hJ)(ev.db,"users"),l=(0,ej.IO)(t,(0,ej.ar)("email","==",e)),r=await (0,ej.PL)(l);if(r.empty){let a=(0,ej.JU)(t);return await (0,ej.pl)(a,{email:e,role:"Admin",createdAt:new Date}),{success:!0,role:"Admin"}}let i=r.docs[0].data();return{success:!0,role:i.role||"Admin"}}catch(a){console.error("Login error:",a);let e="Failed to login";return"auth/user-not-found"===a.code?e="No user found with this email":"auth/wrong-password"===a.code?e="Invalid password":"auth/invalid-email"===a.code?e="Invalid email format":"auth/too-many-requests"===a.code&&(e="Too many failed attempts. Please try again later"),{success:!1,role:"",error:e}}},aH=async(e,a)=>{try{let s=(0,ej.hJ)(ev.db,"users"),t=(0,ej.IO)(s,(0,ej.ar)("username","==",e)),l=await (0,ej.PL)(t);if(l.empty)return{success:!1,role:"",error:"No user found with this username"};let r=l.docs[0],i=r.data();if(i.password!==a)return{success:!1,role:"",error:"Invalid password"};return await (0,ej.pl)((0,ej.JU)(s,r.id),{...i,lastLogin:new Date},{merge:!0}),{success:!0,role:i.role||"User"}}catch(e){return console.error("Login error:",e),{success:!1,role:"",error:"An unexpected error occurred. Please try again."}}},aK=async()=>{try{let e=(0,aW.v0)();await (0,aW.w7)(e)}catch(e){throw console.error("Logout error:",e),e}};function aQ(){let[e,a]=(0,l.useState)(!1),[s,r]=(0,l.useState)("dashboard"),[i,n]=(0,l.useState)(!1),[c,d]=(0,l.useState)(""),[o,m]=(0,l.useState)(""),[u,h]=(0,l.useState)(""),[x,p]=(0,l.useState)("<User Default>"),[j,v]=(0,l.useState)(""),[f,N]=(0,l.useState)(!1),[g,b]=(0,l.useState)(""),w=a=>{e&&g&&console.log("Current User Role: ".concat(g))},C=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),D=async e=>{e.preventDefault(),v(""),N(!0);try{if(i){if(!c||!u){v("Please enter both email and password");return}if(!C(c)){v("Please enter a valid email address");return}let e=await a$(c,u);e.success?(a(!0),b(e.role),r("dashboard")):v(e.error||"Failed to login")}else{if(!o||!u){v("Please enter both username and password");return}let e=await aH(o,u);e.success?(a(!0),b(e.role),r("dashboard")):v(e.error||"Failed to login")}}catch(e){console.error("Login error:",e),v((null==e?void 0:e.message)||"Failed to login. Please try again.")}finally{N(!1)}},S=async()=>{try{await aK(),a(!1),m(""),d(""),h(""),p("<User Default>"),b(""),n(!1)}catch(e){console.error("Logout error:",e)}};return e?(0,t.jsx)("div",{onClick:w,children:(0,t.jsx)(F,{setCurrentPage:r,onLogout:S,userRole:g,children:(()=>{switch(s){case"dashboard":default:return(0,t.jsx)(X,{});case"policies":return(0,t.jsx)(ey,{userRole:g});case"cateringMaintenance":return(0,t.jsx)(aZ,{});case"claims":return(0,t.jsx)(eE,{userRole:g});case"customers":return(0,t.jsx)(eF,{});case"reports":return(0,t.jsx)(eG,{});case"addContract":return(0,t.jsx)(aI,{userRole:g});case"searchContract":return(0,t.jsx)(aA,{userRole:g});case"claimsProcessing":return(0,t.jsx)(aO,{userRole:g});case"categoryMaintenance":return(0,t.jsx)(aE,{});case"featureMaintenance":return(0,t.jsx)(aF,{});case"payment":return(0,t.jsx)(aL,{});case"userManagement":return(0,t.jsx)(a_,{})}})()})}):(0,t.jsxs)("div",{className:"h-screen flex overflow-hidden",onClick:w,children:[(0,t.jsx)("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-6 bg-slate-50",children:(0,t.jsxs)("div",{className:"w-full max-w-md space-y-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-emerald-100 mb-2",children:(0,t.jsx)(aq.Z,{className:"w-6 h-6 text-emerald-600"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Sign in"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Enter your credentials to access your account"})]}),j&&(0,t.jsxs)("div",{id:j.replace(/\s+/g,"-").toLowerCase(),className:"bg-red-50 border-l-4 border-red-500 p-3 flex items-center space-x-3",children:[(0,t.jsx)(ew.Z,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),(0,t.jsx)("p",{id:"error-".concat(j.replace(/\s+/g,"-").toLowerCase()),className:"text-sm text-red-700",children:j})]}),(0,t.jsxs)("form",{onSubmit:D,className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:i?"Email":"Username",className:"text-sm",children:i?"Email":"Username"}),(0,t.jsxs)("div",{className:"mt-1 relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(aX.Z,{className:"h-4 w-4 text-slate-400"})}),(0,t.jsx)(Y,{id:i?"Email":"Username",type:i?"email":"text",value:i?c:o,onChange:e=>i?d(e.target.value):m(e.target.value),className:"pl-9 h-9",placeholder:i?"Enter your email":"Enter your username"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"Password",className:"text-sm",children:"Password"}),(0,t.jsxs)("div",{className:"mt-1 relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(aY.Z,{className:"h-4 w-4 text-slate-400"})}),(0,t.jsx)(Y,{id:"Password",type:"password",value:u,onChange:e=>h(e.target.value),className:"pl-9 h-9",placeholder:"Enter your password"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H,{htmlFor:"Environment",className:"text-sm",children:"Environment"}),(0,t.jsxs)(er,{value:x,onValueChange:p,children:[(0,t.jsx)(en,{id:"Environment",className:"h-9",children:(0,t.jsx)(ei,{placeholder:"Select environment"})}),(0,t.jsxs)(eo,{children:[(0,t.jsx)(em,{id:"User Default","data-value":"<User Default>",value:"<User Default>",children:"<User Default>"}),(0,t.jsx)(em,{id:"Production","data-value":"Production",value:"Production",children:"Production"}),(0,t.jsx)(em,{id:"Testing","data-value":"Testing",value:"Testing",children:"Testing"}),(0,t.jsx)(em,{id:"Development","data-value":"Development",value:"Development",children:"Development"})]})]})]}),(0,t.jsx)(y.z,{id:"Sign in",type:"submit",disabled:f,className:"w-full h-9",children:f?"Signing in...":"Sign in"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ag,{id:"Login as Admin","data-value":"Login as Admin",checked:i,onCheckedChange:e=>n(e)}),(0,t.jsx)(H,{htmlFor:"Login as Admin",id:"Login as Admin",className:"text-sm",children:"Login as Admin"})]})]})]})}),(0,t.jsx)("div",{className:"hidden lg:block lg:w-1/2 relative",children:(0,t.jsxs)("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:'url("https://images.unsplash.com/photo-1497366216548-37526070297c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80")'},children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-l from-slate-900/90 to-slate-900/50"}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-12 text-white",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold mb-3",children:"Welcome to Insurance Management"}),(0,t.jsx)("p",{className:"text-base text-gray-200",children:"Streamline your insurance claims and policy management with our intelligent solutions"})]})]})})]})}}},function(e){e.O(0,[358,425,505,321,384,328,945,775,971,117,744],function(){return e(e.s=68914)}),_N_E=e.O()}]);